{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/utils.ts"],"sourcesContent":["import { type ClassValue, clsx } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,IAAA,yKAAO,EAAC,IAAA,gJAAI,EAAC;AACtB"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/custom-icon.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport { cn } from \"@/lib/utils\";\n\nconst ICONS = {\n  key: \"/key.svg\",\n  lock: \"/lock.svg\",\n  shield: \"/shield.svg\",\n  upload: \"/upload.svg\",\n  smartphone: \"/smartphone.svg\",\n  cloud: \"/cloud.svg\",\n  clock: \"/clock.svg\",\n  search: \"/search.svg\",\n  image: \"/image.svg\",\n  folder: \"/Openfolder.svg\",\n  refresh: \"/RefreshCw.svg\",\n  chevronRight: \"/ChevronRight.svg\",\n} as const;\n\nexport type IconName = keyof typeof ICONS;\n\ninterface CustomIconProps {\n  name: IconName;\n  className?: string;\n  size?: number;\n}\n\nexport function CustomIcon({ name, className, size = 24 }: CustomIconProps) {\n  return (\n    <div\n      className={cn(\"relative inline-block shrink-0\", className)}\n      style={{ width: size, height: size }}\n    >\n      <Image\n        src={ICONS[name]}\n        alt={name}\n        fill\n        className=\"object-contain\"\n        unoptimized\n      />\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAAA;AACA;;;;AAEA,MAAM,QAAQ;IACZ,KAAK;IACL,MAAM;IACN,QAAQ;IACR,QAAQ;IACR,YAAY;IACZ,OAAO;IACP,OAAO;IACP,QAAQ;IACR,OAAO;IACP,QAAQ;IACR,SAAS;IACT,cAAc;AAChB;AAUO,SAAS,WAAW,EAAE,IAAI,EAAE,SAAS,EAAE,OAAO,EAAE,EAAmB;IACxE,qBACE,6LAAC;QACC,WAAW,IAAA,4HAAE,EAAC,kCAAkC;QAChD,OAAO;YAAE,OAAO;YAAM,QAAQ;QAAK;kBAEnC,cAAA,6LAAC,2IAAK;YACJ,KAAK,KAAK,CAAC,KAAK;YAChB,KAAK;YACL,IAAI;YACJ,WAAU;YACV,WAAW;;;;;;;;;;;AAInB;KAfgB"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/shield-loader.tsx"],"sourcesContent":["import type React from \"react\";\nimport \"./shield-loader.css\";\nimport { Image } from \"lucide-react\";\n\n/**\n * Ein Ladebildschirm, der ein Schild aus vielen einzelnen Partikeln aufbaut.\n * Jedes Partikel erscheint mit einer leichten Verzögerung und einem \"Rauch\"-Effekt,\n * um einen dynamischen und modernen Ladeeffekt zu erzeugen.\n */\nconst ShieldLoader: React.FC = () => {\n  // Anzahl der Partikel, aus denen das Schild aufgebaut wird.\n  const particleCount = 150;\n\n  return (\n    // Der Hauptcontainer, der den gesamten Bildschirm einnimmt\n    <div className=\"loader-container\">\n      {/* Das Photo-Icon, das hinter dem Schild hervorlugt */}\n      <div className=\"peeking-photo-icon\">\n        <Image strokeWidth={1.5} />\n      </div>\n\n      {/* Der Container, der die Form des Schildes hat und die Partikel enthält */}\n      <div className=\"shield-container\">\n        {/* Generiert die Partikel-Elemente */}\n        {Array.from({ length: particleCount }).map((_, i) => (\n          <div\n            key={i}\n            className=\"particle\"\n            // Deterministische Verzögerung (SPEED UP: Faktor 0.25 -> 0.1, 0.05 -> 0.02)\n            style={{\n              animationDelay: `${(i % 10) * 0.1 + Math.floor(i / 10) * 0.02}s`,\n            }}\n          />\n        ))}\n        {/* Strukturlinien für das Schild */}\n        <div className=\"shield-structure\">\n          <div className=\"structure-line line-1\" />\n          <div className=\"structure-line line-2\" />\n          <div className=\"structure-line line-3\" />\n          <div className=\"structure-line line-4\" />\n        </div>\n      </div>\n      {/* Der Text, der nach einer kurzen Verzögerung in der Mitte erscheint */}\n      <div className=\"loading-text\">LÄDT...</div>\n    </div>\n  );\n};\n\nexport default ShieldLoader;\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA;;;;CAIC,GACD,MAAM,eAAyB;IAC7B,4DAA4D;IAC5D,MAAM,gBAAgB;IAEtB,OACE,2DAA2D;kBAC3D,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,gNAAK;oBAAC,aAAa;;;;;;;;;;;0BAItB,6LAAC;gBAAI,WAAU;;oBAEZ,MAAM,IAAI,CAAC;wBAAE,QAAQ;oBAAc,GAAG,GAAG,CAAC,CAAC,GAAG,kBAC7C,6LAAC;4BAEC,WAAU;4BACV,4EAA4E;4BAC5E,OAAO;gCACL,gBAAgB,GAAG,AAAC,IAAI,KAAM,MAAM,KAAK,KAAK,CAAC,IAAI,MAAM,KAAK,CAAC,CAAC;4BAClE;2BALK;;;;;kCAST,6LAAC;wBAAI,WAAU;;0CACb,6LAAC;gCAAI,WAAU;;;;;;0CACf,6LAAC;gCAAI,WAAU;;;;;;0CACf,6LAAC;gCAAI,WAAU;;;;;;0CACf,6LAAC;gCAAI,WAAU;;;;;;;;;;;;;;;;;;0BAInB,6LAAC;gBAAI,WAAU;0BAAe;;;;;;;;;;;;AAGpC;KArCM;uCAuCS"}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/auth-client.ts"],"sourcesContent":["/**\n * Better Auth Client Configuration\n *\n * React hooks for authentication in client components.\n */\n\nimport { createAuthClient } from \"better-auth/react\";\n\nexport const authClient = createAuthClient({\n    baseURL: process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\",\n});\n\n// Export commonly used hooks and methods\nexport const {\n    signIn,\n    signUp,\n    signOut,\n    useSession,\n    getSession,\n} = authClient;\n\n// Type exports for convenience\nexport type Session = typeof authClient.$Infer.Session;\nexport type User = typeof authClient.$Infer.Session.user;\n"],"names":[],"mappings":";;;;;;;;;;;;;;AASa;AATb;;;;CAIC,GAED;;AAEO,MAAM,aAAa,IAAA,0MAAgB,EAAC;IACvC,SAAS,wEAAmC;AAChD;AAGO,MAAM,EACT,MAAM,EACN,MAAM,EACN,OAAO,EACP,UAAU,EACV,UAAU,EACb,GAAG"}},
    {"offset": {"line": 231, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/app/actions/access-code.ts"],"sourcesContent":["\"use server\";\n\nimport { supabase } from \"@/lib/supabase\";\n\n/**\n * Server Action to verify an access code.\n */\nexport async function verifyAccessCode(code: string) {\n    if (!code || code.trim().length === 0) {\n        return { success: false, message: \"Code is required\" };\n    }\n\n    try {\n        const { data, error } = await supabase\n            .from(\"access_codes\")\n            .select(\"id, is_used\")\n            .eq(\"code\", code.trim())\n            .single();\n\n        if (error || !data) {\n            return { success: false, message: \"Invalid access code\" };\n        }\n\n        if (data.is_used) {\n            return { success: false, message: \"This code has already been used\" };\n        }\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Verification error:\", error);\n        return { success: false, message: \"Failed to verify code\" };\n    }\n}\n\n/**\n * Server Action to consume an access code.\n * Call this AFTER successful user registration.\n */\nexport async function consumeAccessCode(code: string) {\n    if (!code) return { success: false };\n\n    try {\n        const { error } = await supabase\n            .from(\"access_codes\")\n            .update({ is_used: true })\n            .eq(\"code\", code.trim());\n\n        if (error) {\n            console.error(\"Failed to consume code:\", error);\n            return { success: false, error: error.message };\n        }\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Consume error:\", error);\n        return { success: false, error: \"Internal error\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;MAOsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,oDAAA"}},
    {"offset": {"line": 248, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/app/actions/access-code.ts"],"sourcesContent":["\"use server\";\n\nimport { supabase } from \"@/lib/supabase\";\n\n/**\n * Server Action to verify an access code.\n */\nexport async function verifyAccessCode(code: string) {\n    if (!code || code.trim().length === 0) {\n        return { success: false, message: \"Code is required\" };\n    }\n\n    try {\n        const { data, error } = await supabase\n            .from(\"access_codes\")\n            .select(\"id, is_used\")\n            .eq(\"code\", code.trim())\n            .single();\n\n        if (error || !data) {\n            return { success: false, message: \"Invalid access code\" };\n        }\n\n        if (data.is_used) {\n            return { success: false, message: \"This code has already been used\" };\n        }\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Verification error:\", error);\n        return { success: false, message: \"Failed to verify code\" };\n    }\n}\n\n/**\n * Server Action to consume an access code.\n * Call this AFTER successful user registration.\n */\nexport async function consumeAccessCode(code: string) {\n    if (!code) return { success: false };\n\n    try {\n        const { error } = await supabase\n            .from(\"access_codes\")\n            .update({ is_used: true })\n            .eq(\"code\", code.trim());\n\n        if (error) {\n            console.error(\"Failed to consume code:\", error);\n            return { success: false, error: error.message };\n        }\n\n        return { success: true };\n    } catch (error) {\n        console.error(\"Consume error:\", error);\n        return { success: false, error: \"Internal error\" };\n    }\n}\n"],"names":[],"mappings":";;;;;;;MAsCsB,wBAAA,WAAA,GAAA,IAAA,kPAAA,EAAA,8CAAA,uOAAA,EAAA,KAAA,GAAA,6OAAA,EAAA,qDAAA"}},
    {"offset": {"line": 265, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"../../lib/utils\";\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean;\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\";\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nButton.displayName = \"Button\";\n\nexport { Button, buttonVariants };\n"],"names":[],"mappings":";;;;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,IAAA,0KAAG,EACxB,qNACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,2KAAgB,MAC7B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,2KAAI,GAAG;IAC9B,qBACE,6LAAC;QACC,WAAW,IAAA,4HAAE,EAAC,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,OAAO,WAAW,GAAG"}},
    {"offset": {"line": 332, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/input.tsx"],"sourcesContent":["import * as React from \"react\";\n\nimport { cn } from \"../../lib/utils\";\n\nexport interface InputProps\n  extends React.InputHTMLAttributes<HTMLInputElement> {}\n\nconst Input = React.forwardRef<HTMLInputElement, InputProps>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-background px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className,\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nInput.displayName = \"Input\";\n\nexport { Input };\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAKA,MAAM,sBAAQ,2KAAgB,MAC5B,CAAC,EAAE,SAAS,EAAE,IAAI,EAAE,GAAG,OAAO,EAAE;IAC9B,qBACE,6LAAC;QACC,MAAM;QACN,WAAW,IAAA,4HAAE,EACX,wUACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,MAAM,WAAW,GAAG"}},
    {"offset": {"line": 367, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/label.tsx"],"sourcesContent":["import * as React from \"react\";\nimport * as LabelPrimitive from \"@radix-ui/react-label\";\nimport { cva, type VariantProps } from \"class-variance-authority\";\n\nimport { cn } from \"../../lib/utils\";\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\",\n);\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n));\nLabel.displayName = LabelPrimitive.Root.displayName;\n\nexport { Label };\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,gBAAgB,IAAA,0KAAG,EACvB;AAGF,MAAM,sBAAQ,2KAAgB,MAI5B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,4KAAmB;QAClB,KAAK;QACL,WAAW,IAAA,4HAAE,EAAC,iBAAiB;QAC9B,GAAG,KAAK;;;;;;;AAGb,MAAM,WAAW,GAAG,4KAAmB,CAAC,WAAW"}},
    {"offset": {"line": 404, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/AuthScreen.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Mail, Lock, Eye, EyeOff, Loader2, Key } from \"lucide-react\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport { signIn, signUp } from \"@/lib/auth-client\";\nimport { verifyAccessCode, consumeAccessCode } from \"@/app/actions/access-code\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\n\ninterface AuthScreenProps {\n  onSuccess: (user: {\n    id: string;\n    email: string;\n    vaultKeyHash: string | null;\n  }) => void;\n}\n\ntype AuthMode = \"welcome\" | \"login\" | \"register\";\n\nexport function AuthScreen({ onSuccess }: AuthScreenProps) {\n  const [mode, setMode] = useState<AuthMode>(\"welcome\");\n  const [email, setEmail] = useState(\"\");\n  const [password, setPassword] = useState(\"\");\n  const [accessCode, setAccessCode] = useState(\"\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const handleLogin = async () => {\n    if (!email || !password) {\n      setError(\"Bitte E-Mail und Passwort eingeben\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const result = await signIn.email({\n        email,\n        password,\n      });\n\n      if (result.error) {\n        setError(result.error.message || \"Anmeldung fehlgeschlagen\");\n        return;\n      }\n\n      if (result.data?.user) {\n        onSuccess({\n          id: result.data.user.id,\n          email: result.data.user.email,\n          vaultKeyHash:\n            (result.data.user as { vault_key_hash?: string }).vault_key_hash ||\n            null,\n        });\n      }\n    } catch (err) {\n      console.error(\"Login error:\", err);\n      setError(\"Ein Fehler ist aufgetreten. Bitte versuche es erneut.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const handleRegister = async () => {\n    if (!email || !password || !accessCode) {\n      setError(\"Bitte alle Felder ausfüllen\");\n      return;\n    }\n\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      // 1. Verify Access Code\n      const verifyRes = await verifyAccessCode(accessCode);\n      if (!verifyRes.success) {\n        setError(verifyRes.message || \"Ungültiger Zugangscode\");\n        setIsLoading(false);\n        return;\n      }\n\n      // 2. Register\n      const result = await signUp.email({\n        email,\n        password,\n        name: email.split(\"@\")[0], // Default name\n      });\n\n      if (result.error) {\n        setError(result.error.message || \"Registrierung fehlgeschlagen\");\n        setIsLoading(false);\n        return;\n      }\n\n      // 3. Consume Code\n      await consumeAccessCode(accessCode);\n\n      // 4. Success\n      if (result.data?.user) {\n        onSuccess({\n          id: result.data.user.id,\n          email: result.data.user.email,\n          vaultKeyHash: null,\n        });\n      }\n    } catch (err) {\n      console.error(\"Registration error:\", err);\n      setError(\"Ein Fehler ist aufgetreten.\");\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  // Welcome Screen\n  if (mode === \"welcome\") {\n    return (\n      <div className=\"min-h-screen flex flex-col px-6 pt-16 pb-8 safe-area-inset bg-[#FAFBFC]\">\n        <div className=\"flex-1 flex flex-col items-center justify-center text-center\">\n          {/* Logo */}\n          <div className=\"relative w-28 h-28 mb-8 flex items-center justify-center bg-blue-50 dark:bg-blue-900/10 rounded-3xl shadow-lg shadow-blue-500/10 p-6\">\n            <img src=\"/logo.svg\" alt=\"SaecretHeaven Logo\" className=\"w-full h-full object-contain\" />\n          </div>\n\n          <h1 className=\"text-4xl font-bold mb-3 tracking-tight text-gray-900 dark:text-white\">SaecretHeaven</h1>\n          <p className=\"text-blue-600 dark:text-blue-400 max-w-[280px] mb-12 text-lg\">\n            Sichere deine Fotos mit Zero-Knowledge Verschluesselung\n          </p>\n\n          {/* Features */}\n          <div className=\"w-full max-w-[320px] space-y-4 mb-12\">\n            <FeatureItem icon=\"lock\" text=\"Ende-zu-Ende verschluesselt\" />\n            <FeatureItem icon=\"smartphone\" text=\"Multi-Device Sync\" />\n            <FeatureItem icon=\"cloud\" text=\"Dezentrales IPFS Backup\" />\n          </div>\n        </div>\n\n        <div className=\"space-y-4\">\n          <Button\n            onClick={() => setMode(\"login\")}\n            className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-14 text-lg font-semibold shadow-lg shadow-blue-500/20\"\n            size=\"lg\"\n          >\n            Anmelden\n          </Button>\n          \n          <Button\n             onClick={() => setMode(\"register\")}\n             variant=\"outline\"\n             className=\"w-full border-2 border-blue-100 dark:border-blue-900/30 text-blue-600 dark:text-blue-400 rounded-xl h-14 text-lg font-semibold hover:bg-blue-50 dark:hover:bg-blue-900/10\"\n             size=\"lg\"\n          >\n            Account erstellen\n          </Button>\n        </div>\n      </div>\n    );\n  }\n\n  // Login/Register Form\n  const isRegister = mode === \"register\";\n\n  return (\n    <div className=\"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]\">\n      {/* Header */}\n      <button\n        onClick={() => setMode(\"welcome\")}\n        className=\"self-start text-blue-600 mb-8 ios-tap-target flex items-center gap-2 font-medium hover:underline\"\n      >\n        ← Zurueck\n      </button>\n\n      <div className=\"flex-1\">\n        <h1 className=\"text-3xl font-bold mb-2 tracking-tight text-gray-900 dark:text-white\">\n          {isRegister ? \"Account erstellen\" : \"Willkommen zurueck\"}\n        </h1>\n        <p className=\"text-blue-600 dark:text-blue-400 mb-8 font-medium\">\n          {isRegister ? \"Zugang nur mit Einladungscode\" : \"Melde dich an, um auf deinen Vault zuzugreifen\"}\n        </p>\n\n        {/* Form */}\n        <div className=\"space-y-6\">\n          \n          {isRegister && (\n             <div className=\"space-y-2\">\n               <Label htmlFor=\"code\" className=\"sr-only\">Zugangscode</Label>\n               <div className=\"relative\">\n                 <div className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 flex items-center justify-center\">\n                    <Key className=\"w-5 h-5 text-gray-400\" />\n                 </div>\n                 <Input\n                   id=\"code\"\n                   type=\"text\"\n                   autoCapitalize=\"characters\"\n                   value={accessCode}\n                   onChange={(e) => setAccessCode(e.target.value.toUpperCase())}\n                   placeholder=\"Zugangscode\"\n                   className=\"pl-12 h-14 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-xl text-lg shadow-sm font-mono tracking-wider\"\n                 />\n               </div>\n             </div>\n          )}\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"email\" className=\"sr-only\">E-Mail</Label>\n            <div className=\"relative\">\n              <Mail className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n              <Input\n                id=\"email\"\n                type=\"email\"\n                value={email}\n                onChange={(e) => setEmail(e.target.value)}\n                placeholder=\"E-Mail\"\n                className=\"pl-12 h-14 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-xl text-lg shadow-sm\"\n              />\n            </div>\n          </div>\n\n          <div className=\"space-y-2\">\n            <Label htmlFor=\"password\" className=\"sr-only\">Passwort</Label>\n            <div className=\"relative\">\n              <Lock className=\"absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400\" />\n              <Input\n                id=\"password\"\n                type={showPassword ? \"text\" : \"password\"}\n                value={password}\n                onChange={(e) => setPassword(e.target.value)}\n                placeholder=\"Passwort\"\n                className=\"pl-12 pr-12 h-14 bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-xl text-lg shadow-sm\"\n              />\n              <button\n                type=\"button\"\n                onClick={() => setShowPassword(!showPassword)}\n                className=\"absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 z-10\"\n              >\n                {showPassword ? (\n                  <EyeOff className=\"w-5 h-5\" />\n                ) : (\n                  <Eye className=\"w-5 h-5\" />\n                )}\n              </button>\n            </div>\n          </div>\n\n          {error && (\n            <div className=\"relative py-4 px-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-xl\">\n              <p className=\"text-red-600 dark:text-red-400 text-center text-sm font-medium\">\n                {error}\n              </p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Submit Button */}\n      <div className=\"space-y-4\">\n        <Button\n          onClick={isRegister ? handleRegister : handleLogin}\n          disabled={isLoading}\n          className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-14 text-lg font-semibold shadow-lg shadow-blue-500/20\"\n          size=\"lg\"\n        >\n          {isLoading ? (\n            <Loader2 className=\"w-6 h-6 animate-spin\" />\n          ) : (\n            isRegister ? \"Kostenlos registrieren\" : \"Anmelden\"\n          )}\n        </Button>\n      </div>\n\n    </div>\n  );\n}\n\nfunction FeatureItem({\n  icon,\n  text,\n}: {\n  icon: \"lock\" | \"smartphone\" | \"cloud\";\n  text: string;\n}) {\n  return (\n    <div className=\"relative group bg-white dark:bg-white/5 rounded-2xl p-1 shadow-sm border border-blue-100 dark:border-white/10\">\n      <div className=\"relative z-10 flex items-center gap-4 p-3\">\n        <div className=\"w-10 h-10 rounded-full bg-blue-50 dark:bg-blue-500/20 flex items-center justify-center\">\n          <CustomIcon name={icon} size={20} className=\"text-blue-600 dark:text-blue-400\" />\n        </div>\n        <span className=\"text-base font-medium text-blue-900 dark:text-blue-100\">{text}</span>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 949, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/crypto.ts"],"sourcesContent":["/**\n * Crypto Layer - Client-Side Encryption mit tweetnacl\n * Alle Daten werden VOR dem Upload verschlüsselt\n */\n\nimport nacl from 'tweetnacl';\nimport { encodeBase64, decodeBase64 } from 'tweetnacl-util';\nimport {\n    isTauri,\n    storeKeyNative,\n    loadKeyNative,\n    clearKeyNative\n} from './storage/native-keychain';\n\nexport interface EncryptionKey {\n    publicKey: Uint8Array;\n    secretKey: Uint8Array;\n}\n\nexport interface EncryptedData {\n    ciphertext: string; // Base64\n    nonce: string; // Base64\n}\n\n/**\n * Generiert ein neues Encryption Key Pair\n */\nexport function generateKeyPair(): EncryptionKey {\n    const keyPair = nacl.box.keyPair();\n    return {\n        publicKey: keyPair.publicKey,\n        secretKey: keyPair.secretKey,\n    };\n}\n\n/**\n * Generiert eine 12-Wort Recovery Phrase aus dem Secret Key\n * Vereinfachte Version - in Production würde man BIP39 verwenden\n */\nexport function keyToRecoveryPhrase(secretKey: Uint8Array): string {\n    const base64 = encodeBase64(secretKey);\n    // Für MVP: Base64 in Chunks aufteilen\n    // TODO: BIP39 Wordlist für bessere UX\n    return base64.match(/.{1,8}/g)?.join('-') || base64;\n}\n\n/**\n * Recovered Secret Key aus Recovery Phrase\n */\nexport function recoveryPhraseToKey(phrase: string): Uint8Array {\n    const base64 = phrase.replace(/-/g, '');\n    return decodeBase64(base64);\n}\n\n/**\n * Verschlüsselt Daten (Uint8Array) mit dem Secret Key\n */\nexport function encrypt(\n    data: Uint8Array,\n    secretKey: Uint8Array\n): EncryptedData {\n    const nonce = nacl.randomBytes(nacl.secretbox.nonceLength);\n    const ciphertext = nacl.secretbox(data, nonce, secretKey);\n\n    return {\n        ciphertext: encodeBase64(ciphertext),\n        nonce: encodeBase64(nonce),\n    };\n}\n\n/**\n * Entschlüsselt Daten\n */\nexport function decrypt(\n    encrypted: EncryptedData,\n    secretKey: Uint8Array\n): Uint8Array | null {\n    const ciphertext = decodeBase64(encrypted.ciphertext);\n    const nonce = decodeBase64(encrypted.nonce);\n\n    const decrypted = nacl.secretbox.open(ciphertext, nonce, secretKey);\n    return decrypted;\n}\n\n/**\n * Verschlüsselt ein File (Blob/File) und gibt encrypted Blob zurück\n */\nexport async function encryptFile(\n    file: File,\n    secretKey: Uint8Array\n): Promise<{ encrypted: Blob; nonce: string }> {\n    const arrayBuffer = await file.arrayBuffer();\n    const data = new Uint8Array(arrayBuffer);\n\n    const encrypted = encrypt(data, secretKey);\n\n    // Konvertiere Base64 zurück zu Blob für Storage\n    const ciphertextBytes = decodeBase64(encrypted.ciphertext);\n    const blob = new Blob([ciphertextBytes], { type: 'application/octet-stream' });\n\n    return {\n        encrypted: blob,\n        nonce: encrypted.nonce,\n    };\n}\n\n/**\n * Entschlüsselt ein Blob zurück zum Original\n */\nexport async function decryptFile(\n    encryptedBlob: Blob,\n    nonce: string,\n    secretKey: Uint8Array,\n    originalMimeType: string\n): Promise<Blob | null> {\n    const arrayBuffer = await encryptedBlob.arrayBuffer();\n    const ciphertext = new Uint8Array(arrayBuffer);\n\n    const encrypted: EncryptedData = {\n        ciphertext: encodeBase64(ciphertext),\n        nonce,\n    };\n\n    const decrypted = decrypt(encrypted, secretKey);\n    if (!decrypted) return null;\n\n    return new Blob([decrypted], { type: originalMimeType });\n}\n\n/**\n * Generiert einen stabilen Hash aus dem Secret Key für die Gruppierung von Geräten/Daten\n */\nexport async function getUserKeyHash(secretKey: Uint8Array): Promise<string> {\n    const msgUint8 = new TextEncoder().encode(encodeBase64(secretKey));\n    const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);\n    const hashArray = Array.from(new Uint8Array(hashBuffer));\n    return hashArray.map(b => b.toString(16).padStart(2, '0')).join('').slice(0, 16);\n}\n\n/**\n * Speichert Secret Key verschlüsselt im LocalStorage\n * Verwendet ein Master Password (optional für MVP)\n */\nexport function saveKeyToStorage(secretKey: Uint8Array, password?: string): void {\n    if (password) {\n        // TODO: Key Derivation mit PBKDF2\n        // Für MVP: Direkt speichern\n    }\n\n    const encoded = encodeBase64(secretKey);\n    localStorage.setItem('photovault_secret_key', encoded);\n}\n\n/**\n * Lädt Secret Key aus LocalStorage\n */\nexport function loadKeyFromStorage(): Uint8Array | null {\n    const encoded = localStorage.getItem('photovault_secret_key');\n    if (!encoded) return null;\n\n    try {\n        return decodeBase64(encoded);\n    } catch {\n        return null;\n    }\n}\n\n/**\n * Löscht Key aus Storage (Logout)\n */\nexport function clearKeyFromStorage(): void {\n    localStorage.removeItem('photovault_secret_key');\n}\n\n/**\n * Async: Speichert Secret Key mit Platform-Detection\n *\n * - Tauri Desktop: OS native keychain (macOS Keychain, Windows Credential Manager)\n * - PWA/Browser: localStorage (fallback)\n *\n * @param secretKey - The 32-byte encryption key\n */\nexport async function saveKeyToStorageAsync(secretKey: Uint8Array): Promise<void> {\n    if (isTauri()) {\n        // Use native keychain on desktop\n        await storeKeyNative(secretKey);\n        console.log('[Crypto] Secret key stored in native keychain');\n    } else {\n        // Fallback to localStorage for PWA/browser\n        saveKeyToStorage(secretKey);\n        console.log('[Crypto] Secret key stored in localStorage');\n    }\n}\n\n/**\n * Async: Lädt Secret Key mit Platform-Detection\n *\n * @returns The secret key or null if not found\n */\nexport async function loadKeyFromStorageAsync(): Promise<Uint8Array | null> {\n    if (isTauri()) {\n        // Try native keychain first\n        const key = await loadKeyNative();\n        if (key) {\n            console.log('[Crypto] Secret key loaded from native keychain');\n            return key;\n        }\n    }\n\n    // Fallback to localStorage\n    const key = loadKeyFromStorage();\n    if (key) {\n        console.log('[Crypto] Secret key loaded from localStorage');\n    }\n    return key;\n}\n\n/**\n * Async: Löscht Key aus Storage mit Platform-Detection\n */\nexport async function clearKeyFromStorageAsync(): Promise<void> {\n    if (isTauri()) {\n        await clearKeyNative();\n        console.log('[Crypto] Secret key cleared from native keychain');\n    }\n\n    // Always clear localStorage as well (migration case)\n    clearKeyFromStorage();\n    console.log('[Crypto] Secret key cleared from localStorage');\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1119, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/textarea.tsx"],"sourcesContent":["import * as React from \"react\";\n\nimport { cn } from \"../../lib/utils\";\n\nexport interface TextareaProps\n  extends React.TextareaHTMLAttributes<HTMLTextAreaElement> {}\n\nconst Textarea = React.forwardRef<HTMLTextAreaElement, TextareaProps>(\n  ({ className, ...props }, ref) => {\n    return (\n      <textarea\n        className={cn(\n          \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n          className,\n        )}\n        ref={ref}\n        {...props}\n      />\n    );\n  },\n);\nTextarea.displayName = \"Textarea\";\n\nexport { Textarea };\n"],"names":[],"mappings":";;;;;AAAA;AAEA;;;;AAKA,MAAM,yBAAW,2KAAgB,MAC/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE;IACxB,qBACE,6LAAC;QACC,WAAW,IAAA,4HAAE,EACX,gQACA;QAEF,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;;AAEF,SAAS,WAAW,GAAG"}},
    {"offset": {"line": 1153, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/UnlockVaultScreen.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Info } from \"lucide-react\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport {\n    recoveryPhraseToKey,\n    saveKeyToStorage,\n    getUserKeyHash,\n} from \"@/lib/crypto\";\nimport { Button } from \"@/components/ui/button\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Loader2, Shield, LogOut } from \"lucide-react\";\n\ninterface UnlockVaultScreenProps {\n    userEmail: string;\n    expectedKeyHash: string | null;\n    onUnlock: (secretKey: Uint8Array, keyHash: string) => void;\n    onCreateNewVault: () => void;\n    onLogout: () => void;\n}\n\nexport function UnlockVaultScreen({\n    userEmail,\n    expectedKeyHash,\n    onUnlock,\n    onCreateNewVault,\n    onLogout,\n}: UnlockVaultScreenProps) {\n    const [phrase, setPhrase] = useState(\"\");\n    const [isUnlocking, setIsUnlocking] = useState(false);\n    const [error, setError] = useState<string | null>(null);\n\n    const handleUnlock = async () => {\n        if (!phrase.trim()) {\n            setError(\"Bitte gib deine Recovery-Phrase ein\");\n            return;\n        }\n\n        setIsUnlocking(true);\n        setError(null);\n\n        try {\n            // Normalize input\n            const normalizedPhrase = phrase\n                .trim()\n                .replace(/[\\s\\n]+/g, \"-\")\n                .replace(/-+/g, \"-\");\n\n            // Try to decode the key\n            const secretKey = recoveryPhraseToKey(normalizedPhrase);\n\n            if (!secretKey || secretKey.length !== 32) {\n                setError(\"Ungueltige Recovery-Phrase\");\n                setIsUnlocking(false);\n                return;\n            }\n\n            // Calculate key hash\n            const keyHash = await getUserKeyHash(secretKey);\n\n            // If user already has a vault, verify the key hash matches\n            if (expectedKeyHash && keyHash !== expectedKeyHash) {\n                setError(\n                    \"Diese Recovery-Phrase gehoert nicht zu diesem Konto. Bitte ueberpruefe deine Eingabe.\"\n                );\n                setIsUnlocking(false);\n                return;\n            }\n\n            // Save key to local storage\n            saveKeyToStorage(secretKey);\n\n            // Success\n            onUnlock(secretKey, keyHash);\n        } catch (err) {\n            console.error(\"Unlock error:\", err);\n            setError(\"Ungueltige Recovery-Phrase. Bitte ueberpruefe deine Eingabe.\");\n        } finally {\n            setIsUnlocking(false);\n        }\n    };\n\n    return (\n        <div className=\"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]\">\n            {/* Header */}\n            <div className=\"flex items-center justify-between mb-8\">\n                <div className=\"text-sm text-gray-500\">\n                    Angemeldet als\n                    <br />\n                    <span className=\"text-blue-600 font-bold\">{userEmail}</span>\n                </div>\n                <button\n                    onClick={onLogout}\n                    className=\"text-red-500 text-[15px] font-medium hover:text-red-600 flex items-center gap-1\"\n                >\n                    <LogOut className=\"w-4 h-4\" />\n                    Abmelden\n                </button>\n            </div>\n\n            <div className=\"flex-1 flex flex-col\">\n                {/* Icon & Title */}\n                <div className=\"flex flex-col items-center text-center mb-8\">\n                    <div className=\"mb-6 p-4 bg-blue-50 dark:bg-blue-900/10 rounded-full\">\n                        <img src=\"/logo.svg\" alt=\"SaecretHeaven\" className=\"w-16 h-16 object-contain\" />\n                    </div>\n                    <h1 className=\"text-3xl font-bold mb-2 text-gray-900 dark:text-white\">\n                        Vault entsperren\n                    </h1>\n                    <p className=\"text-[15px] text-gray-500 max-w-[300px]\">\n                        {expectedKeyHash\n                            ? \"Gib deine Recovery-Phrase ein, um auf deine verschluesselten Fotos zuzugreifen\"\n                            : \"Du hast noch keinen Vault. Erstelle einen neuen oder stelle einen bestehenden wieder her.\"}\n                    </p>\n                </div>\n\n                {/* Recovery Phrase Input */}\n                <div className=\"mb-6 space-y-2\">\n                    <Textarea\n                        value={phrase}\n                        onChange={(e) => {\n                            setPhrase(e.target.value);\n                            setError(null);\n                        }}\n                        placeholder=\"abc123XY-def456AB-...\"\n                        className=\"min-h-[120px] bg-white dark:bg-gray-800 border-gray-200 dark:border-gray-700 rounded-xl text-base p-4 resize-none\"\n                    />\n                    <p className=\"text-[12px] text-gray-400 px-1 text-center\">\n                        Mit Bindestrichen oder Leerzeichen getrennt (12 Wörter)\n                    </p>\n                </div>\n\n                {error && (\n                    <div className=\"mb-6 p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-xl\">\n                         <p className=\"text-[14px] text-red-600 dark:text-red-400 text-center font-medium\">{error}</p>\n                    </div>\n                )}\n\n                {/* Info Box */}\n                <div className=\"mb-6\">\n                    <div className=\"p-4 bg-blue-50 dark:bg-blue-900/10 border border-blue-100 dark:border-blue-900/30 rounded-xl flex items-start gap-3\">\n                        <Info className=\"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0\" />\n                        <div>\n                            <p className=\"text-[15px] font-medium text-blue-900 dark:text-blue-100 mb-1\">\n                                Warum brauche ich die Phrase?\n                            </p>\n                            <p className=\"text-[13px] text-blue-700 dark:text-blue-300\">\n                                Deine Fotos sind lokal verschluesselt. Nur mit der Recovery-Phrase\n                                kannst du sie entschluesseln. Wir speichern sie niemals.\n                            </p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            {/* Buttons */}\n            <div className=\"space-y-4\">\n                <Button\n                    onClick={handleUnlock}\n                    disabled={isUnlocking || !phrase.trim()}\n                    className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-14 text-lg font-semibold shadow-lg shadow-blue-500/20\"\n                    size=\"lg\"\n                >\n                    {isUnlocking ? (\n                        <Loader2 className=\"w-6 h-6 animate-spin\" />\n                    ) : (\n                        \"Vault entsperren\"\n                    )}\n                </Button>\n\n                {!expectedKeyHash && (\n                    <button\n                        onClick={onCreateNewVault}\n                        className=\"w-full py-2 text-blue-600 text-[17px] hover:underline font-medium\"\n                    >\n                        Neuen Vault erstellen\n                    </button>\n                )}\n            </div>\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1463, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/ui/switch.tsx"],"sourcesContent":["import * as React from \"react\";\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\";\n\nimport { cn } from \"../../lib/utils\";\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-[20px] w-[36px] shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className,\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\",\n      )}\n    />\n  </SwitchPrimitives.Root>\n));\nSwitch.displayName = SwitchPrimitives.Root.displayName;\n\nexport { Switch };\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAEA;;;;;AAEA,MAAM,uBAAS,2KAAgB,MAG7B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,6LAAC,6KAAqB;QACpB,WAAW,IAAA,4HAAE,EACX,yYACA;QAED,GAAG,KAAK;QACT,KAAK;kBAEL,cAAA,6LAAC,8KAAsB;YACrB,WAAW,IAAA,4HAAE,EACX;;;;;;;;;;;;AAKR,OAAO,WAAW,GAAG,6KAAqB,CAAC,WAAW"}},
    {"offset": {"line": 1504, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/hooks/use-encryption.ts"],"sourcesContent":["/**\n * useEncryption Hook - Key Management\n */\n\n\"use client\";\n\nimport { useState, useEffect, useCallback } from \"react\";\nimport {\n  generateKeyPair,\n  saveKeyToStorage,\n  loadKeyFromStorage,\n  clearKeyFromStorage,\n  keyToRecoveryPhrase,\n  recoveryPhraseToKey,\n  getUserKeyHash,\n} from \"@/lib/crypto\";\n\nexport function useEncryption() {\n  const [secretKey, setSecretKey] = useState<Uint8Array | null>(null);\n  const [isInitialized, setIsInitialized] = useState(false);\n  const [recoveryPhrase, setRecoveryPhrase] = useState<string | null>(null);\n  const [isGeneratingKey, setIsGeneratingKey] = useState(false);\n  const [userKeyHash, setUserKeyHash] = useState<string | null>(null);\n\n  // Load key on mount\n  useEffect(() => {\n    const loadKey = async () => {\n      const key = loadKeyFromStorage();\n      if (key) {\n        setSecretKey(key);\n        setRecoveryPhrase(keyToRecoveryPhrase(key));\n        const hash = await getUserKeyHash(key);\n        setUserKeyHash(hash);\n      }\n      setIsInitialized(true);\n    };\n    loadKey();\n  }, []);\n\n  // Generate new key\n  const generateNewKey = useCallback((): Promise<string> => {\n    return new Promise((resolve) => {\n      setIsGeneratingKey(true);\n\n      // Simulate key generation time\n      setTimeout(async () => {\n        const keyPair = generateKeyPair();\n        const key = keyPair.secretKey;\n\n        setSecretKey(key);\n        saveKeyToStorage(key);\n\n        const phrase = keyToRecoveryPhrase(key);\n        setRecoveryPhrase(phrase);\n\n        const hash = await getUserKeyHash(key);\n        setUserKeyHash(hash);\n\n        setIsGeneratingKey(false);\n        resolve(phrase);\n      }, 1500);\n    });\n  }, []);\n\n  // Restore from recovery phrase\n  const restoreFromPhrase = useCallback((phrase: string) => {\n    try {\n      const key = recoveryPhraseToKey(phrase);\n      setSecretKey(key);\n      saveKeyToStorage(key);\n      setRecoveryPhrase(phrase);\n      return true;\n    } catch {\n      return false;\n    }\n  }, []);\n\n  // Logout / Clear key\n  const clearKey = useCallback(() => {\n    setSecretKey(null);\n    setRecoveryPhrase(null);\n    clearKeyFromStorage();\n  }, []);\n\n  return {\n    secretKey,\n    isInitialized,\n    hasKey: !!secretKey,\n    recoveryPhrase,\n    userKeyHash,\n    isGeneratingKey,\n    generateNewKey,\n    restoreFromPhrase,\n    clearKey,\n  };\n}\n"],"names":[],"mappings":";;;;AAMA;AACA;;AAPA;;CAEC,GAED;;;AAaO,SAAS;;IACd,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,yKAAQ,EAAoB;IAC9D,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IACnD,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,yKAAQ,EAAgB;IACpE,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,yKAAQ,EAAgB;IAE9D,oBAAoB;IACpB,IAAA,0KAAS;mCAAC;YACR,MAAM;mDAAU;oBACd,MAAM,MAAM,IAAA,6IAAkB;oBAC9B,IAAI,KAAK;wBACP,aAAa;wBACb,kBAAkB,IAAA,8IAAmB,EAAC;wBACtC,MAAM,OAAO,MAAM,IAAA,yIAAc,EAAC;wBAClC,eAAe;oBACjB;oBACA,iBAAiB;gBACnB;;YACA;QACF;kCAAG,EAAE;IAEL,mBAAmB;IACnB,MAAM,iBAAiB,IAAA,4KAAW;qDAAC;YACjC,OAAO,IAAI;6DAAQ,CAAC;oBAClB,mBAAmB;oBAEnB,+BAA+B;oBAC/B;qEAAW;4BACT,MAAM,UAAU,IAAA,0IAAe;4BAC/B,MAAM,MAAM,QAAQ,SAAS;4BAE7B,aAAa;4BACb,IAAA,2IAAgB,EAAC;4BAEjB,MAAM,SAAS,IAAA,8IAAmB,EAAC;4BACnC,kBAAkB;4BAElB,MAAM,OAAO,MAAM,IAAA,yIAAc,EAAC;4BAClC,eAAe;4BAEf,mBAAmB;4BACnB,QAAQ;wBACV;oEAAG;gBACL;;QACF;oDAAG,EAAE;IAEL,+BAA+B;IAC/B,MAAM,oBAAoB,IAAA,4KAAW;wDAAC,CAAC;YACrC,IAAI;gBACF,MAAM,MAAM,IAAA,8IAAmB,EAAC;gBAChC,aAAa;gBACb,IAAA,2IAAgB,EAAC;gBACjB,kBAAkB;gBAClB,OAAO;YACT,EAAE,OAAM;gBACN,OAAO;YACT;QACF;uDAAG,EAAE;IAEL,qBAAqB;IACrB,MAAM,WAAW,IAAA,4KAAW;+CAAC;YAC3B,aAAa;YACb,kBAAkB;YAClB,IAAA,8IAAmB;QACrB;8CAAG,EAAE;IAEL,OAAO;QACL;QACA;QACA,QAAQ,CAAC,CAAC;QACV;QACA;QACA;QACA;QACA;QACA;IACF;AACF;GA9EgB"}},
    {"offset": {"line": 1608, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/VaultSetupScreen.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport ShieldLoader from \"@/components/ui/shield-loader\";\nimport { useEncryption } from \"@/hooks/use-encryption\";\nimport { Check, Copy, CheckCircle, Smartphone, Cloud, Lock } from \"lucide-react\";\n\ninterface VaultSetupScreenProps {\n    userId: string;\n    onComplete: (keyHash: string) => void;\n    onBack: () => void;\n}\n\ntype SetupStep = \"intro\" | \"generating\" | \"phrase\" | \"confirm\";\n\nexport function VaultSetupScreen({ userId, onComplete, onBack }: VaultSetupScreenProps) {\n    const [step, setStep] = useState<SetupStep>(\"intro\");\n    const [phraseConfirmed, setPhraseConfirmed] = useState(false);\n    const [copied, setCopied] = useState(false);\n\n    const { isGeneratingKey, generateNewKey, recoveryPhrase, userKeyHash } = useEncryption();\n\n    const handleCreateVault = async () => {\n        setStep(\"generating\");\n        try {\n            await generateNewKey();\n            setStep(\"phrase\");\n        } catch (err) {\n            console.error(\"Failed to generate key:\", err);\n            setStep(\"intro\");\n        }\n    };\n\n    const handleCopyPhrase = async () => {\n        if (recoveryPhrase) {\n            await navigator.clipboard.writeText(recoveryPhrase);\n            setCopied(true);\n            setTimeout(() => setCopied(false), 2000);\n        }\n    };\n\n    const handleConfirmPhrase = () => {\n        if (userKeyHash) {\n            onComplete(userKeyHash);\n        }\n    };\n\n    // Parse phrase into words for display\n    const phraseWords = recoveryPhrase?.split(\"-\").slice(0, 12) || [];\n\n    // Show loader during key generation\n    if (step === \"generating\" || isGeneratingKey) {\n        return <ShieldLoader />;\n    }\n\n    // Intro step\n    if (step === \"intro\") {\n        return (\n            <div className=\"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]\">\n            <button\n                onClick={onBack}\n                className=\"self-start text-blue-600 text-[17px] mb-8 hover:underline font-medium\"\n            >\n                ← Zurueck\n            </button>\n\n                <div className=\"flex-1 flex flex-col items-center justify-center text-center\">\n                    <div className=\"mb-6 p-4 bg-blue-100 dark:bg-blue-900/20 rounded-full\">\n                        <CustomIcon name=\"key\" size={64} className=\"text-blue-600\" />\n                    </div>\n\n                    <h1 className=\"text-3xl font-bold mb-3 text-gray-900 dark:text-white\">\n                        Erstelle deinen Vault\n                    </h1>\n                    <p className=\"text-[17px] text-blue-600 dark:text-blue-400 max-w-[300px] mb-8 font-medium\">\n                        Dein persoenlicher Verschluesselungsschluessel schuetzt alle deine Fotos\n                    </p>\n\n                    {/* Features */}\n                    <div className=\"w-full max-w-[320px] space-y-4 mb-8\">\n                        <div className=\"p-4 bg-white dark:bg-white/5 rounded-2xl shadow-sm border border-gray-100 dark:border-white/10 flex items-start gap-4\">\n                            <div className=\"p-2 bg-green-100 dark:bg-green-900/20 rounded-full\">\n                                <Lock className=\"w-6 h-6 text-green-600\" />\n                            </div>\n                            <div className=\"text-left\">\n                                <p className=\"text-[16px] font-semibold text-gray-900 dark:text-white\">Zero-Knowledge</p>\n                                <p className=\"text-[13px] text-gray-500\">\n                                    Nur du kannst deine Fotos entschluesseln\n                                </p>\n                            </div>\n                        </div>\n\n                        <div className=\"p-4 bg-white dark:bg-white/5 rounded-2xl shadow-sm border border-gray-100 dark:border-white/10 flex items-start gap-4\">\n                            <div className=\"p-2 bg-blue-100 dark:bg-blue-900/20 rounded-full\">\n                                <CheckCircle className=\"w-6 h-6 text-blue-600\" />\n                            </div>\n                            <div className=\"text-left\">\n                                <p className=\"text-[16px] font-semibold text-gray-900 dark:text-white\">Recovery-Phrase</p>\n                                <p className=\"text-[13px] text-gray-500\">\n                                    12 Woerter zum Wiederherstellen\n                                </p>\n                            </div>\n                        </div>\n\n                        <div className=\"p-4 bg-white dark:bg-white/5 rounded-2xl shadow-sm border border-gray-100 dark:border-white/10 flex items-start gap-4\">\n                            <div className=\"p-2 bg-orange-100 dark:bg-orange-900/20 rounded-full\">\n                                <Smartphone className=\"w-6 h-6 text-orange-500\" />\n                            </div>\n                            <div className=\"text-left\">\n                                <p className=\"text-[16px] font-semibold text-gray-900 dark:text-white\">Multi-Device</p>\n                                <p className=\"text-[13px] text-gray-500\">\n                                    Synchronisiere all deine Geraete\n                                </p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <Button\n                    onClick={handleCreateVault}\n                    className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-14 text-lg font-semibold shadow-lg shadow-blue-500/20\"\n                    size=\"lg\"\n                >\n                    Vault erstellen\n                </Button>\n            </div>\n        );\n    }\n\n    // Show recovery phrase\n    if (step === \"phrase\") {\n        return (\n        <div className=\"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]\">\n            <div className=\"flex-1\">\n                <div className=\"text-center mb-6\">\n                    <h1 className=\"text-3xl font-bold mb-2 text-gray-900 dark:text-white\">\n                        Deine Phrase\n                    </h1>\n                    <p className=\"text-[15px] text-gray-500\">\n                        Notiere diese Woerter sicher. Du brauchst sie zur Wiederherstellung.\n                    </p>\n                </div>\n\n                {/* 12 words in Grid */}\n                <div className=\"grid grid-cols-2 gap-3 mb-6\">\n                    {phraseWords.map((word, index) => (\n                        <div\n                            key={index}\n                            className=\"p-3 text-center bg-white dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/10 shadow-sm\"\n                        >\n                            <span className=\"text-[11px] text-gray-400 block mb-0.5 uppercase tracking-wider\">\n                                {index + 1}\n                            </span>\n                            <span className=\"text-[16px] font-mono font-medium text-gray-900 dark:text-white break-all\">\n                                {word}\n                            </span>\n                        </div>\n                    ))}\n                </div>\n\n                {/* Copy button */}\n                <button\n                    onClick={handleCopyPhrase}\n                    className=\"w-full py-3 text-blue-600 text-[16px] hover:underline mb-4 font-medium flex items-center justify-center gap-2\"\n                >\n                    <Copy className=\"w-4 h-4\" />\n                    {copied ? \"Kopiert!\" : \"Phrase kopieren\"}\n                </button>\n\n                {/* Warning Card */}\n                <div className=\"mb-6\">\n                    <div className=\"p-4 bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-900/30 rounded-xl\">\n                        <p className=\"text-[13px] text-red-600 dark:text-red-400 text-center font-medium\">\n                            Teile diese Woerter niemals mit anderen. Wer sie hat, kann auf deine\n                            Fotos zugreifen.\n                        </p>\n                    </div>\n                </div>\n\n                {/* Confirmation Toggle */}\n                <div className=\"mb-8\">\n                    <div className=\"p-4 bg-white dark:bg-white/5 rounded-xl border border-gray-100 dark:border-white/10 shadow-sm flex items-center justify-between\">\n                         <span className=\"text-[17px] font-medium text-gray-900 dark:text-white\">\n                            Sicher gespeichert?\n                        </span>\n                        <Switch\n                            checked={phraseConfirmed}\n                            onCheckedChange={setPhraseConfirmed}\n                        />\n                    </div>\n                </div>\n            </div>\n\n            <Button\n                onClick={handleConfirmPhrase}\n                disabled={!phraseConfirmed}\n                className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-14 text-lg font-semibold shadow-lg shadow-blue-500/20\"\n                size=\"lg\"\n            >\n                Weiter\n            </Button>\n        </div>\n        );\n    }\n\n    return null;\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;;;AARA;;;;;;;;AAkBO,SAAS,iBAAiB,EAAE,MAAM,EAAE,UAAU,EAAE,MAAM,EAAyB;;IAClF,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,yKAAQ,EAAY;IAC5C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,IAAA,yKAAQ,EAAC;IACvD,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,yKAAQ,EAAC;IAErC,MAAM,EAAE,eAAe,EAAE,cAAc,EAAE,cAAc,EAAE,WAAW,EAAE,GAAG,IAAA,qJAAa;IAEtF,MAAM,oBAAoB;QACtB,QAAQ;QACR,IAAI;YACA,MAAM;YACN,QAAQ;QACZ,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,2BAA2B;YACzC,QAAQ;QACZ;IACJ;IAEA,MAAM,mBAAmB;QACrB,IAAI,gBAAgB;YAChB,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC;YACpC,UAAU;YACV,WAAW,IAAM,UAAU,QAAQ;QACvC;IACJ;IAEA,MAAM,sBAAsB;QACxB,IAAI,aAAa;YACb,WAAW;QACf;IACJ;IAEA,sCAAsC;IACtC,MAAM,cAAc,gBAAgB,MAAM,KAAK,MAAM,GAAG,OAAO,EAAE;IAEjE,oCAAoC;IACpC,IAAI,SAAS,gBAAgB,iBAAiB;QAC1C,qBAAO,6LAAC,0JAAY;;;;;IACxB;IAEA,aAAa;IACb,IAAI,SAAS,SAAS;QAClB,qBACI,6LAAC;YAAI,WAAU;;8BACf,6LAAC;oBACG,SAAS;oBACT,WAAU;8BACb;;;;;;8BAIG,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAI,WAAU;sCACX,cAAA,6LAAC,2JAAU;gCAAC,MAAK;gCAAM,MAAM;gCAAI,WAAU;;;;;;;;;;;sCAG/C,6LAAC;4BAAG,WAAU;sCAAwD;;;;;;sCAGtE,6LAAC;4BAAE,WAAU;sCAA8E;;;;;;sCAK3F,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAI,WAAU;sDACX,cAAA,6LAAC,6MAAI;gDAAC,WAAU;;;;;;;;;;;sDAEpB,6LAAC;4CAAI,WAAU;;8DACX,6LAAC;oDAAE,WAAU;8DAA0D;;;;;;8DACvE,6LAAC;oDAAE,WAAU;8DAA4B;;;;;;;;;;;;;;;;;;8CAMjD,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAI,WAAU;sDACX,cAAA,6LAAC,6OAAW;gDAAC,WAAU;;;;;;;;;;;sDAE3B,6LAAC;4CAAI,WAAU;;8DACX,6LAAC;oDAAE,WAAU;8DAA0D;;;;;;8DACvE,6LAAC;oDAAE,WAAU;8DAA4B;;;;;;;;;;;;;;;;;;8CAMjD,6LAAC;oCAAI,WAAU;;sDACX,6LAAC;4CAAI,WAAU;sDACX,cAAA,6LAAC,+NAAU;gDAAC,WAAU;;;;;;;;;;;sDAE1B,6LAAC;4CAAI,WAAU;;8DACX,6LAAC;oDAAE,WAAU;8DAA0D;;;;;;8DACvE,6LAAC;oDAAE,WAAU;8DAA4B;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;8BAQzD,6LAAC,+IAAM;oBACH,SAAS;oBACT,WAAU;oBACV,MAAK;8BACR;;;;;;;;;;;;IAKb;IAEA,uBAAuB;IACvB,IAAI,SAAS,UAAU;QACnB,qBACA,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAI,WAAU;;8CACX,6LAAC;oCAAG,WAAU;8CAAwD;;;;;;8CAGtE,6LAAC;oCAAE,WAAU;8CAA4B;;;;;;;;;;;;sCAM7C,6LAAC;4BAAI,WAAU;sCACV,YAAY,GAAG,CAAC,CAAC,MAAM,sBACpB,6LAAC;oCAEG,WAAU;;sDAEV,6LAAC;4CAAK,WAAU;sDACX,QAAQ;;;;;;sDAEb,6LAAC;4CAAK,WAAU;sDACX;;;;;;;mCAPA;;;;;;;;;;sCAcjB,6LAAC;4BACG,SAAS;4BACT,WAAU;;8CAEV,6LAAC,6MAAI;oCAAC,WAAU;;;;;;gCACf,SAAS,aAAa;;;;;;;sCAI3B,6LAAC;4BAAI,WAAU;sCACX,cAAA,6LAAC;gCAAI,WAAU;0CACX,cAAA,6LAAC;oCAAE,WAAU;8CAAqE;;;;;;;;;;;;;;;;sCAQ1F,6LAAC;4BAAI,WAAU;sCACX,cAAA,6LAAC;gCAAI,WAAU;;kDACV,6LAAC;wCAAK,WAAU;kDAAwD;;;;;;kDAGzE,6LAAC,+IAAM;wCACH,SAAS;wCACT,iBAAiB;;;;;;;;;;;;;;;;;;;;;;;8BAMjC,6LAAC,+IAAM;oBACH,SAAS;oBACT,UAAU,CAAC;oBACX,WAAU;oBACV,MAAK;8BACR;;;;;;;;;;;;IAKT;IAEA,OAAO;AACX;GA/LgB;;QAK6D,qJAAa;;;KAL1E"}},
    {"offset": {"line": 2074, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/supabase.ts"],"sourcesContent":["/**\n * Supabase Layer - Metadata-Only Storage\n * Supabase stores ONLY photo metadata and device info, NOT the actual content\n * Content is stored on IPFS (see ipfs.ts and remote-storage.ts)\n */\n\nimport { createClient } from '@supabase/supabase-js'\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\n\n// Type definitions for our tables\nexport interface PhotoMetadata {\n  id?: string\n  cid: string              // IPFS Content Identifier (the actual photo is on IPFS)\n  device_id: string        // Which device uploaded this\n  file_size_bytes?: number // Original file size\n  nonce?: string           // Encryption nonce (Base64)\n  mime_type?: string       // Original MIME type\n  user_key_hash?: string   // Hash of user's encryption key (for multi-device sync)\n  uploaded_at?: string     // When it was uploaded\n}\n\nexport interface Device {\n  id?: string\n  device_name: string\n  device_type?: string\n  user_key_hash?: string   // Links device to user's encryption key\n  created_at?: string\n}\n\n/**\n * Upload photo metadata to Supabase (metadata only, NOT the actual photo)\n * The actual encrypted photo is stored on IPFS\n * Uses API proxy to avoid CORS issues on Safari/iOS\n */\nexport async function uploadCIDMetadata(\n  cid: string,\n  fileSize: number,\n  deviceId: string,\n  nonce?: string,\n  mimeType?: string,\n  userKeyHash?: string\n) {\n  console.log('[Supabase] Uploading metadata:', {\n    cid,\n    deviceId,\n    mimeType,\n    fileSize,\n    hasUserKeyHash: !!userKeyHash,\n  });\n\n  // Try API proxy first (avoids CORS issues)\n  try {\n    const response = await fetch('/api/supabase/proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'uploadMetadata',\n        cid,\n        fileSize,\n        deviceId,\n        nonce,\n        mimeType,\n        userKeyHash,\n      }),\n    });\n\n    const result = await response.json();\n    if (result.success) {\n      console.log('[Supabase] Metadata uploaded via proxy:', result.data?.[0]?.id);\n      return result.data;\n    }\n\n    console.warn('[Supabase] Proxy failed, trying direct client:', result.error);\n  } catch (err) {\n    console.warn('[Supabase] Proxy error, trying direct client:', err);\n  }\n\n  // Fallback to direct client\n  const { data, error } = await supabase\n    .from('photos_metadata')\n    .insert([{\n      cid,\n      file_size_bytes: fileSize,\n      device_id: deviceId,\n      nonce,\n      mime_type: mimeType,\n      user_key_hash: userKeyHash\n    }])\n    .select()\n\n  if (error) {\n    console.error('[Supabase] Metadata Upload Error:', {\n      code: error.code,\n      message: error.message,\n      details: error.details,\n      hint: error.hint,\n    });\n    throw error\n  }\n\n  console.log('[Supabase] Metadata uploaded successfully:', data?.[0]?.id);\n  return data\n}\n\n/**\n * Load all photo CIDs from Supabase for a user\n * Photos are identified by CID and can be fetched from IPFS\n * Uses API proxy to avoid CORS issues on Safari/iOS\n */\nexport async function loadCIDsFromSupabase(_currentDeviceId: string, userKeyHash: string) {\n  if (!userKeyHash) {\n    console.error('loadCIDsFromSupabase: userKeyHash is required');\n    return [];\n  }\n\n  // Try API proxy first (avoids CORS issues)\n  try {\n    const response = await fetch('/api/supabase/proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'loadCIDs',\n        userKeyHash,\n      }),\n    });\n\n    const result = await response.json();\n    if (result.success) {\n      console.log('[Supabase] CIDs loaded via proxy:', result.data?.length);\n      return result.data || [];\n    }\n\n    console.warn('[Supabase] Proxy failed, trying direct client:', result.error);\n  } catch (err) {\n    console.warn('[Supabase] Proxy error, trying direct client:', err);\n  }\n\n  // Fallback to direct client\n  const { data, error } = await supabase\n    .from('photos_metadata')\n    .select('cid, device_id, uploaded_at, file_size_bytes, nonce, mime_type')\n    .eq('user_key_hash', userKeyHash)\n    .order('uploaded_at', { ascending: false })\n\n  if (error) {\n    console.error('Supabase Load Error:', error)\n    throw error\n  }\n  return data || []\n}\n\n/**\n * Check if CID already exists in Supabase for THIS user\n */\nexport async function cidExistsInSupabase(cid: string, userKeyHash: string): Promise<boolean> {\n  if (!userKeyHash) return false;\n\n  const { data, error } = await supabase\n    .from('photos_metadata')\n    .select('id')\n    .eq('cid', cid)\n    .eq('user_key_hash', userKeyHash)\n    .single()\n\n  if (error && error.code !== 'PGRST116') {\n    // PGRST116 = no rows returned, which is expected\n    console.error('Supabase Check Error:', error)\n  }\n  return !!data\n}\n\n/**\n * Delete photo metadata from Supabase\n * Uses API proxy to avoid CORS issues on Safari/iOS\n */\nexport async function deletePhotoMetadata(cid: string): Promise<void> {\n  // Try API proxy first (avoids CORS issues)\n  try {\n    const response = await fetch('/api/supabase/proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'deleteMetadata',\n        cid,\n      }),\n    });\n\n    const result = await response.json();\n    if (result.success) {\n      console.log('[Supabase] Metadata deleted via proxy');\n      return;\n    }\n\n    console.warn('[Supabase] Proxy failed, trying direct client:', result.error);\n  } catch (err) {\n    console.warn('[Supabase] Proxy error, trying direct client:', err);\n  }\n\n  // Fallback to direct client\n  const { error } = await supabase\n    .from('photos_metadata')\n    .delete()\n    .eq('cid', cid)\n\n  if (error) {\n    console.error('Supabase Delete Error:', error)\n    throw error\n  }\n}\n\n/**\n * Register or update a device\n * IMPORTANT: userKeyHash and userId are required for RLS/BetterAuth compliance\n * Uses API proxy to avoid CORS issues on Safari/iOS\n */\nexport async function registerDevice(\n  id: string,\n  deviceName: string,\n  deviceType?: string,\n  userKeyHash?: string,\n  userId?: string\n) {\n  // Validate userKeyHash - required for RLS\n  if (!userKeyHash || userKeyHash.length === 0) {\n    console.error('registerDevice: userKeyHash is required');\n    throw new Error('userKeyHash is required for device registration');\n  }\n\n  // Try API proxy first (avoids CORS issues)\n  try {\n    const response = await fetch('/api/supabase/proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'registerDevice',\n        id,\n        deviceName,\n        deviceType,\n        userKeyHash,\n        userId,\n      }),\n    });\n\n    const result = await response.json();\n    if (result.success) {\n      console.log('[Supabase] Device registered via proxy:', result.updated ? 'updated' : 'inserted');\n      return true;\n    }\n\n    console.warn('[Supabase] Proxy failed, trying direct client:', result.error);\n  } catch (err) {\n    console.warn('[Supabase] Proxy error, trying direct client:', err);\n  }\n\n  // Fallback to direct client\n  const devicePayload = {\n    device_name: deviceName,\n    device_type: deviceType,\n    user_key_hash: userKeyHash,\n    user_id: userId\n  };\n\n  const { data: existingDevice } = await supabase\n    .from('devices')\n    .select('id')\n    .eq('user_id', userId)\n    .eq('device_name', deviceName)\n    .eq('device_type', deviceType || '')\n    .single();\n\n  if (existingDevice) {\n    const { error: updateError } = await supabase\n      .from('devices')\n      .update({\n        device_name: deviceName,\n        device_type: deviceType,\n        user_key_hash: userKeyHash,\n      })\n      .eq('id', existingDevice.id);\n\n    if (updateError) {\n      console.error('[Supabase] Device Update Error:', updateError);\n      throw updateError;\n    }\n    console.log('[Supabase] Device updated:', existingDevice.id);\n    return true;\n  }\n\n  const { error } = await supabase\n    .from('devices')\n    .insert({\n      id,\n      ...devicePayload\n    });\n\n  if (error) {\n    if (error.message?.includes('Device limit exceeded')) {\n      throw new Error('DEVICE_LIMIT_EXCEEDED');\n    }\n    console.error('[Supabase] Device Insert Error:', error);\n    throw error;\n  }\n  console.log('[Supabase] Device inserted:', id);\n  return true;\n}\n\n/**\n * Get all devices for a user (by user_key_hash)\n */\nexport async function getDevicesForUser(userKeyHash: string): Promise<Device[]> {\n  const { data, error } = await supabase\n    .from('devices')\n    .select('*')\n    .eq('user_key_hash', userKeyHash)\n    .order('created_at', { ascending: false })\n\n  if (error) {\n    console.error('Supabase Get Devices Error:', error)\n    throw error\n  }\n  return data || []\n}\n\n/**\n * Get photo metadata by CID\n */\nexport async function getPhotoMetadataByCID(cid: string): Promise<PhotoMetadata | null> {\n  const { data, error } = await supabase\n    .from('photos_metadata')\n    .select('*')\n    .eq('cid', cid)\n    .single()\n\n  if (error && error.code !== 'PGRST116') {\n    console.error('Supabase Get Photo Error:', error)\n    throw error\n  }\n\n  return data\n}\n\n/**\n * Get total storage usage for a user in bytes\n */\nexport async function getStorageUsage(userKeyHash: string): Promise<number> {\n  if (!userKeyHash) return 0;\n\n  // Try API proxy first\n  try {\n    const response = await fetch('/api/supabase/proxy', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        action: 'getStorageUsage',\n        userKeyHash,\n      }),\n    });\n\n    const result = await response.json();\n    if (result.success) {\n      return result.data || 0;\n    }\n  } catch (err) {\n    console.warn('[Supabase] Proxy error for storage usage, trying direct client:', err);\n  }\n\n  // Fallback to direct client\n  const { data, error } = await supabase\n    .from('photos_metadata')\n    .select('file_size_bytes')\n    .eq('user_key_hash', userKeyHash);\n\n  if (error) {\n    console.error('Supabase Storage Usage Error:', error);\n    return 0;\n  }\n\n  return data?.reduce((acc, p) => acc + (p.file_size_bytes || 0), 0) || 0;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2355, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/ipfs.ts"],"sourcesContent":["/**\n * IPFS Layer - Content-Addressed Storage with Pinata Remote Pinning\n * All encrypted blobs are stored on IPFS with CIDs\n */\n\n// Pinata Configuration\nconst PINATA_JWT = process.env.NEXT_PUBLIC_PINATA_JWT || '';\nconst PINATA_GATEWAY = process.env.NEXT_PUBLIC_PINATA_GATEWAY || 'https://gateway.pinata.cloud';\nconst PINATA_GATEWAY_TOKEN = process.env.NEXT_PUBLIC_PINATA_GATEWAY_TOKEN || '';\n\n// API Endpoints\nconst PINATA_PIN_URL = 'https://api.pinata.cloud/pinning/pinFileToIPFS';\nconst PINATA_UNPIN_URL = 'https://api.pinata.cloud/pinning/unpin';\n\n/**\n * Helper: Get the full gateway base URL\n */\nfunction getGatewayBase(): string {\n    if (PINATA_GATEWAY.startsWith('http')) return PINATA_GATEWAY;\n\n    // If it's just a subdomain or already includes mypinata.cloud but lacks protocol\n    if (PINATA_GATEWAY.includes('.')) {\n        return `https://${PINATA_GATEWAY}`;\n    }\n\n    // Default to mypinata.cloud for simple subdomain strings\n    return `https://${PINATA_GATEWAY}.mypinata.cloud`;\n}\n\n/**\n * Generate a real IPFS CID by uploading to Pinata\n * Returns the CID (Content Identifier) that uniquely identifies this blob\n */\nexport async function uploadToIPFS(\n    blob: Blob,\n    fileName?: string,\n    onProgress?: (progress: number) => void\n): Promise<string> {\n    if (!PINATA_JWT) {\n        console.warn('PINATA_JWT not configured - using local mock CID');\n        const mockCid = `Qm${generateMockHash()}`;\n        return mockCid;\n    }\n\n    console.log('[IPFS] Starting upload to Pinata...', { blobSize: blob.size, fileName });\n\n    return new Promise((resolve, reject) => {\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', PINATA_PIN_URL);\n        xhr.setRequestHeader('Authorization', `Bearer ${PINATA_JWT}`);\n\n        // Timeout: 2 minutes for large files on mobile\n        xhr.timeout = 120000;\n\n        xhr.upload.onprogress = (event) => {\n            if (event.lengthComputable && onProgress) {\n                const percentComplete = Math.round((event.loaded / event.total) * 100);\n                console.log(`[IPFS] Upload progress: ${percentComplete}%`);\n                onProgress(percentComplete);\n            }\n        };\n\n        xhr.onload = () => {\n            console.log('[IPFS] XHR onload, status:', xhr.status);\n            if (xhr.status >= 200 && xhr.status < 300) {\n                try {\n                    const result = JSON.parse(xhr.responseText);\n                    console.log('[IPFS] Upload success, CID:', result.IpfsHash);\n                    resolve(result.IpfsHash);\n                } catch (e) {\n                    console.error('[IPFS] Failed to parse response:', xhr.responseText);\n                    reject(new Error('Failed to parse Pinata response'));\n                }\n            } else {\n                console.error('[IPFS] Upload failed:', { status: xhr.status, response: xhr.responseText });\n                reject(new Error(`IPFS upload failed: ${xhr.status} - ${xhr.responseText}`));\n            }\n        };\n\n        xhr.onerror = (event) => {\n            console.error('[IPFS] XHR network error:', event);\n            reject(new Error('Network error during IPFS upload - check connection'));\n        };\n\n        xhr.ontimeout = () => {\n            console.error('[IPFS] Upload timeout (2 min)');\n            reject(new Error('IPFS upload timeout - file too large or slow connection'));\n        };\n\n        const formData = new FormData();\n        formData.append('file', blob, fileName || 'encrypted-photo.bin');\n\n        const metadata = JSON.stringify({\n            name: fileName || 'photovault-encrypted',\n            keyvalues: { app: 'photovault', type: 'encrypted-photo' }\n        });\n        formData.append('pinataMetadata', metadata);\n\n        const options = JSON.stringify({ cidVersion: 1 });\n        formData.append('pinataOptions', options);\n\n        console.log('[IPFS] Sending XHR...');\n        xhr.send(formData);\n    });\n}\n\n/**\n * Download content from IPFS\n * Uses API proxy to avoid CORS issues on production\n * Falls back to direct gateway access for development\n */\nexport async function downloadFromIPFS(cid: string): Promise<Blob> {\n    console.log(`[IPFS] Downloading CID: ${cid}`);\n\n    // Primary: Use API proxy (avoids all CORS issues)\n    try {\n        console.log(`[IPFS] Trying API proxy...`);\n        const response = await fetch(`/api/ipfs/download?cid=${encodeURIComponent(cid)}`);\n\n        if (response.ok) {\n            const blob = await response.blob();\n            console.log(`[IPFS] API proxy succeeded, size: ${blob.size} bytes`);\n            return blob;\n        }\n\n        console.warn(`[IPFS] API proxy failed: ${response.status}`);\n    } catch (err) {\n        console.warn(`[IPFS] API proxy error:`, err);\n    }\n\n    // Fallback: Direct gateway access (works in development, may fail on production due to CORS)\n    const gatewayBase = getGatewayBase();\n    const gateways = [\n        () => {\n            const url = new URL(`${gatewayBase}/ipfs/${cid}`);\n            if (PINATA_GATEWAY_TOKEN) url.searchParams.set('pinataGatewayToken', PINATA_GATEWAY_TOKEN);\n            return url.toString();\n        },\n        () => `https://cloudflare-ipfs.com/ipfs/${cid}`,\n    ];\n\n    const controller = new AbortController();\n\n    try {\n        const fetchPromises = gateways.map(async (getUrl, index) => {\n            const url = getUrl();\n            console.log(`[IPFS] Trying gateway ${index + 1}: ${url.substring(0, 60)}...`);\n\n            const response = await fetch(url, {\n                signal: controller.signal,\n                mode: 'cors',\n                credentials: 'omit',\n            });\n\n            if (!response.ok) {\n                throw new Error(`Gateway failed: ${response.status}`);\n            }\n\n            console.log(`[IPFS] Gateway ${index + 1} succeeded`);\n            return response.blob();\n        });\n\n        const winningBlob = await Promise.any(fetchPromises);\n        controller.abort();\n\n        console.log(`[IPFS] Download complete, size: ${winningBlob.size} bytes`);\n        return winningBlob;\n    } catch (error) {\n        controller.abort();\n        console.error('[IPFS] All methods failed:', error);\n        throw new Error(`IPFS download failed for CID: ${cid}. Check network/CORS.`);\n    }\n}\n\n/**\n * Unpin content from Pinata (optional cleanup)\n */\nexport async function unpinFromIPFS(cid: string): Promise<void> {\n    if (!PINATA_JWT) {\n        console.warn('PINATA_JWT not configured - skipping unpin');\n        return;\n    }\n\n    const response = await fetch(`${PINATA_UNPIN_URL}/${cid}`, {\n        method: 'DELETE',\n        headers: {\n            'Authorization': `Bearer ${PINATA_JWT}`,\n        },\n    });\n\n    if (!response.ok) {\n        console.error('Pinata unpin failed:', await response.text());\n        // Don't throw - unpin failure is not critical\n    }\n}\n\n/**\n * Check if a CID exists on IPFS (via gateway)\n */\nexport async function cidExistsOnIPFS(cid: string): Promise<boolean> {\n    try {\n        const gatewayBase = getGatewayBase();\n        const url = new URL(`${gatewayBase}/ipfs/${cid}`);\n        if (PINATA_GATEWAY_TOKEN) {\n            url.searchParams.set('pinataGatewayToken', PINATA_GATEWAY_TOKEN);\n        }\n\n        const response = await fetch(url.toString(), {\n            method: 'HEAD',\n            headers: PINATA_GATEWAY_TOKEN ? {\n                'x-pinata-gateway-token': PINATA_GATEWAY_TOKEN,\n            } : {},\n        });\n        return response.ok;\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Get the gateway URL for a CID (for direct browser access)\n */\nexport function getIPFSGatewayUrl(cid: string): string {\n    const gatewayBase = getGatewayBase();\n    const url = new URL(`${gatewayBase}/ipfs/${cid}`);\n    if (PINATA_GATEWAY_TOKEN) {\n        url.searchParams.set('pinataGatewayToken', PINATA_GATEWAY_TOKEN);\n    }\n    return url.toString();\n}\n\n/**\n * Validate if a string looks like a valid IPFS CID\n */\nexport function isValidCID(cid: string): boolean {\n    // CIDv0 starts with Qm and is 46 chars\n    // CIDv1 starts with bafy and varies in length\n    return (\n        (cid.startsWith('Qm') && cid.length === 46) ||\n        cid.startsWith('bafy') ||\n        cid.startsWith('bafk')\n    );\n}\n\n/**\n * Generate a mock hash for development without Pinata\n */\nfunction generateMockHash(): string {\n    const chars = '123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz';\n    let hash = '';\n    for (let i = 0; i < 44; i++) {\n        hash += chars.charAt(Math.floor(Math.random() * chars.length));\n    }\n    return hash;\n}\n\n/**\n * Check if IPFS/Pinata is configured\n */\nexport function isIPFSConfigured(): boolean {\n    return !!PINATA_JWT && PINATA_JWT.length > 0;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2574, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/storage/remote-storage.ts"],"sourcesContent":["/**\n * Remote Storage Layer - IPFS with Pinata Remote Pinning\n * Encrypted blobs are stored on IPFS, identified by CID\n */\n\nimport { uploadToIPFS, downloadFromIPFS, isIPFSConfigured } from '@/lib/ipfs';\n\nexport interface RemoteStorageProvider {\n    /**\n     * Upload encrypted blob to IPFS\n     * @param blob - The encrypted blob to upload\n     * @param fileName - Optional filename for metadata\n     * @param onProgress - Optional callback for upload progress (0-100)\n     * @returns The IPFS CID (Content Identifier)\n     */\n    upload: (blob: Blob, fileName?: string, onProgress?: (progress: number) => void) => Promise<string>;\n\n    /**\n     * Download encrypted blob from IPFS by CID\n     * @param cid - The IPFS Content Identifier\n     * @returns The encrypted blob\n     */\n    download: (cid: string) => Promise<Blob>;\n\n    /**\n     * Check if remote storage is configured\n     */\n    isConfigured: () => boolean;\n}\n\n/**\n * IPFS Remote Storage Provider\n * Uses Pinata for pinning and dedicated gateway for downloads\n */\nexport const remoteStorage: RemoteStorageProvider = {\n    upload: async (blob: Blob, fileName?: string, onProgress?: (progress: number) => void) => {\n        try {\n            console.log('Uploading to IPFS...', { size: blob.size, fileName });\n            const cid = await uploadToIPFS(blob, fileName, onProgress);\n            console.log('IPFS upload successful:', cid);\n            return cid;\n        } catch (error) {\n            console.error('Remote Storage Upload failed:', error);\n            throw error;\n        }\n    },\n\n    download: async (cid: string) => {\n        try {\n            console.log('Downloading from IPFS:', cid);\n            const blob = await downloadFromIPFS(cid);\n            console.log('IPFS download successful:', { cid, size: blob.size });\n            return blob;\n        } catch (error) {\n            console.error('Remote Storage Download failed:', error);\n            throw error;\n        }\n    },\n\n    isConfigured: () => {\n        return isIPFSConfigured();\n    }\n};\n\n/**\n * Helper: Check if a CID looks like a real IPFS CID or a mock/legacy CID\n */\nexport function isRealIPFSCID(cid: string): boolean {\n    // Real IPFS CIDs start with Qm (v0) or bafy/bafk (v1)\n    return cid.startsWith('Qm') || cid.startsWith('bafy') || cid.startsWith('bafk');\n}\n\n/**\n * Helper: Check if a CID is a legacy local-only CID (cid_timestamp_random)\n */\nexport function isLegacyLocalCID(cid: string): boolean {\n    return cid.startsWith('cid_');\n}\n"],"names":[],"mappings":";;;;;;;;AAAA;;;CAGC,GAED;;AA6BO,MAAM,gBAAuC;IAChD,QAAQ,OAAO,MAAY,UAAmB;QAC1C,IAAI;YACA,QAAQ,GAAG,CAAC,wBAAwB;gBAAE,MAAM,KAAK,IAAI;gBAAE;YAAS;YAChE,MAAM,MAAM,MAAM,IAAA,qIAAY,EAAC,MAAM,UAAU;YAC/C,QAAQ,GAAG,CAAC,2BAA2B;YACvC,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,iCAAiC;YAC/C,MAAM;QACV;IACJ;IAEA,UAAU,OAAO;QACb,IAAI;YACA,QAAQ,GAAG,CAAC,0BAA0B;YACtC,MAAM,OAAO,MAAM,IAAA,yIAAgB,EAAC;YACpC,QAAQ,GAAG,CAAC,6BAA6B;gBAAE;gBAAK,MAAM,KAAK,IAAI;YAAC;YAChE,OAAO;QACX,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC,mCAAmC;YACjD,MAAM;QACV;IACJ;IAEA,cAAc;QACV,OAAO,IAAA,yIAAgB;IAC3B;AACJ;AAKO,SAAS,cAAc,GAAW;IACrC,sDAAsD;IACtD,OAAO,IAAI,UAAU,CAAC,SAAS,IAAI,UAAU,CAAC,WAAW,IAAI,UAAU,CAAC;AAC5E;AAKO,SAAS,iBAAiB,GAAW;IACxC,OAAO,IAAI,UAAU,CAAC;AAC1B"}},
    {"offset": {"line": 2634, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/storage/local-db.ts"],"sourcesContent":["/**\n * Local Database - Dexie.js Wrapper für Photo Metadata\n * Speichert CIDs und Metadaten lokal (offline-first)\n *\n * WICHTIG: iOS Safari hat Probleme mit Blob-Storage in IndexedDB.\n * Wir speichern Blobs als ArrayBuffer und konvertieren beim Lesen zurück.\n *\n * PERFORMANCE OPTIMIZATIONS (Phase 2):\n * - Compound index on [uploadedAt+id] for efficient pagination\n * - Pagination support for 1000+ photos\n * - Lazy loading of encrypted blobs\n */\n\nimport Dexie, { Table } from 'dexie';\n\n// Public interface - what the app sees\nexport interface PhotoMetadata {\n    id?: number; // Auto-increment\n    cid: string; // IPFS Content ID\n    nonce: string; // Encryption Nonce (Base64)\n    fileName: string;\n    mimeType: string;\n    fileSize: number;\n    width?: number;\n    height?: number;\n    uploadedAt: Date;\n    encryptedBlob?: Blob; // Optional: Lokaler Cache\n}\n\n// Internal storage format - what we actually store in IndexedDB\ninterface PhotoStorageRecord {\n    id?: number;\n    cid: string;\n    nonce: string;\n    fileName: string;\n    mimeType: string;\n    fileSize: number;\n    width?: number;\n    height?: number;\n    uploadedAt: Date;\n    encryptedData?: ArrayBuffer; // Stored as ArrayBuffer for iOS Safari compatibility\n}\n\n// Pagination options\nexport interface PaginationOptions {\n    page?: number;      // 0-indexed page number\n    pageSize?: number;  // Items per page (default: 50)\n}\n\n// Paginated result\nexport interface PaginatedResult<T> {\n    items: T[];\n    total: number;\n    page: number;\n    pageSize: number;\n    hasMore: boolean;\n}\n\nexport class PhotoVaultDB extends Dexie {\n    photos!: Table<PhotoStorageRecord, number>;\n\n    constructor() {\n        super('PhotoVaultDB');\n\n        // Version 2: Added compound index for efficient pagination\n        this.version(2).stores({\n            photos: '++id, cid, uploadedAt, [uploadedAt+id]',\n        }).upgrade(() => {\n            // Migration is automatic - Dexie handles index creation\n            console.log('[LocalDB] Upgraded to v2 with compound index');\n        });\n\n        // Keep v1 for backward compatibility\n        this.version(1).stores({\n            photos: '++id, cid, uploadedAt',\n        });\n    }\n}\n\n// Singleton Instance\nexport const db = new PhotoVaultDB();\n\n/**\n * Convert Blob to ArrayBuffer (for iOS Safari IndexedDB compatibility)\n */\nasync function blobToArrayBuffer(blob: Blob): Promise<ArrayBuffer> {\n    return await blob.arrayBuffer();\n}\n\n/**\n * Convert ArrayBuffer back to Blob\n */\nfunction arrayBufferToBlob(buffer: ArrayBuffer, mimeType: string): Blob {\n    return new Blob([buffer], { type: mimeType });\n}\n\n/**\n * Convert storage record to public PhotoMetadata\n */\nfunction recordToMetadata(record: PhotoStorageRecord): PhotoMetadata {\n    const { encryptedData, ...rest } = record;\n    return {\n        ...rest,\n        encryptedBlob: encryptedData\n            ? arrayBufferToBlob(encryptedData, record.mimeType)\n            : undefined,\n    };\n}\n\n/**\n * Speichert Photo Metadata\n * Konvertiert Blob zu ArrayBuffer für iOS Safari Kompatibilität\n */\nexport async function savePhoto(photo: Omit<PhotoMetadata, 'id'>): Promise<number> {\n    const { encryptedBlob, ...rest } = photo;\n\n    // Convert Blob to ArrayBuffer for storage\n    const storageRecord: Omit<PhotoStorageRecord, 'id'> = {\n        ...rest,\n        encryptedData: encryptedBlob ? await blobToArrayBuffer(encryptedBlob) : undefined,\n    };\n\n    console.log('[LocalDB] Saving photo as ArrayBuffer:', {\n        cid: photo.cid,\n        hasBlob: !!encryptedBlob,\n        arrayBufferSize: storageRecord.encryptedData?.byteLength\n    });\n\n    return await db.photos.add(storageRecord);\n}\n\n/**\n * Lädt alle Photos (sortiert nach Datum)\n * Konvertiert ArrayBuffer zurück zu Blob\n */\nexport async function getAllPhotos(): Promise<PhotoMetadata[]> {\n    const records = await db.photos.orderBy('uploadedAt').reverse().toArray();\n    return records.map(recordToMetadata);\n}\n\n/**\n * Lädt ein Photo by CID\n * Konvertiert ArrayBuffer zurück zu Blob\n */\nexport async function getPhotoByCID(cid: string): Promise<PhotoMetadata | undefined> {\n    const record = await db.photos.where('cid').equals(cid).first();\n    return record ? recordToMetadata(record) : undefined;\n}\n\n/**\n * Löscht ein Photo\n */\nexport async function deletePhoto(id: number): Promise<void> {\n    await db.photos.delete(id);\n}\n\n/**\n * Löscht alle Photos (Reset)\n */\nexport async function clearAllPhotos(): Promise<void> {\n    await db.photos.clear();\n}\n\n/**\n * Zählt Anzahl der Photos\n */\nexport async function getPhotoCount(): Promise<number> {\n    return await db.photos.count();\n}\n\n/**\n * Lädt Photos mit Pagination (optimiert für 1000+ Photos)\n * Uses compound index [uploadedAt+id] for efficient cursor-based pagination\n */\nexport async function getPhotosPaginated(\n    options: PaginationOptions = {}\n): Promise<PaginatedResult<PhotoMetadata>> {\n    const { page = 0, pageSize = 50 } = options;\n    const offset = page * pageSize;\n\n    // Get total count (cached by Dexie for performance)\n    const total = await db.photos.count();\n\n    // Use offset-based pagination with index\n    const records = await db.photos\n        .orderBy('uploadedAt')\n        .reverse()\n        .offset(offset)\n        .limit(pageSize)\n        .toArray();\n\n    return {\n        items: records.map(recordToMetadata),\n        total,\n        page,\n        pageSize,\n        hasMore: offset + records.length < total,\n    };\n}\n\n/**\n * Lädt Photos mit Cursor-basierter Pagination (für infinite scroll)\n * Mehr performant als offset-basierte Pagination bei großen Datenmengen\n */\nexport async function getPhotosAfterCursor(\n    cursor?: { uploadedAt: Date; id: number },\n    limit: number = 50\n): Promise<{ items: PhotoMetadata[]; nextCursor?: { uploadedAt: Date; id: number } }> {\n    let query = db.photos.orderBy('uploadedAt').reverse();\n\n    if (cursor) {\n        // Use compound key for efficient cursor-based pagination\n        query = query.filter(record => {\n            if (!record.id) return false;\n            // Photos older than cursor, or same date but lower ID\n            if (record.uploadedAt < cursor.uploadedAt) return true;\n            if (record.uploadedAt.getTime() === cursor.uploadedAt.getTime() && record.id < cursor.id) return true;\n            return false;\n        });\n    }\n\n    const records = await query.limit(limit + 1).toArray();\n    const hasMore = records.length > limit;\n    const items = hasMore ? records.slice(0, limit) : records;\n\n    const lastItem = items[items.length - 1];\n    const nextCursor = hasMore && lastItem?.id && lastItem?.uploadedAt\n        ? { uploadedAt: lastItem.uploadedAt, id: lastItem.id }\n        : undefined;\n\n    return {\n        items: items.map(recordToMetadata),\n        nextCursor,\n    };\n}\n\n/**\n * Lädt nur Metadaten ohne Blob (für schnelle Galerie-Ansicht)\n * Optimiert für initiales Laden - Blobs werden on-demand nachgeladen\n */\nexport async function getPhotosMetadataOnly(\n    options: PaginationOptions = {}\n): Promise<PaginatedResult<Omit<PhotoMetadata, 'encryptedBlob'>>> {\n    const { page = 0, pageSize = 50 } = options;\n    const offset = page * pageSize;\n\n    const total = await db.photos.count();\n\n    // Only select non-blob fields for faster loading\n    const records = await db.photos\n        .orderBy('uploadedAt')\n        .reverse()\n        .offset(offset)\n        .limit(pageSize)\n        .toArray();\n\n    // Return metadata without converting blobs\n    const items = records.map(record => ({\n        id: record.id,\n        cid: record.cid,\n        nonce: record.nonce,\n        fileName: record.fileName,\n        mimeType: record.mimeType,\n        fileSize: record.fileSize,\n        width: record.width,\n        height: record.height,\n        uploadedAt: record.uploadedAt,\n    }));\n\n    return {\n        items,\n        total,\n        page,\n        pageSize,\n        hasMore: offset + records.length < total,\n    };\n}\n\n/**\n * Lädt den Blob für ein einzelnes Photo (lazy loading)\n */\nexport async function getPhotoBlob(id: number): Promise<Blob | undefined> {\n    const record = await db.photos.get(id);\n    if (!record?.encryptedData) return undefined;\n    return arrayBufferToBlob(record.encryptedData, record.mimeType);\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2823, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/storage/settings-store.ts"],"sourcesContent":["import { create } from 'zustand';\nimport { persist, createJSONStorage } from 'zustand/middleware';\n\nexport interface SettingsState {\n    backupActive: boolean;\n    autoBackupEnabled: boolean;\n    backgroundBackupEnabled: boolean;\n    selectedPlan: 'free' | 'backup-plus';\n    lastBackup: string;\n    permanence: number;\n    setBackupActive: (active: boolean) => void;\n    setAutoBackupEnabled: (enabled: boolean) => void;\n    setBackgroundBackupEnabled: (enabled: boolean) => void;\n    setSelectedPlan: (plan: 'free' | 'backup-plus') => void;\n    setLastBackup: (date: string) => void;\n    setPermanence: (value: number) => void;\n}\n\nconst dummyStorage = {\n    getItem: () => null,\n    setItem: () => { },\n    removeItem: () => { },\n};\n\nexport const useSettingsStore = create<SettingsState>()(\n    persist(\n        (set) => ({\n            backupActive: false,\n            autoBackupEnabled: true,\n            backgroundBackupEnabled: false,\n            selectedPlan: 'free',\n            lastBackup: 'Noch nie',\n            permanence: 0,\n\n            setBackupActive: (active) => set({ backupActive: active }),\n            setAutoBackupEnabled: (enabled) => set({ autoBackupEnabled: enabled }),\n            setBackgroundBackupEnabled: (enabled) => set({ backgroundBackupEnabled: enabled }),\n            setSelectedPlan: (plan) => set({ selectedPlan: plan }),\n            setLastBackup: (date) => set({ lastBackup: date }),\n            setPermanence: (value) => set({ permanence: value }),\n        }),\n        {\n            name: 'photovault-settings',\n            storage: createJSONStorage(() => typeof window !== 'undefined' ? localStorage : dummyStorage),\n        }\n    )\n);\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAiBA,MAAM,eAAe;IACjB,SAAS,IAAM;IACf,SAAS,KAAQ;IACjB,YAAY,KAAQ;AACxB;AAEO,MAAM,mBAAmB,IAAA,qJAAM,IAClC,IAAA,2JAAO,EACH,CAAC,MAAQ,CAAC;QACN,cAAc;QACd,mBAAmB;QACnB,yBAAyB;QACzB,cAAc;QACd,YAAY;QACZ,YAAY;QAEZ,iBAAiB,CAAC,SAAW,IAAI;gBAAE,cAAc;YAAO;QACxD,sBAAsB,CAAC,UAAY,IAAI;gBAAE,mBAAmB;YAAQ;QACpE,4BAA4B,CAAC,UAAY,IAAI;gBAAE,yBAAyB;YAAQ;QAChF,iBAAiB,CAAC,OAAS,IAAI;gBAAE,cAAc;YAAK;QACpD,eAAe,CAAC,OAAS,IAAI;gBAAE,YAAY;YAAK;QAChD,eAAe,CAAC,QAAU,IAAI;gBAAE,YAAY;YAAM;IACtD,CAAC,GACD;IACI,MAAM;IACN,SAAS,IAAA,qKAAiB,EAAC,IAAM,uCAAgC,eAAe;AACpF"}},
    {"offset": {"line": 2872, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchStyles.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\n/**\n * Sketch UI Design System\n * ========================\n * Handgezeichneter blauer Linien-Stil\n *\n * FARBEN:\n * - Primär: #2563EB (Kräftiges Blau)\n * - Linien: #3B82F6 (Helleres Blau für Striche)\n * - Hintergrund: #FAFBFC (Fast-Weiß)\n * - Text: #1E40AF (Dunkles Blau)\n *\n * STIL-EIGENSCHAFTEN:\n * - Variable Strichstärke (2-4px)\n * - Leichte Rotation für Handgezeichneten-Effekt\n * - Raue, organische Linien\n * - Jitter/Wobble durch SVG Filter\n */\n\n// SVG Filter für den \"Handgezeichnet\"-Effekt\nexport const SketchFilter = () => (\n  <svg width=\"0\" height=\"0\" style={{ position: \"absolute\" }}>\n    <defs>\n      <filter id=\"sketch-filter\" x=\"-10%\" y=\"-10%\" width=\"120%\" height=\"120%\">\n        <feTurbulence\n          type=\"fractalNoise\"\n          baseFrequency=\"0.02\"\n          numOctaves=\"3\"\n          result=\"noise\"\n        />\n        <feDisplacementMap\n          in=\"SourceGraphic\"\n          in2=\"noise\"\n          scale=\"2\"\n          xChannelSelector=\"R\"\n          yChannelSelector=\"G\"\n        />\n      </filter>\n      <filter id=\"rough-edge\" x=\"-5%\" y=\"-5%\" width=\"110%\" height=\"110%\">\n        <feTurbulence\n          type=\"turbulence\"\n          baseFrequency=\"0.05\"\n          numOctaves=\"2\"\n          result=\"noise\"\n        />\n        <feDisplacementMap in=\"SourceGraphic\" in2=\"noise\" scale=\"1.5\" />\n      </filter>\n    </defs>\n  </svg>\n);\n\n// CSS Klassen für Sketch-Stil\nexport const sketchClasses = {\n  // Container mit handgezeichnetem Rand\n  container: \"relative bg-[#FAFBFC]\",\n\n  // Text-Stile\n  heading: \"font-['Google Sans',_sans-serif] text-[#1E40AF] text-3xl font-bold\",\n  subheading: \"font-['Google Sans',_sans-serif] text-[#3B82F6] text-xl\",\n  body: \"font-['Google Sans',_sans-serif] text-[#1E40AF] text-lg\",\n\n  // Interaktive Elemente\n  button:\n    \"relative cursor-pointer transition-transform hover:scale-105 active:scale-95\",\n\n  // Linien\n  line: \"stroke-[#2563EB] stroke-[3] fill-none\",\n};\n\n// Wiederverwendbare SVG-Pfade für verschiedene Formen\nexport const sketchPaths = {\n  // Rechteck mit unregelmäßigen Linien\n  rectangle: (width: number, height: number, jitter = 3) => {\n    const j = () => (Math.random() - 0.5) * jitter;\n    return `\n      M ${j()} ${j()}\n      L ${width + j()} ${j()}\n      L ${width + j()} ${height + j()}\n      L ${j()} ${height + j()}\n      Z\n    `;\n  },\n\n  // Kreis mit leichter Unregelmäßigkeit\n  circle: (cx: number, cy: number, r: number, segments = 24) => {\n    let path = \"\";\n    for (let i = 0; i <= segments; i++) {\n      const angle = (i / segments) * Math.PI * 2;\n      const jitter = r * 0.03 * (Math.random() - 0.5);\n      const x = cx + (r + jitter) * Math.cos(angle);\n      const y = cy + (r + jitter) * Math.sin(angle);\n      path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n    }\n    return path + \"Z\";\n  },\n};\n"],"names":[],"mappings":";;;;;;;;;AAAA;;AAuBO,MAAM,eAAe,kBAC1B,6LAAC;QAAI,OAAM;QAAI,QAAO;QAAI,OAAO;YAAE,UAAU;QAAW;kBACtD,cAAA,6LAAC;;8BACC,6LAAC;oBAAO,IAAG;oBAAgB,GAAE;oBAAO,GAAE;oBAAO,OAAM;oBAAO,QAAO;;sCAC/D,6LAAC;4BACC,MAAK;4BACL,eAAc;4BACd,YAAW;4BACX,QAAO;;;;;;sCAET,6LAAC;4BACC,IAAG;4BACH,KAAI;4BACJ,OAAM;4BACN,kBAAiB;4BACjB,kBAAiB;;;;;;;;;;;;8BAGrB,6LAAC;oBAAO,IAAG;oBAAa,GAAE;oBAAM,GAAE;oBAAM,OAAM;oBAAO,QAAO;;sCAC1D,6LAAC;4BACC,MAAK;4BACL,eAAc;4BACd,YAAW;4BACX,QAAO;;;;;;sCAET,6LAAC;4BAAkB,IAAG;4BAAgB,KAAI;4BAAQ,OAAM;;;;;;;;;;;;;;;;;;;;;;;KAzBnD;AAgCN,MAAM,gBAAgB;IAC3B,sCAAsC;IACtC,WAAW;IAEX,aAAa;IACb,SAAS;IACT,YAAY;IACZ,MAAM;IAEN,uBAAuB;IACvB,QACE;IAEF,SAAS;IACT,MAAM;AACR;AAGO,MAAM,cAAc;IACzB,qCAAqC;IACrC,WAAW,CAAC,OAAe,QAAgB,SAAS,CAAC;QACnD,MAAM,IAAI,IAAM,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;QACxC,OAAO,CAAC;QACJ,EAAE,IAAI,CAAC,EAAE,IAAI;QACb,EAAE,QAAQ,IAAI,CAAC,EAAE,IAAI;QACrB,EAAE,QAAQ,IAAI,CAAC,EAAE,SAAS,IAAI;QAC9B,EAAE,IAAI,CAAC,EAAE,SAAS,IAAI;;IAE1B,CAAC;IACH;IAEA,sCAAsC;IACtC,QAAQ,CAAC,IAAY,IAAY,GAAW,WAAW,EAAE;QACvD,IAAI,OAAO;QACX,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;YAClC,MAAM,QAAQ,AAAC,IAAI,WAAY,KAAK,EAAE,GAAG;YACzC,MAAM,SAAS,IAAI,OAAO,CAAC,KAAK,MAAM,KAAK,GAAG;YAC9C,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;YACvC,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;YACvC,QAAQ,CAAC,MAAM,IAAI,OAAO,IAAI,IAAI,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;QAChD;QACA,OAAO,OAAO;IAChB;AACF"}},
    {"offset": {"line": 3015, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchButton.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\nexport interface SketchButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  children: React.ReactNode;\n  variant?: \"primary\" | \"secondary\" | \"outline\";\n  size?: \"sm\" | \"md\" | \"lg\";\n}\n\nexport function SketchButton({\n  children,\n  onClick,\n  variant = \"primary\",\n  size = \"md\",\n  disabled = false,\n  className = \"\",\n  type = \"button\",\n  ...props\n}: SketchButtonProps) {\n  // Generiere einmalig die \"Jitter\"-Werte für den handgezeichneten Effekt\n  const jitterValues = useMemo(() => {\n    return Array.from({ length: 8 }, () => (Math.random() - 0.5) * 4);\n  }, []);\n\n  const sizes = {\n    sm: { width: 120, height: 40, fontSize: \"16px\", padding: \"8px 16px\" },\n    md: { width: 160, height: 50, fontSize: \"18px\", padding: \"10px 24px\" },\n    lg: { width: 200, height: 60, fontSize: \"20px\", padding: \"14px 32px\" },\n  };\n\n  const colors = {\n    primary: {\n      stroke: \"#2563EB\",\n      fill: \"#2563EB\",\n      text: \"#FFFFFF\",\n      hoverStroke: \"#1D4ED8\",\n    },\n    secondary: {\n      stroke: \"#3B82F6\",\n      fill: \"#EFF6FF\",\n      text: \"#2563EB\",\n      hoverStroke: \"#2563EB\",\n    },\n    outline: {\n      stroke: \"#2563EB\",\n      fill: \"transparent\",\n      text: \"#2563EB\",\n      hoverStroke: \"#1D4ED8\",\n    },\n  };\n\n  const { width, height, fontSize, padding } = sizes[size];\n  const { stroke, fill, text } = colors[variant];\n\n  // Handgezeichneter Rechteck-Pfad\n  const sketchPath = `\n    M ${2 + jitterValues[0]} ${2 + jitterValues[1]}\n    Q ${width / 4 + jitterValues[2]} ${-1 + jitterValues[3]}, ${width / 2} ${2 + jitterValues[4]}\n    Q ${(3 * width) / 4 + jitterValues[5]} ${-1}, ${width - 2 + jitterValues[6]} ${2}\n    Q ${width + 1} ${height / 4}, ${width - 2} ${height / 2}\n    Q ${width + 1} ${(3 * height) / 4}, ${width - 2 + jitterValues[7]} ${height - 2}\n    Q ${(3 * width) / 4} ${height + 1}, ${width / 2} ${height - 2}\n    Q ${width / 4} ${height + 1}, ${2 + jitterValues[0]} ${height - 2}\n    Q ${-1} ${(3 * height) / 4}, ${2} ${height / 2}\n    Q ${-1} ${height / 4}, ${2 + jitterValues[1]} ${2}\n    Z\n  `;\n\n  // Zweiter Durchgang für den \"mehrfach gezeichnet\" Effekt\n  const sketchPath2 = `\n    M ${3 + jitterValues[1]} ${3 + jitterValues[0]}\n    Q ${width / 4 + jitterValues[3]} ${0 + jitterValues[2]}, ${width / 2} ${3}\n    Q ${(3 * width) / 4} ${0}, ${width - 3 + jitterValues[4]} ${3}\n    Q ${width} ${height / 4}, ${width - 3} ${height / 2}\n    Q ${width} ${(3 * height) / 4}, ${width - 3 + jitterValues[5]} ${height - 3}\n    Q ${(3 * width) / 4} ${height}, ${width / 2} ${height - 3}\n    Q ${width / 4} ${height}, ${3 + jitterValues[6]} ${height - 3}\n    Q ${0} ${(3 * height) / 4}, ${3} ${height / 2}\n    Q ${0} ${height / 4}, ${3 + jitterValues[7]} ${3}\n    Z\n  `;\n\n  return (\n    <button\n      onClick={onClick}\n      disabled={disabled}\n      type={type}\n      className={`\n        relative inline-block\n        transition-transform duration-150\n        ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer hover:scale-[1.02] active:scale-[0.98]\"}\n        ${className}\n      `}\n      style={{ width, height }}\n      {...props}\n    >\n      <svg\n        width={width}\n        height={height}\n        viewBox={`0 0 ${width} ${height}`}\n        className=\"absolute inset-0 pointer-events-none\"\n      >\n        {/* Hintergrund-Füllung */}\n        <path d={sketchPath} fill={fill} stroke=\"none\" />\n        {/* Erste Linie (dicker) */}\n        <path\n          d={sketchPath}\n          fill=\"none\"\n          stroke={stroke}\n          strokeWidth=\"3\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          style={{ filter: \"url(#rough-edge)\" }}\n        />\n        {/* Zweite Linie (dünner, leicht versetzt) */}\n        <path\n          d={sketchPath2}\n          fill=\"none\"\n          stroke={stroke}\n          strokeWidth=\"1.5\"\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          opacity=\"0.6\"\n        />\n      </svg>\n\n      {/* Text */}\n      <span\n        className=\"relative z-10 font-['Google Sans',_sans-serif] font-bold truncate px-2\"\n        style={{\n          fontSize,\n          color: text,\n          display: \"flex\",\n          alignItems: \"center\",\n          justifyContent: \"center\",\n          height: \"100%\",\n          width: \"100%\",\n        }}\n      >\n        {children}\n      </span>\n    </button>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3205, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchCard.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\ninterface SketchCardProps {\n  children: React.ReactNode;\n  className?: string;\n  onClick?: () => void;\n  variant?: \"default\" | \"elevated\" | \"outline\";\n}\n\nexport function SketchCard({\n  children,\n  className = \"\",\n  onClick,\n  variant = \"default\",\n}: SketchCardProps) {\n  // Generiere Jitter für handgezeichnete Ecken\n  const jitter = useMemo(() => {\n    return Array.from({ length: 12 }, () => (Math.random() - 0.5) * 6);\n  }, []);\n\n  const variantStyles = {\n    default: {\n      fill: \"#FFFFFF\",\n      stroke: \"#2563EB\",\n      strokeWidth: 3,\n    },\n    elevated: {\n      fill: \"#FFFFFF\",\n      stroke: \"#2563EB\",\n      strokeWidth: 4,\n    },\n    outline: {\n      fill: \"transparent\",\n      stroke: \"#3B82F6\",\n      strokeWidth: 2,\n    },\n  };\n\n  const style = variantStyles[variant];\n\n  return (\n    <div\n      onClick={onClick}\n      className={`\n        relative\n        ${onClick ? \"cursor-pointer hover:scale-[1.01] active:scale-[0.99]\" : \"\"}\n        transition-transform duration-150\n        ${className}\n      `}\n    >\n      <svg\n        className=\"absolute inset-0 w-full h-full pointer-events-none\"\n        preserveAspectRatio=\"none\"\n      >\n        <defs>\n          <filter id=\"card-rough\" x=\"-5%\" y=\"-5%\" width=\"110%\" height=\"110%\">\n            <feTurbulence\n              type=\"turbulence\"\n              baseFrequency=\"0.04\"\n              numOctaves=\"2\"\n              result=\"noise\"\n            />\n            <feDisplacementMap\n              in=\"SourceGraphic\"\n              in2=\"noise\"\n              scale=\"1\"\n            />\n          </filter>\n        </defs>\n        \n        {/* Hauptrahmen - handgezeichnet */}\n        <path\n          d={`\n            M ${5 + jitter[0]}% ${3 + jitter[1]}%\n            Q ${25}% ${-0.5 + jitter[2]}%, ${50}% ${2 + jitter[3]}%\n            Q ${75}% ${-0.5}%, ${95 + jitter[4]}% ${3}%\n            Q ${100.5}% ${25}%, ${97}% ${50}%\n            Q ${100.5}% ${75}%, ${95 + jitter[5]}% ${97}%\n            Q ${75}% ${100.5}%, ${50}% ${97 + jitter[6]}%\n            Q ${25}% ${100.5}%, ${5 + jitter[7]}% ${97}%\n            Q ${-0.5}% ${75}%, ${3}% ${50}%\n            Q ${-0.5}% ${25}%, ${5 + jitter[8]}% ${3}%\n            Z\n          `}\n          fill={style.fill}\n          stroke={style.stroke}\n          strokeWidth={style.strokeWidth}\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          style={{ filter: \"url(#card-rough)\" }}\n        />\n        \n        {/* Zweite Linie für mehr Tiefe */}\n        <path\n          d={`\n            M ${6 + jitter[9]}% ${4 + jitter[10]}%\n            Q ${25}% ${0.5}%, ${50}% ${3}%\n            Q ${75}% ${0.5}%, ${94 + jitter[11]}% ${4}%\n            Q ${99.5}% ${25}%, ${96}% ${50}%\n            Q ${99.5}% ${75}%, ${94}% ${96}%\n            Q ${75}% ${99.5}%, ${50}% ${96}%\n            Q ${25}% ${99.5}%, ${6}% ${96}%\n            Q ${0.5}% ${75}%, ${4}% ${50}%\n            Q ${0.5}% ${25}%, ${6}% ${4}%\n            Z\n          `}\n          fill=\"none\"\n          stroke={style.stroke}\n          strokeWidth=\"1\"\n          strokeLinecap=\"round\"\n          opacity=\"0.4\"\n        />\n\n        {/* Schatten-Effekt für elevated */}\n        {variant === \"elevated\" && (\n          <path\n            d={`\n              M ${7}% ${6}%\n              Q ${25}% ${2}%, ${50}% ${5}%\n              Q ${75}% ${2}%, ${93}% ${6}%\n              Q ${98}% ${25}%, ${95}% ${50}%\n              Q ${98}% ${75}%, ${93}% ${95}%\n              Q ${75}% ${98}%, ${50}% ${95}%\n              Q ${25}% ${98}%, ${7}% ${95}%\n              Q ${2}% ${75}%, ${5}% ${50}%\n              Q ${2}% ${25}%, ${7}% ${6}%\n              Z\n            `}\n            fill=\"none\"\n            stroke=\"#1E40AF\"\n            strokeWidth=\"2\"\n            opacity=\"0.2\"\n            transform=\"translate(3, 3)\"\n          />\n        )}\n      </svg>\n      \n      {/* Inhalt */}\n      <div className=\"relative z-10 p-6\">\n        {children}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3400, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchToggle.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\ninterface SketchToggleProps {\n  checked: boolean;\n  onChange: (checked: boolean) => void;\n  label?: string;\n  disabled?: boolean;\n}\n\nexport function SketchToggle({\n  checked,\n  onChange,\n  label,\n  disabled = false,\n}: SketchToggleProps) {\n  // Jitter für handgezeichneten Effekt\n  const jitter = useMemo(() => {\n    return Array.from({ length: 8 }, () => (Math.random() - 0.5) * 3);\n  }, []);\n\n  const width = 60;\n  const height = 32;\n  const knobSize = 24;\n\n  // Handgezeichneter Pfad für den äußeren Rahmen\n  const trackPath = `\n    M ${16 + jitter[0]} ${2 + jitter[1]}\n    Q ${30} ${0}, ${44 + jitter[2]} ${2}\n    Q ${58} ${6}, ${58 + jitter[3]} ${16}\n    Q ${58} ${26}, ${44} ${30 + jitter[4]}\n    Q ${30} ${32}, ${16 + jitter[5]} ${30}\n    Q ${2} ${26}, ${2 + jitter[6]} ${16}\n    Q ${2} ${6}, ${16 + jitter[7]} ${2}\n    Z\n  `;\n\n  // Handgezeichneter Kreis für den Knob\n  const knobPath = (cx: number) => {\n    const segments = 16;\n    let path = \"\";\n    for (let i = 0; i <= segments; i++) {\n      const angle = (i / segments) * Math.PI * 2;\n      const r = knobSize / 2;\n      const wobble = r * 0.08 * Math.sin(i * 3);\n      const x = cx + (r + wobble) * Math.cos(angle);\n      const y = height / 2 + (r + wobble) * Math.sin(angle);\n      path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n    }\n    return path + \"Z\";\n  };\n\n  const knobX = checked ? width - knobSize / 2 - 4 : knobSize / 2 + 4;\n\n  return (\n    <label\n      className={`\n        inline-flex items-center gap-3\n        ${disabled ? \"opacity-50 cursor-not-allowed\" : \"cursor-pointer\"}\n      `}\n    >\n      <button\n        type=\"button\"\n        onClick={() => !disabled && onChange(!checked)}\n        disabled={disabled}\n        className=\"relative focus:outline-none focus:ring-2 focus:ring-blue-300 rounded-full\"\n        style={{ width, height }}\n      >\n        <svg width={width} height={height} viewBox={`0 0 ${width} ${height}`}>\n          <defs>\n            <filter\n              id=\"toggle-rough\"\n              x=\"-5%\"\n              y=\"-5%\"\n              width=\"110%\"\n              height=\"110%\"\n            >\n              <feTurbulence\n                type=\"turbulence\"\n                baseFrequency=\"0.05\"\n                numOctaves=\"2\"\n                result=\"noise\"\n              />\n              <feDisplacementMap in=\"SourceGraphic\" in2=\"noise\" scale=\"1\" />\n            </filter>\n          </defs>\n\n          {/* Track Hintergrund */}\n          <path\n            d={trackPath}\n            fill={checked ? \"#2563EB\" : \"#E5E7EB\"}\n            stroke={checked ? \"#1D4ED8\" : \"#9CA3AF\"}\n            strokeWidth=\"2.5\"\n            strokeLinecap=\"round\"\n            style={{ filter: \"url(#toggle-rough)\" }}\n          />\n\n          {/* Zweite Linie für Tiefe */}\n          <path\n            d={trackPath}\n            fill=\"none\"\n            stroke={checked ? \"#1E40AF\" : \"#6B7280\"}\n            strokeWidth=\"1\"\n            opacity=\"0.3\"\n            transform=\"translate(1, 1)\"\n          />\n\n          {/* Knob */}\n          <g\n            style={{\n              transition: \"transform 0.2s ease-out\",\n            }}\n          >\n            {/* Knob Schatten */}\n            <path\n              d={knobPath(knobX)}\n              fill=\"#1E40AF\"\n              opacity=\"0.15\"\n              transform=\"translate(2, 2)\"\n            />\n\n            {/* Knob Hauptform */}\n            <path\n              d={knobPath(knobX)}\n              fill=\"#FFFFFF\"\n              stroke=\"#2563EB\"\n              strokeWidth=\"2.5\"\n              strokeLinecap=\"round\"\n            />\n\n            {/* Knob innere Linie */}\n            <path\n              d={knobPath(knobX)}\n              fill=\"none\"\n              stroke=\"#3B82F6\"\n              strokeWidth=\"1\"\n              opacity=\"0.4\"\n              transform=\"scale(0.85)\"\n              style={{ transformOrigin: `${knobX}px ${height / 2}px` }}\n            />\n          </g>\n        </svg>\n      </button>\n\n      {label && (\n        <span className=\"font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]\">\n          {label}\n        </span>\n      )}\n    </label>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3619, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchIcon.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\ninterface SketchIconProps {\n  icon: \"shield\" | \"photo\" | \"clock\" | \"key\" | \"cloud\" | \"folder\" | \"check\" | \"warning\";\n  size?: number;\n  color?: string;\n  className?: string;\n}\n\nexport function SketchIcon({\n  icon,\n  size = 48,\n  color = \"#2563EB\",\n  className = \"\",\n}: SketchIconProps) {\n  // Generiere Jitter-Werte\n  const jitter = useMemo(() => {\n    return Array.from({ length: 20 }, () => (Math.random() - 0.5) * 2);\n  }, []);\n\n  const strokeWidth = size > 40 ? 3 : 2;\n\n  const renderIcon = () => {\n    switch (icon) {\n      case \"shield\":\n        return (\n          <>\n            {/* Schild-Form */}\n            <path\n              d={`\n                M ${size / 2 + jitter[0]} ${4 + jitter[1]}\n                Q ${size - 6 + jitter[2]} ${6}, ${size - 6} ${size / 3}\n                Q ${size - 6} ${size * 0.6}, ${size / 2} ${size - 4 + jitter[3]}\n                Q ${6} ${size * 0.6}, ${6 + jitter[4]} ${size / 3}\n                Q ${6} ${6}, ${size / 2 + jitter[5]} ${4}\n                Z\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n            {/* Checkmark im Schild */}\n            <path\n              d={`\n                M ${size * 0.3 + jitter[6]} ${size * 0.5}\n                L ${size * 0.45} ${size * 0.65 + jitter[7]}\n                L ${size * 0.7 + jitter[8]} ${size * 0.35}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n          </>\n        );\n\n      case \"photo\":\n        return (\n          <>\n            {/* Rahmen */}\n            <path\n              d={`\n                M ${6 + jitter[0]} ${8 + jitter[1]}\n                L ${size - 6 + jitter[2]} ${8}\n                L ${size - 6} ${size - 8 + jitter[3]}\n                L ${6 + jitter[4]} ${size - 8}\n                Z\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n            {/* Berge */}\n            <path\n              d={`\n                M ${10 + jitter[5]} ${size - 14}\n                L ${size * 0.35} ${size * 0.45 + jitter[6]}\n                L ${size * 0.5} ${size * 0.55}\n                L ${size * 0.65 + jitter[7]} ${size * 0.4}\n                L ${size - 10} ${size - 14 + jitter[8]}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth - 0.5}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n            {/* Sonne */}\n            <circle\n              cx={size * 0.7}\n              cy={size * 0.3}\n              r={size * 0.08}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth - 0.5}\n            />\n          </>\n        );\n\n      case \"clock\":\n        return (\n          <>\n            {/* Uhr-Kreis */}\n            <path\n              d={(() => {\n                let path = \"\";\n                const segments = 24;\n                const cx = size / 2;\n                const cy = size / 2;\n                const r = size / 2 - 6;\n                for (let i = 0; i <= segments; i++) {\n                  const angle = (i / segments) * Math.PI * 2 - Math.PI / 2;\n                  const wobble = r * 0.04 * (jitter[i % 10] || 0);\n                  const x = cx + (r + wobble) * Math.cos(angle);\n                  const y = cy + (r + wobble) * Math.sin(angle);\n                  path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n                }\n                return path + \"Z\";\n              })()}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            {/* Stundenzeiger */}\n            <path\n              d={`\n                M ${size / 2 + jitter[0]} ${size / 2}\n                L ${size / 2 - size * 0.15 + jitter[1]} ${size / 2 - size * 0.15}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            {/* Minutenzeiger */}\n            <path\n              d={`\n                M ${size / 2} ${size / 2 + jitter[2]}\n                L ${size / 2 + size * 0.2} ${size / 2 - size * 0.25 + jitter[3]}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            {/* Mitte */}\n            <circle\n              cx={size / 2}\n              cy={size / 2}\n              r={3}\n              fill={color}\n            />\n          </>\n        );\n\n      case \"key\":\n        return (\n          <>\n            {/* Schlüsselkopf */}\n            <path\n              d={(() => {\n                let path = \"\";\n                const segments = 16;\n                const cx = size * 0.3;\n                const cy = size * 0.35;\n                const r = size * 0.2;\n                for (let i = 0; i <= segments; i++) {\n                  const angle = (i / segments) * Math.PI * 2;\n                  const wobble = r * 0.06 * (jitter[i % 10] || 0);\n                  const x = cx + (r + wobble) * Math.cos(angle);\n                  const y = cy + (r + wobble) * Math.sin(angle);\n                  path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n                }\n                return path + \"Z\";\n              })()}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n            />\n            {/* Innerer Kreis */}\n            <circle\n              cx={size * 0.3}\n              cy={size * 0.35}\n              r={size * 0.08}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth - 0.5}\n            />\n            {/* Schaft */}\n            <path\n              d={`\n                M ${size * 0.45 + jitter[0]} ${size * 0.45}\n                L ${size - 8 + jitter[1]} ${size - 10}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            {/* Zähne */}\n            <path\n              d={`\n                M ${size * 0.65 + jitter[2]} ${size * 0.6}\n                L ${size * 0.72} ${size * 0.68 + jitter[3]}\n                M ${size * 0.75} ${size * 0.7 + jitter[4]}\n                L ${size * 0.82 + jitter[5]} ${size * 0.78}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n          </>\n        );\n\n      case \"cloud\":\n        return (\n          <path\n            d={`\n              M ${size * 0.25 + jitter[0]} ${size * 0.65}\n              Q ${size * 0.1} ${size * 0.65}, ${size * 0.1 + jitter[1]} ${size * 0.5}\n              Q ${size * 0.1} ${size * 0.35}, ${size * 0.25} ${size * 0.35 + jitter[2]}\n              Q ${size * 0.3} ${size * 0.2}, ${size * 0.45 + jitter[3]} ${size * 0.2}\n              Q ${size * 0.55} ${size * 0.15 + jitter[4]}, ${size * 0.65} ${size * 0.25}\n              Q ${size * 0.8} ${size * 0.2}, ${size * 0.85 + jitter[5]} ${size * 0.35}\n              Q ${size * 0.95} ${size * 0.4 + jitter[6]}, ${size * 0.9} ${size * 0.55}\n              Q ${size * 0.95} ${size * 0.65}, ${size * 0.8 + jitter[7]} ${size * 0.65}\n              Z\n            `}\n            fill=\"none\"\n            stroke={color}\n            strokeWidth={strokeWidth}\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          />\n        );\n\n      case \"folder\":\n        return (\n          <>\n            {/* Ordner-Lasche */}\n            <path\n              d={`\n                M ${8 + jitter[0]} ${size * 0.35}\n                L ${8} ${size * 0.25 + jitter[1]}\n                L ${size * 0.35 + jitter[2]} ${size * 0.25}\n                L ${size * 0.4} ${size * 0.35 + jitter[3]}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n            {/* Ordner-Körper */}\n            <path\n              d={`\n                M ${8 + jitter[4]} ${size * 0.35}\n                L ${size - 8 + jitter[5]} ${size * 0.35}\n                L ${size - 8} ${size - 10 + jitter[6]}\n                L ${8 + jitter[7]} ${size - 10}\n                Z\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n          </>\n        );\n\n      case \"check\":\n        return (\n          <path\n            d={`\n              M ${size * 0.2 + jitter[0]} ${size * 0.5}\n              L ${size * 0.4 + jitter[1]} ${size * 0.7 + jitter[2]}\n              L ${size * 0.8 + jitter[3]} ${size * 0.3}\n            `}\n            fill=\"none\"\n            stroke={color}\n            strokeWidth={strokeWidth + 1}\n            strokeLinecap=\"round\"\n            strokeLinejoin=\"round\"\n          />\n        );\n\n      case \"warning\":\n        return (\n          <>\n            {/* Dreieck */}\n            <path\n              d={`\n                M ${size / 2 + jitter[0]} ${8}\n                L ${size - 8 + jitter[1]} ${size - 10}\n                L ${8 + jitter[2]} ${size - 10}\n                Z\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n            />\n            {/* Ausrufezeichen */}\n            <path\n              d={`\n                M ${size / 2 + jitter[3]} ${size * 0.35}\n                L ${size / 2} ${size * 0.55 + jitter[4]}\n              `}\n              fill=\"none\"\n              stroke={color}\n              strokeWidth={strokeWidth}\n              strokeLinecap=\"round\"\n            />\n            <circle\n              cx={size / 2}\n              cy={size * 0.7}\n              r={2.5}\n              fill={color}\n            />\n          </>\n        );\n\n      default:\n        return null;\n    }\n  };\n\n  return (\n    <svg\n      width={size}\n      height={size}\n      viewBox={`0 0 ${size} ${size}`}\n      className={className}\n    >\n      <defs>\n        <filter id={`icon-rough-${icon}`} x=\"-5%\" y=\"-5%\" width=\"110%\" height=\"110%\">\n          <feTurbulence\n            type=\"turbulence\"\n            baseFrequency=\"0.03\"\n            numOctaves=\"2\"\n            result=\"noise\"\n          />\n          <feDisplacementMap\n            in=\"SourceGraphic\"\n            in2=\"noise\"\n            scale=\"0.5\"\n          />\n        </filter>\n      </defs>\n      <g style={{ filter: `url(#icon-rough-${icon})` }}>\n        {renderIcon()}\n      </g>\n    </svg>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAWO,SAAS,WAAW,EACzB,IAAI,EACJ,OAAO,EAAE,EACT,QAAQ,SAAS,EACjB,YAAY,EAAE,EACE;;IAChB,yBAAyB;IACzB,MAAM,SAAS,IAAA,wKAAO;sCAAC;YACrB,OAAO,MAAM,IAAI,CAAC;gBAAE,QAAQ;YAAG;8CAAG,IAAM,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;;QAClE;qCAAG,EAAE;IAEL,MAAM,cAAc,OAAO,KAAK,IAAI;IAEpC,MAAM,aAAa;QACjB,OAAQ;YACN,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC;kBACxC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,EAAE;kBACrD,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC;kBAC9D,EAAE,EAAE,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE;kBAChD,EAAE,EAAE,CAAC,EAAE,EAAE,EAAE,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE;;cAE3C,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;sCAGjB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;kBACvC,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;kBACzC,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;cAC5C,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;;;YAKvB,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC;kBACjC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE;kBAC5B,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC;kBACnC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE;;cAEhC,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;sCAGjB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,KAAK,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG;kBAC9B,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;kBACzC,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,KAAK;kBAC5B,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;kBACxC,EAAE,OAAO,GAAG,CAAC,EAAE,OAAO,KAAK,MAAM,CAAC,EAAE,CAAC;cACzC,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa,cAAc;4BAC3B,eAAc;4BACd,gBAAe;;;;;;sCAGjB,6LAAC;4BACC,IAAI,OAAO;4BACX,IAAI,OAAO;4BACX,GAAG,OAAO;4BACV,MAAK;4BACL,QAAQ;4BACR,aAAa,cAAc;;;;;;;;YAKnC,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;gCACF,IAAI,OAAO;gCACX,MAAM,WAAW;gCACjB,MAAM,KAAK,OAAO;gCAClB,MAAM,KAAK,OAAO;gCAClB,MAAM,IAAI,OAAO,IAAI;gCACrB,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;oCAClC,MAAM,QAAQ,AAAC,IAAI,WAAY,KAAK,EAAE,GAAG,IAAI,KAAK,EAAE,GAAG;oCACvD,MAAM,SAAS,IAAI,OAAO,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;oCAC9C,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;oCACvC,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;oCACvC,QAAQ,CAAC,MAAM,IAAI,OAAO,IAAI,IAAI,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gCAChD;gCACA,OAAO,OAAO;4BAChB,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;sCAGhB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,EAAE;kBACnC,EAAE,OAAO,IAAI,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI,OAAO,KAAK;cACnE,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;sCAGhB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC;kBACnC,EAAE,OAAO,IAAI,OAAO,IAAI,CAAC,EAAE,OAAO,IAAI,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;cAClE,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;sCAGhB,6LAAC;4BACC,IAAI,OAAO;4BACX,IAAI,OAAO;4BACX,GAAG;4BACH,MAAM;;;;;;;;YAKd,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;gCACF,IAAI,OAAO;gCACX,MAAM,WAAW;gCACjB,MAAM,KAAK,OAAO;gCAClB,MAAM,KAAK,OAAO;gCAClB,MAAM,IAAI,OAAO;gCACjB,IAAK,IAAI,IAAI,GAAG,KAAK,UAAU,IAAK;oCAClC,MAAM,QAAQ,AAAC,IAAI,WAAY,KAAK,EAAE,GAAG;oCACzC,MAAM,SAAS,IAAI,OAAO,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;oCAC9C,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;oCACvC,MAAM,IAAI,KAAK,CAAC,IAAI,MAAM,IAAI,KAAK,GAAG,CAAC;oCACvC,QAAQ,CAAC,MAAM,IAAI,OAAO,IAAI,IAAI,GAAG,EAAE,CAAC,EAAE,EAAE,CAAC,CAAC;gCAChD;gCACA,OAAO,OAAO;4BAChB,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;;;;;;sCAGf,6LAAC;4BACC,IAAI,OAAO;4BACX,IAAI,OAAO;4BACX,GAAG,OAAO;4BACV,MAAK;4BACL,QAAQ;4BACR,aAAa,cAAc;;;;;;sCAG7B,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBACzC,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG;cACxC,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;sCAGhB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;kBACxC,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;kBACzC,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC;kBACxC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;cAC7C,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;;;YAKtB,KAAK;gBACH,qBACE,6LAAC;oBACC,GAAG,CAAC;gBACA,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;gBACzC,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,KAAK,EAAE,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;gBACrE,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,KAAK,EAAE,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;gBACvE,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;gBACrE,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,KAAK;gBACxE,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,IAAI,EAAE,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;gBACtE,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,EAAE,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,KAAK;gBACtE,EAAE,OAAO,KAAK,CAAC,EAAE,OAAO,KAAK,EAAE,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;;YAE3E,CAAC;oBACD,MAAK;oBACL,QAAQ;oBACR,aAAa;oBACb,eAAc;oBACd,gBAAe;;;;;;YAIrB,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBAC/B,EAAE,EAAE,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;kBAC/B,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBACzC,EAAE,OAAO,IAAI,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;cAC5C,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;sCAGjB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBAC/B,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBACtC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,KAAK,MAAM,CAAC,EAAE,CAAC;kBACpC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG;;cAEjC,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;;;YAKvB,KAAK;gBACH,qBACE,6LAAC;oBACC,GAAG,CAAC;gBACA,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;gBACvC,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC;gBACnD,EAAE,OAAO,MAAM,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,IAAI;YAC3C,CAAC;oBACD,MAAK;oBACL,QAAQ;oBACR,aAAa,cAAc;oBAC3B,eAAc;oBACd,gBAAe;;;;;;YAIrB,KAAK;gBACH,qBACE;;sCAEE,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE;kBAC5B,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG;kBACpC,EAAE,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,GAAG;;cAEjC,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;4BACd,gBAAe;;;;;;sCAGjB,6LAAC;4BACC,GAAG,CAAC;kBACA,EAAE,OAAO,IAAI,MAAM,CAAC,EAAE,CAAC,CAAC,EAAE,OAAO,KAAK;kBACtC,EAAE,OAAO,EAAE,CAAC,EAAE,OAAO,OAAO,MAAM,CAAC,EAAE,CAAC;cAC1C,CAAC;4BACD,MAAK;4BACL,QAAQ;4BACR,aAAa;4BACb,eAAc;;;;;;sCAEhB,6LAAC;4BACC,IAAI,OAAO;4BACX,IAAI,OAAO;4BACX,GAAG;4BACH,MAAM;;;;;;;;YAKd;gBACE,OAAO;QACX;IACF;IAEA,qBACE,6LAAC;QACC,OAAO;QACP,QAAQ;QACR,SAAS,CAAC,IAAI,EAAE,KAAK,CAAC,EAAE,MAAM;QAC9B,WAAW;;0BAEX,6LAAC;0BACC,cAAA,6LAAC;oBAAO,IAAI,CAAC,WAAW,EAAE,MAAM;oBAAE,GAAE;oBAAM,GAAE;oBAAM,OAAM;oBAAO,QAAO;;sCACpE,6LAAC;4BACC,MAAK;4BACL,eAAc;4BACd,YAAW;4BACX,QAAO;;;;;;sCAET,6LAAC;4BACC,IAAG;4BACH,KAAI;4BACJ,OAAM;;;;;;;;;;;;;;;;;0BAIZ,6LAAC;gBAAE,OAAO;oBAAE,QAAQ,CAAC,gBAAgB,EAAE,KAAK,CAAC,CAAC;gBAAC;0BAC5C;;;;;;;;;;;;AAIT;GAlWgB;KAAA"}},
    {"offset": {"line": 4078, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchProgress.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\ninterface SketchProgressProps {\n  value: number; // 0-100\n  size?: \"sm\" | \"md\" | \"lg\";\n  showLabel?: boolean;\n  color?: string;\n  className?: string;\n}\n\nexport function SketchProgress({\n  value,\n  size = \"md\",\n  showLabel = true,\n  color = \"#2563EB\",\n  className = \"\",\n}: SketchProgressProps) {\n  // Jitter für handgezeichneten Effekt\n  const jitter = useMemo(() => {\n    return Array.from({ length: 10 }, () => (Math.random() - 0.5) * 4);\n  }, []);\n\n  const sizes = {\n    sm: { height: 12, strokeWidth: 2 },\n    md: { height: 20, strokeWidth: 3 },\n    lg: { height: 28, strokeWidth: 4 },\n  };\n\n  const { height, strokeWidth } = sizes[size];\n  const clampedValue = Math.max(0, Math.min(100, value));\n\n  return (\n    <div className={`relative ${className}`}>\n      <svg\n        width=\"100%\"\n        height={height + 8}\n        viewBox={`0 0 200 ${height + 8}`}\n        preserveAspectRatio=\"none\"\n        className=\"w-full\"\n      >\n        <defs>\n          <filter\n            id=\"progress-rough\"\n            x=\"-5%\"\n            y=\"-10%\"\n            width=\"110%\"\n            height=\"120%\"\n          >\n            <feTurbulence\n              type=\"turbulence\"\n              baseFrequency=\"0.04\"\n              numOctaves=\"2\"\n              result=\"noise\"\n            />\n            <feDisplacementMap in=\"SourceGraphic\" in2=\"noise\" scale=\"1\" />\n          </filter>\n        </defs>\n\n        {/* Hintergrund-Track */}\n        <path\n          d={`\n            M ${height / 2 + jitter[0]} ${4 + jitter[1]}\n            Q ${50} ${2}, ${100} ${4 + jitter[2]}\n            Q ${150} ${2}, ${200 - height / 2 + jitter[3]} ${4}\n            Q ${200} ${height / 2 + 4}, ${200 - height / 2} ${height + 4 + jitter[4]}\n            Q ${150} ${height + 6}, ${100} ${height + 4 + jitter[5]}\n            Q ${50} ${height + 6}, ${height / 2 + jitter[6]} ${height + 4}\n            Q ${0} ${height / 2 + 4}, ${height / 2 + jitter[7]} ${4}\n            Z\n          `}\n          fill=\"#E5E7EB\"\n          stroke=\"#9CA3AF\"\n          strokeWidth={strokeWidth - 1}\n          strokeLinecap=\"round\"\n          style={{ filter: \"url(#progress-rough)\" }}\n        />\n\n        {/* Fortschritts-Balken */}\n        {clampedValue > 0 && (\n          <path\n            d={`\n              M ${height / 2 + jitter[0]} ${4 + jitter[1]}\n              Q ${(clampedValue / 100) * 50} ${2}, ${(clampedValue / 100) * 100} ${4 + jitter[2]}\n              Q ${(clampedValue / 100) * 150} ${2}, ${Math.min((clampedValue / 100) * 200, 200 - height / 2) + jitter[3]} ${4}\n              Q ${(clampedValue / 100) * 200} ${height / 2 + 4}, ${Math.min((clampedValue / 100) * 200, 200 - height / 2)} ${height + 4 + jitter[4]}\n              Q ${(clampedValue / 100) * 150} ${height + 6}, ${(clampedValue / 100) * 100} ${height + 4 + jitter[5]}\n              Q ${(clampedValue / 100) * 50} ${height + 6}, ${height / 2 + jitter[6]} ${height + 4}\n              Q ${0} ${height / 2 + 4}, ${height / 2 + jitter[7]} ${4}\n              Z\n            `}\n            fill={color}\n            stroke={color}\n            strokeWidth={strokeWidth - 1}\n            strokeLinecap=\"round\"\n            style={{ filter: \"url(#progress-rough)\" }}\n          />\n        )}\n\n        {/* Obere Highlight-Linie */}\n        <path\n          d={`\n            M ${height / 2 + 2 + jitter[8]} ${6}\n            Q ${50} ${4}, ${100} ${6}\n            Q ${150} ${4}, ${(clampedValue / 100) * 180 + jitter[9]} ${6}\n          `}\n          fill=\"none\"\n          stroke=\"white\"\n          strokeWidth=\"1\"\n          opacity=\"0.4\"\n          strokeLinecap=\"round\"\n        />\n      </svg>\n\n      {/* Label */}\n      {showLabel && (\n        <span\n          className=\"absolute right-0 top-1/2 -translate-y-1/2 font-['Google Sans',_sans-serif] text-lg font-bold\"\n          style={{ color }}\n        >\n          {Math.round(clampedValue)}%\n        </span>\n      )}\n    </div>\n  );\n}\n\n// Circular Progress Variante\ninterface SketchCircularProgressProps {\n  value: number;\n  size?: number;\n  strokeWidth?: number;\n  color?: string;\n  showLabel?: boolean;\n}\n\nexport function SketchCircularProgress({\n  value,\n  size = 80,\n  strokeWidth = 6,\n  color = \"#2563EB\",\n  showLabel = true,\n}: SketchCircularProgressProps) {\n  const jitter = useMemo(() => {\n    return Array.from({ length: 30 }, () => (Math.random() - 0.5) * 2);\n  }, []);\n\n  const clampedValue = Math.max(0, Math.min(100, value));\n  const radius = (size - strokeWidth) / 2;\n  const cx = size / 2;\n  const cy = size / 2;\n\n  // Generiere handgezeichneten Kreis-Pfad\n  const generateCirclePath = (progress: number) => {\n    const segments = 32;\n    const endAngle = (progress / 100) * Math.PI * 2;\n    let path = \"\";\n\n    for (let i = 0; i <= segments * (progress / 100); i++) {\n      const angle = (i / segments) * Math.PI * 2 - Math.PI / 2;\n      if (angle > endAngle - Math.PI / 2) break;\n\n      const wobble = radius * 0.02 * (jitter[i % jitter.length] || 0);\n      const x = cx + (radius + wobble) * Math.cos(angle);\n      const y = cy + (radius + wobble) * Math.sin(angle);\n      path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n    }\n\n    return path;\n  };\n\n  // Hintergrund-Kreis\n  const backgroundPath = (() => {\n    let path = \"\";\n    const segments = 32;\n    for (let i = 0; i <= segments; i++) {\n      const angle = (i / segments) * Math.PI * 2 - Math.PI / 2;\n      const wobble = radius * 0.02 * (jitter[i % jitter.length] || 0);\n      const x = cx + (radius + wobble) * Math.cos(angle);\n      const y = cy + (radius + wobble) * Math.sin(angle);\n      path += (i === 0 ? \"M \" : \"L \") + `${x} ${y} `;\n    }\n    return path + \"Z\";\n  })();\n\n  return (\n    <div\n      className=\"relative inline-block\"\n      style={{ width: size, height: size }}\n    >\n      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n        <defs>\n          <filter\n            id=\"circular-rough\"\n            x=\"-5%\"\n            y=\"-5%\"\n            width=\"110%\"\n            height=\"110%\"\n          >\n            <feTurbulence\n              type=\"turbulence\"\n              baseFrequency=\"0.03\"\n              numOctaves=\"2\"\n              result=\"noise\"\n            />\n            <feDisplacementMap in=\"SourceGraphic\" in2=\"noise\" scale=\"0.5\" />\n          </filter>\n        </defs>\n\n        {/* Hintergrund */}\n        <path\n          d={backgroundPath}\n          fill=\"none\"\n          stroke=\"#E5E7EB\"\n          strokeWidth={strokeWidth}\n          strokeLinecap=\"round\"\n          style={{ filter: \"url(#circular-rough)\" }}\n        />\n\n        {/* Fortschritt */}\n        {clampedValue > 0 && (\n          <path\n            d={generateCirclePath(clampedValue)}\n            fill=\"none\"\n            stroke={color}\n            strokeWidth={strokeWidth}\n            strokeLinecap=\"round\"\n            style={{ filter: \"url(#circular-rough)\" }}\n          />\n        )}\n      </svg>\n\n      {/* Label in der Mitte */}\n      {showLabel && (\n        <div\n          className=\"absolute inset-0 flex items-center justify-center font-['Google Sans',_sans-serif] font-bold\"\n          style={{ color, fontSize: size * 0.25 }}\n        >\n          {Math.round(clampedValue)}%\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4418, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/SketchInput.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useMemo } from \"react\";\n\ninterface SketchInputProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  type?: \"text\" | \"password\" | \"email\" | \"number\";\n  label?: string;\n  icon?: React.ReactNode;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport function SketchInput({\n  value,\n  onChange,\n  placeholder = \"\",\n  type = \"text\",\n  label,\n  icon,\n  disabled = false,\n  className = \"\",\n}: SketchInputProps) {\n  // Jitter für handgezeichneten Effekt\n  const jitter = useMemo(() => {\n    return Array.from({ length: 8 }, () => (Math.random() - 0.5) * 4);\n  }, []);\n\n  return (\n    <div className={`relative ${className}`}>\n      {label && (\n        <label className=\"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2\">\n          {label}\n        </label>\n      )}\n\n      <div className=\"relative\">\n        <svg\n          className=\"absolute inset-0 w-full h-full pointer-events-none\"\n          preserveAspectRatio=\"none\"\n        >\n          <defs>\n            <filter id=\"input-rough\" x=\"-5%\" y=\"-5%\" width=\"110%\" height=\"110%\">\n              <feTurbulence\n                type=\"turbulence\"\n                baseFrequency=\"0.04\"\n                numOctaves=\"2\"\n                result=\"noise\"\n              />\n              <feDisplacementMap\n                in=\"SourceGraphic\"\n                in2=\"noise\"\n                scale=\"1\"\n                xChannelSelector=\"R\"\n                yChannelSelector=\"G\"\n              />\n            </filter>\n          </defs>\n          <path\n            d=\"M0,0 L${width},0 L${width},${height} L0,${height} Z\"\n            className=\"stroke-[#2563EB] stroke-[3] fill-none\"\n            filter=\"url(#input-rough)\"\n          />\n        </svg>\n        <input\n          type={type}\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={placeholder}\n          disabled={disabled}\n          className={`\n             relative z-10\n             w-full\n             ${icon ? \"pl-12\" : \"px-5\"} py-4\n             bg-transparent\n             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]\n             placeholder:text-[#9CA3AF]\n             focus:outline-none\n             ${disabled ? \"opacity-50 cursor-not-allowed\" : \"\"}\n           `}\n        />\n        {icon && (\n          <div className=\"absolute left-4 top-1/2 -translate-y-1/2 z-20 text-[#2563EB]/40\">\n            {icon}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Textarea Variante\ninterface SketchTextareaProps {\n  value: string;\n  onChange: (value: string) => void;\n  placeholder?: string;\n  label?: string;\n  rows?: number;\n  disabled?: boolean;\n  className?: string;\n}\n\nexport function SketchTextarea({\n  value,\n  onChange,\n  placeholder = \"\",\n  label,\n  rows = 4,\n  disabled = false,\n  className = \"\",\n}: SketchTextareaProps) {\n  const jitter = useMemo(() => {\n    return Array.from({ length: 8 }, () => (Math.random() - 0.5) * 4);\n  }, []);\n\n  return (\n    <div className={`relative ${className}`}>\n      {label && (\n        <label className=\"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2\">\n          {label}\n        </label>\n      )}\n\n      <div className=\"relative\">\n        <svg\n          className=\"absolute inset-0 w-full h-full pointer-events-none\"\n          preserveAspectRatio=\"none\"\n        >\n          <defs>\n            <filter\n              id=\"textarea-rough\"\n              x=\"-5%\"\n              y=\"-5%\"\n              width=\"110%\"\n              height=\"110%\"\n            >\n              <feTurbulence\n                type=\"turbulence\"\n                baseFrequency=\"0.03\"\n                numOctaves=\"2\"\n                result=\"noise\"\n              />\n              <feDisplacementMap\n                in=\"SourceGraphic\"\n                in2=\"noise\"\n                scale=\"1\"\n                xChannelSelector=\"R\"\n                yChannelSelector=\"G\"\n              />\n            </filter>\n          </defs>\n          <path\n            d=\"M0,0 L${width},0 L${width},${height} L0,${height} Z\"\n            className=\"stroke-[#2563EB] stroke-[3] fill-none\"\n            filter=\"url(#textarea-rough)\"\n          />\n        </svg>\n        <textarea\n          value={value}\n          onChange={(e) => onChange(e.target.value)}\n          placeholder={placeholder}\n          rows={rows}\n          disabled={disabled}\n          className={`\n             relative z-10\n             w-full\n             px-5 py-4\n             bg-transparent\n             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]\n             placeholder:text-[#9CA3AF]\n             focus:outline-none\n             resize-none\n             ${disabled ? \"opacity-50 cursor-not-allowed\" : \"\"}\n           `}\n        />\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;;;AAEA;;;AAFA;;AAeO,SAAS,YAAY,EAC1B,KAAK,EACL,QAAQ,EACR,cAAc,EAAE,EAChB,OAAO,MAAM,EACb,KAAK,EACL,IAAI,EACJ,WAAW,KAAK,EAChB,YAAY,EAAE,EACG;;IACjB,qCAAqC;IACrC,MAAM,SAAS,IAAA,wKAAO;uCAAC;YACrB,OAAO,MAAM,IAAI,CAAC;gBAAE,QAAQ;YAAE;+CAAG,IAAM,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;;QACjE;sCAAG,EAAE;IAEL,qBACE,6LAAC;QAAI,WAAW,CAAC,SAAS,EAAE,WAAW;;YACpC,uBACC,6LAAC;gBAAM,WAAU;0BACd;;;;;;0BAIL,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,WAAU;wBACV,qBAAoB;;0CAEpB,6LAAC;0CACC,cAAA,6LAAC;oCAAO,IAAG;oCAAc,GAAE;oCAAM,GAAE;oCAAM,OAAM;oCAAO,QAAO;;sDAC3D,6LAAC;4CACC,MAAK;4CACL,eAAc;4CACd,YAAW;4CACX,QAAO;;;;;;sDAET,6LAAC;4CACC,IAAG;4CACH,KAAI;4CACJ,OAAM;4CACN,kBAAiB;4CACjB,kBAAiB;;;;;;;;;;;;;;;;;0CAIvB,6LAAC;gCACC,GAAE;gCACF,WAAU;gCACV,QAAO;;;;;;;;;;;;kCAGX,6LAAC;wBACC,MAAM;wBACN,OAAO;wBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,aAAa;wBACb,UAAU;wBACV,WAAW,CAAC;;;aAGT,EAAE,OAAO,UAAU,OAAO;;;;;aAK1B,EAAE,WAAW,kCAAkC,GAAG;WACpD,CAAC;;;;;;oBAEH,sBACC,6LAAC;wBAAI,WAAU;kCACZ;;;;;;;;;;;;;;;;;;AAMb;GA5EgB;KAAA;AAyFT,SAAS,eAAe,EAC7B,KAAK,EACL,QAAQ,EACR,cAAc,EAAE,EAChB,KAAK,EACL,OAAO,CAAC,EACR,WAAW,KAAK,EAChB,YAAY,EAAE,EACM;;IACpB,MAAM,SAAS,IAAA,wKAAO;0CAAC;YACrB,OAAO,MAAM,IAAI,CAAC;gBAAE,QAAQ;YAAE;kDAAG,IAAM,CAAC,KAAK,MAAM,KAAK,GAAG,IAAI;;QACjE;yCAAG,EAAE;IAEL,qBACE,6LAAC;QAAI,WAAW,CAAC,SAAS,EAAE,WAAW;;YACpC,uBACC,6LAAC;gBAAM,WAAU;0BACd;;;;;;0BAIL,6LAAC;gBAAI,WAAU;;kCACb,6LAAC;wBACC,WAAU;wBACV,qBAAoB;;0CAEpB,6LAAC;0CACC,cAAA,6LAAC;oCACC,IAAG;oCACH,GAAE;oCACF,GAAE;oCACF,OAAM;oCACN,QAAO;;sDAEP,6LAAC;4CACC,MAAK;4CACL,eAAc;4CACd,YAAW;4CACX,QAAO;;;;;;sDAET,6LAAC;4CACC,IAAG;4CACH,KAAI;4CACJ,OAAM;4CACN,kBAAiB;4CACjB,kBAAiB;;;;;;;;;;;;;;;;;0CAIvB,6LAAC;gCACC,GAAE;gCACF,WAAU;gCACV,QAAO;;;;;;;;;;;;kCAGX,6LAAC;wBACC,OAAO;wBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;wBACxC,aAAa;wBACb,MAAM;wBACN,UAAU;wBACV,WAAW,CAAC;;;;;;;;;aAST,EAAE,WAAW,kCAAkC,GAAG;WACpD,CAAC;;;;;;;;;;;;;;;;;;AAKZ;IA5EgB;MAAA"}},
    {"offset": {"line": 4690, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/sketch-ui/index.ts"],"sourcesContent":["/**\n * Sketch UI Component Library\n * ===========================\n *\n * Handgezeichnete UI-Komponenten im blauen Sketch-Stil\n *\n * STYLE-EIGENSCHAFTEN:\n * - Blaue raue Linien (#2563EB, #3B82F6)\n * - Variable Strichstärke (2-4px)\n * - Jitter/Wobble-Effekte durch SVG\n * - Organische, handgezeichnete Formen\n *\n * FONT:\n * - Google Sans (Google Fonts) für modernen Text-Look\n *\n * VERWENDUNG:\n * import { SketchButton, SketchCard, SketchToggle } from '@/components/sketch-ui';\n */\n\nexport { SketchFilter, sketchClasses, sketchPaths } from \"./SketchStyles\";\nexport { SketchButton } from \"./SketchButton\";\nexport { SketchCard } from \"./SketchCard\";\nexport { SketchToggle } from \"./SketchToggle\";\nexport { SketchIcon } from \"./SketchIcon\";\nexport { SketchProgress, SketchCircularProgress } from \"./SketchProgress\";\nexport { SketchInput, SketchTextarea } from \"./SketchInput\";\n"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;;;;CAiBC,GAED;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 4729, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/features/settings/DevicePairing.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState } from \"react\";\nimport { QRCodeSVG } from \"qrcode.react\";\nimport { X, Copy, Check, Smartphone, QrCode } from \"lucide-react\";\nimport { useEncryption } from \"@/hooks/use-encryption\";\nimport { SketchButton, SketchCard, SketchIcon, SketchTextarea } from \"@/sketch-ui\";\nimport { Loader2 } from \"lucide-react\";\n\ninterface DevicePairingProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\ntype PairingMode = \"show\" | \"input\";\n\nexport function DevicePairing({ isOpen, onClose }: DevicePairingProps) {\n  const [mode, setMode] = useState<PairingMode>(\"show\");\n  const [inputKey, setInputKey] = useState(\"\");\n  const [copied, setCopied] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [success, setSuccess] = useState(false);\n\n  const { recoveryPhrase, restoreFromPhrase } = useEncryption();\n\n  const handleCopyKey = async () => {\n    if (!recoveryPhrase) return;\n\n    try {\n      await navigator.clipboard.writeText(recoveryPhrase);\n      setCopied(true);\n      setTimeout(() => setCopied(false), 2000);\n    } catch {\n      console.error(\"Failed to copy to clipboard\");\n    }\n  };\n\n  const handleImportKey = () => {\n    setError(null);\n\n    if (!inputKey.trim()) {\n      setError(\"Bitte gib einen Schlüssel ein\");\n      return;\n    }\n\n    const success = restoreFromPhrase(inputKey.trim());\n\n    if (success) {\n      setSuccess(true);\n      setInputKey(\"\");\n      setTimeout(() => {\n        setSuccess(false);\n        onClose();\n      }, 1500);\n    } else {\n      setError(\"Ungültiger Schlüssel. Bitte überprüfe die Eingabe.\");\n    }\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-50 px-6 backdrop-blur-sm\">\n      <SketchCard className=\"bg-white w-full max-w-[380px] p-0 shadow-2xl overflow-hidden\">\n        {/* Header with Sketch UI */}\n        <div className=\"flex items-center justify-between p-4 border-b-2 border-[#2563EB]/10\">\n          <h2 className=\"sketch-heading text-[20px] text-[#1D1D1F]\">\n            Gerät verbinden\n          </h2>\n          <button\n            onClick={onClose}\n            className=\"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5\"\n          >\n            <X className=\"w-5 h-5 text-[#6E6E73]\" />\n          </button>\n        </div>\n\n        {/* Mode Tabs with Sketch UI */}\n        <div className=\"flex border-b-2 border-[#2563EB]/10\">\n          <button\n            onClick={() => setMode(\"show\")}\n            className={`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${\n              mode === \"show\"\n                ? \"text-[#2563EB] bg-[#2563EB]/5\"\n                : \"text-[#6E6E73]\"\n            }`}\n          >\n            <QrCode className=\"w-4 h-4\" />\n            Zeigen\n          </button>\n          <button\n            onClick={() => setMode(\"input\")}\n            className={`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${\n              mode === \"input\"\n                ? \"text-[#2563EB] bg-[#2563EB]/5\"\n                : \"text-[#6E6E73]\"\n            }`}\n          >\n            Eingeben\n          </button>\n        </div>\n\n        {/* Content */}\n        <div className=\"p-5\">\n          {mode === \"show\" ? (\n            <div className=\"flex flex-col items-center\">\n              <p className=\"sketch-body text-[14px] text-[#6E6E73] text-center mb-6\">\n                Scanne den QR-Code oder kopiere den Schlüssel.\n              </p>\n \n              {/* QR Code with Sketch Card */}\n              {recoveryPhrase && (\n                <div className=\"mb-6\">\n                  <SketchCard className=\"p-4 bg-white\">\n                    <QRCodeSVG\n                      value={recoveryPhrase}\n                      size={180}\n                      level=\"M\"\n                      includeMargin={false}\n                    />\n                  </SketchCard>\n                </div>\n              )}\n \n              {/* Key Display with Sketch Card */}\n              <div className=\"w-full mb-6\">\n                <SketchCard className=\"bg-[#2563EB]/5 p-3\">\n                  <p className=\"sketch-body text-[11px] text-[#6E6E73] mb-1\">Backup-Phrase:</p>\n                  <p className=\"sketch-subheading text-[13px] break-all leading-relaxed\">\n                    {recoveryPhrase || \"Kein Schlüssel\"}\n                  </p>\n                </SketchCard>\n              </div>\n \n              {/* Copy Button */}\n              <SketchButton\n                onClick={handleCopyKey}\n                disabled={!recoveryPhrase}\n                className=\"w-full\"\n                size=\"md\"\n              >\n                {copied ? \"✓ Kopiert!\" : \"Phrase kopieren\"}\n              </SketchButton>\n            </div>\n          ) : (\n            <div className=\"flex flex-col\">\n              <p className=\"sketch-body text-[14px] text-[#6E6E73] text-center mb-6\">\n                Gib den Schlüssel deines anderen Geräts ein.\n              </p>\n \n              {/* Key Input with Sketch UI */}\n              <SketchTextarea\n                value={inputKey}\n                onChange={(val) => {\n                  setInputKey(val);\n                  setError(null);\n                }}\n                placeholder=\"Schlüssel hier einfügen...\"\n                rows={3}\n                className=\"mb-4\"\n              />\n \n              {/* Messages */}\n              {error && (\n                <p className=\"sketch-body text-[14px] text-[#FF3B30] text-center mb-4 italic\">\n                  {error}\n                </p>\n              )}\n \n              {success && (\n                <p className=\"sketch-body text-[14px] text-[#30D158] text-center mb-4 font-bold\">\n                  ✓ Erfolg!\n                </p>\n              )}\n \n              {/* Import Button */}\n              <SketchButton\n                onClick={handleImportKey}\n                disabled={!inputKey.trim() || success}\n                className=\"w-full\"\n                size=\"md\"\n              >\n                {success ? \"Verbunden\" : \"Verbinden\"}\n              </SketchButton>\n \n              {/* Warning */}\n              <p className=\"sketch-body text-[11px] text-[#FF9500] text-center mt-6\">\n                Achtung: Dies ersetzt deinen aktuellen Schlüssel!\n              </p>\n            </div>\n          )}\n        </div>\n      </SketchCard>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5044, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/SettingsPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect } from \"react\";\nimport { Plus, Loader2, Check, Cloud } from \"lucide-react\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport type { AppState } from \"./PhotoVaultApp\";\nimport { useEncryption } from \"@/hooks/use-encryption\";\nimport {\n  getDevicesForUser,\n  uploadCIDMetadata,\n  cidExistsInSupabase,\n} from \"@/lib/supabase\";\nimport { getDeviceId } from \"@/lib/deviceId\";\nimport { remoteStorage } from \"@/lib/storage/remote-storage\";\nimport { getAllPhotos, getPhotoCount } from \"@/lib/storage/local-db\";\nimport { getUserKeyHash } from \"@/lib/crypto\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { signOut } from \"@/lib/auth-client\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card } from \"@/components/ui/card\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { \n  Folder, \n  Image as ImageIcon, \n  AlertTriangle, \n  Trash2, \n  Download, \n  Key, \n  Smartphone, \n  ChevronRight,\n  RotateCcw\n} from \"lucide-react\";\n\n// Helper to format date\nfunction formatDate(dateStr?: string): string {\n  if (!dateStr) return \"Unbekannt\";\n  const date = new Date(dateStr);\n  const now = new Date();\n  const diffMs = now.getTime() - date.getTime();\n  const diffMins = Math.floor(diffMs / 60000);\n  const diffHours = Math.floor(diffMs / 3600000);\n  const diffDays = Math.floor(diffMs / 86400000);\n\n  if (diffMins < 1) return \"Gerade eben\";\n  if (diffMins < 60) return `vor ${diffMins} Min.`;\n  if (diffHours < 24) return `vor ${diffHours} Std.`;\n  if (diffDays < 7) return `vor ${diffDays} Tagen`;\n  return date.toLocaleDateString(\"de-DE\");\n}\n\ninterface SettingsPanelProps {\n  state: AppState;\n  setState: React.Dispatch<React.SetStateAction<AppState>>;\n  onRestartOnboarding: () => void;\n  authUser: { id: string; email: string } | null;\n}\n\ninterface Device {\n  id: string;\n  device_name: string;\n  device_type?: string;\n  created_at?: string;\n}\n\nimport { useSettingsStore } from \"@/lib/storage/settings-store\";\n\nexport function SettingsPanel({\n  state,\n  setState,\n  onRestartOnboarding,\n  authUser,\n}: SettingsPanelProps) {\n  const [showDevices, setShowDevices] = useState(false);\n  const [showPhraseWarning, setShowPhraseWarning] = useState(false);\n  const [showNewKeyWarning, setShowNewKeyWarning] = useState(false);\n  const [showBackupPhrase, setShowBackupPhrase] = useState(false);\n  const [showSourceSelector, setShowSourceSelector] = useState(false);\n  const [showPlanSelector, setShowPlanSelector] = useState(false);\n  const [realDevices, setRealDevices] = useState<Device[]>([]);\n\n  // Manual Backup State\n  const [isUploading, setIsUploading] = useState(false);\n  const [uploadProgress, setUploadProgress] = useState({\n    current: 0,\n    total: 0,\n  });\n\n  // Persistent Settings\n  const autoBackupEnabled = useSettingsStore(\n    (state) => state.autoBackupEnabled,\n  );\n  const setAutoBackupEnabled = useSettingsStore(\n    (state) => state.setAutoBackupEnabled,\n  );\n  const backgroundBackupEnabled = useSettingsStore(\n    (state) => state.backgroundBackupEnabled,\n  );\n  const setBackgroundBackupEnabled = useSettingsStore(\n    (state) => state.setBackgroundBackupEnabled,\n  );\n  const selectedPlan = useSettingsStore((state) => state.selectedPlan);\n  const setSelectedPlan = useSettingsStore((state) => state.setSelectedPlan);\n  const setLastBackup = useSettingsStore((state) => state.setLastBackup);\n\n  const { secretKey, recoveryPhrase, generateNewKey, clearKey } =\n    useEncryption();\n  const currentDeviceId = typeof window !== \"undefined\" ? getDeviceId() : \"\";\n  const [userKeyHash, setUserKeyHash] = useState<string | null>(null);\n\n  // Get userKeyHash\n  useEffect(() => {\n    if (secretKey) {\n      import(\"@/lib/crypto\")\n        .then((m) => m.getUserKeyHash(secretKey))\n        .then(setUserKeyHash);\n    }\n  }, [secretKey]);\n\n  // Fetch real devices from Supabase using hash (aggregates all devices with same key)\n  useEffect(() => {\n    if (!userKeyHash) return;\n\n    const fetchDevices = async () => {\n      try {\n        const devices = await getDevicesForUser(userKeyHash);\n        setRealDevices(devices as Device[]);\n      } catch (err) {\n        console.error(\"Failed to fetch devices:\", err);\n      }\n    };\n\n    fetchDevices();\n  }, [userKeyHash]);\n\n  // Real Photo Count Query\n  const { data: realPhotoCount = 0 } = useQuery({\n    queryKey: ['photoCount'],\n    queryFn: getPhotoCount,\n  });\n\n  // Get the real backup phrase words\n  const realBackupPhraseWords = recoveryPhrase?.split(\"-\").slice(0, 12) || [];\n\n  const toggleAutoBackup = () => {\n    setAutoBackupEnabled(!autoBackupEnabled);\n  };\n\n  const toggleBackgroundBackup = () => {\n    setBackgroundBackupEnabled(!backgroundBackupEnabled);\n  };\n\n  // Manual backup: Upload local photos to IPFS that aren't already there\n  const triggerManualBackup = async () => {\n    if (isUploading || !secretKey) return;\n\n    setIsUploading(true);\n    console.log(\"[Backup] Starting manual backup to IPFS...\");\n\n    try {\n      const photos = await getAllPhotos();\n      const photosWithBlobs = photos.filter((p) => p.encryptedBlob);\n\n      setUploadProgress({ current: 0, total: photosWithBlobs.length });\n\n      let uploaded = 0;\n      const deviceId = getDeviceId();\n      const keyHash = userKeyHash || (await getUserKeyHash(secretKey));\n\n      for (const photo of photosWithBlobs) {\n        if (!photo.encryptedBlob) continue;\n\n        try {\n          // Check if already in Supabase metadata for this user\n          const existsInSupabase = await cidExistsInSupabase(\n            photo.cid,\n            keyHash,\n          );\n\n          if (!existsInSupabase) {\n            // Upload encrypted blob to IPFS\n            const newCid = await remoteStorage.upload(\n              photo.encryptedBlob,\n              photo.fileName,\n            );\n            console.log(`[Backup] Uploaded to IPFS: ${newCid}`);\n\n            // Sync metadata to Supabase\n            await uploadCIDMetadata(\n              newCid,\n              photo.fileSize,\n              deviceId,\n              photo.nonce,\n              photo.mimeType,\n              keyHash,\n            );\n          }\n\n          uploaded++;\n          setUploadProgress({\n            current: uploaded,\n            total: photosWithBlobs.length,\n          });\n        } catch (err) {\n          console.error(`[Backup] Failed to upload ${photo.cid}:`, err);\n        }\n      }\n\n      setLastBackup(\"Gerade eben\");\n      console.log(`[Backup] Complete: ${uploaded} photos processed`);\n    } catch (err) {\n      console.error(\"[Backup] Failed:\", err);\n    } finally {\n      setIsUploading(false);\n      setUploadProgress({ current: 0, total: 0 });\n    }\n  };\n\n  const viewBackupPhrase = () => {\n    setShowPhraseWarning(false);\n    setShowBackupPhrase(true);\n  };\n\n  const handleGenerateNewKey = async () => {\n    clearKey();\n    const newPhrase = await generateNewKey();\n\n    if (newPhrase) {\n      setState((prev) => ({\n        ...prev,\n        photosCount: 0,\n      }));\n    }\n\n    setShowNewKeyWarning(false);\n  };\n\n  const addDevice = () => {\n    // Show the pairing modal\n    setShowDevices(false);\n    // Since DevicePairing is normally inside Dashboard,\n    // we should probably have it available here too or trigger a global state.\n    // In this component, we can just add the DevicePairing modal here as well.\n    setShowPairingFromSettings(true);\n  };\n\n  const [showPairingFromSettings, setShowPairingFromSettings] = useState(false);\n  const [showClearCacheWarning, setShowClearCacheWarning] = useState(false);\n\n  const handleClearCache = async () => {\n    try {\n      // Clear IndexedDB (Dexie)\n      const { db } = await import(\"@/lib/storage/local-db\");\n      await db.delete();\n\n      // Clear local storage\n      localStorage.clear();\n\n      // Force reload to clean state\n      window.location.reload();\n    } catch (err) {\n      console.error(\"Failed to clear cache:\", err);\n    }\n  };\n\n  const changeSource = (source: \"photos-app\" | \"files-app\") => {\n    console.log(\"Update backup source preference:\", source);\n    setState((prev) => ({ ...prev, photoSource: source }));\n    setShowSourceSelector(false);\n  };\n\n  const changePlan = (plan: \"free\" | \"backup-plus\") => {\n    console.log(\"Update plan:\", plan);\n    setSelectedPlan(plan);\n    setShowPlanSelector(false);\n  };\n\n  if (showDevices) {\n    // Transform real devices into the format expected by DevicesView\n    const displayDevices = realDevices.map((device) => ({\n      id: device.id,\n      name: device.device_name || \"Unbekanntes Gerät\",\n      lastActive:\n        device.id === currentDeviceId ? \"Aktiv\" : formatDate(device.created_at),\n      syncing: false,\n    }));\n\n    // If no devices in DB, show current device\n    if (displayDevices.length === 0) {\n      displayDevices.push({\n        id: currentDeviceId,\n        name: \"Dieses Gerät\",\n        lastActive: \"Aktiv\",\n        syncing: false,\n      });\n    }\n\n    return (\n      <DevicesView\n        devices={displayDevices}\n        onBack={() => setShowDevices(false)}\n        onAddDevice={addDevice}\n      />\n    );\n  }\n\n  return (\n    <div className=\"h-full flex flex-col pb-4 overflow-y-auto\">\n      {/* Header with Sketch UI */}\n      <header className=\"px-5 pt-8 pb-4\">\n        <h1 className=\"text-3xl font-bold tracking-tight\">Einstellungen</h1>\n      </header>\n\n      <div className=\"flex-1 px-5\">\n        {/* Backup Settings Section with Sketch UI */}\n        <div className=\"mb-8\">\n          <h2 className=\"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3\">\n            Backup\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n            <div className=\"p-4 flex items-center justify-between\">\n              <div>\n                <p className=\"text-[17px] font-medium\">\n                  Automatisches Backup\n                </p>\n                <p className=\"text-[13px] text-gray-500\">\n                  Neue Fotos automatisch sichern\n                </p>\n              </div>\n              <Switch\n                checked={autoBackupEnabled}\n                onCheckedChange={toggleAutoBackup}\n              />\n            </div>\n\n            <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />\n\n            <div className=\"p-4 flex items-center justify-between\">\n              <div>\n                <p className=\"text-[17px] font-medium\">\n                  Hintergrund-Backup\n                </p>\n                <p className=\"text-[13px] text-gray-500\">\n                  Weiter sichern wenn App geschlossen\n                </p>\n              </div>\n              <Switch\n                checked={backgroundBackupEnabled}\n                onCheckedChange={toggleBackgroundBackup}\n              />\n            </div>\n\n            <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />\n\n            <button\n              onClick={() => {}} \n              className=\"w-full flex items-center justify-between p-4 cursor-not-allowed opacity-60\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <Folder className=\"w-6 h-6 text-blue-500\" />\n                <div className=\"text-left\">\n                  <span className=\"text-[17px] font-medium block\">\n                    Backup-Quelle\n                  </span>\n                  <span className=\"text-[14px] text-gray-500 italic\">\n                    Coming Soon\n                  </span>\n                </div>\n              </div>\n            </button>\n          </div>\n\n          <div className=\"px-4 mt-4\">\n            <Button\n              onClick={triggerManualBackup}\n              disabled={isUploading || !secretKey}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-12 text-[16px]\"\n              size=\"lg\"\n            >\n              {isUploading ? (\n                <>\n                  <Loader2 className=\"w-5 h-5 animate-spin mr-2\" />\n                  {uploadProgress.total > 0\n                    ? `${uploadProgress.current}/${uploadProgress.total}`\n                    : \"Wait...\"}\n                </>\n              ) : (\n                \"Jetzt sichern\"\n              )}\n            </Button>\n          </div>\n          <p className=\"text-[13px] text-gray-500 px-4 mt-3 text-center\">\n            Alle lokalen Fotos in die Cloud hochladen\n          </p>\n        </div>\n\n        {/* Storage Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-[15px] font-semibold uppercase tracking-wide px-4 mb-3\">\n            Speicher\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n            <div className=\"p-4\">\n              <div className=\"flex items-center justify-between mb-1\">\n                <span className=\"text-[17px] font-medium\">\n                  Aktueller Plan\n                </span>\n                <span className=\"text-[16px] font-medium text-blue-600\">\n                  {selectedPlan === \"free\" ? \"Free\" : \"Backup+\"}\n                </span>\n              </div>\n              <p className=\"text-[14px] text-gray-500\">\n                {selectedPlan === \"free\"\n                  ? \"Fotos nur auf deinen Geräten\"\n                  : \"200 GB Cloud-Backup aktiv\"}\n              </p>\n            </div>\n            <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />\n            <div className=\"p-4\">\n              <div className=\"flex items-center justify-between\">\n                <span className=\"text-[15px] text-gray-500\">\n                  Verwendet\n                </span>\n                <span className=\"text-[15px] font-medium\">\n                  {realPhotoCount.toLocaleString()} Fotos (lokal)\n                </span>\n              </div>\n            </div>\n            <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />\n            <button\n              onClick={() => setShowPlanSelector(true)}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors\"\n            >\n              <span className=\"text-[17px] font-medium text-blue-600\">\n                {selectedPlan === \"free\"\n                  ? \"Upgrade zu Backup+\"\n                  : \"Plan verwalten\"}\n              </span>\n              <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n            </button>\n          </div>\n        </div>\n\n        {/* Devices Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-[15px] font-semibold uppercase tracking-wide px-4 mb-3\">\n            Geräte\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n            <button\n              onClick={() => setShowDevices(true)}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <Smartphone className=\"w-7 h-7 text-gray-900 dark:text-gray-100\" />\n                <span className=\"text-[17px] font-medium\">\n                  Verbundene Geräte\n                </span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <span className=\"text-[15px] text-gray-500\">\n                  {realDevices.length || 1}\n                </span>\n                <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n              </div>\n            </button>\n          </div>\n        </div>\n\n        {/* Security Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-[15px] font-semibold uppercase tracking-wide px-4 mb-3\">\n            Sicherheit\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n            <button\n              onClick={() => setShowPhraseWarning(true)}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-gray-50 dark:hover:bg-white/5 transition-colors\"\n            >\n              <span className=\"text-[17px] font-medium\">\n                Backup-Phrase anzeigen\n              </span>\n              <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n            </button>\n            <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />\n            <button\n              onClick={() => setShowNewKeyWarning(true)}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors\"\n            >\n              <span className=\"text-[17px] font-medium text-red-500\">\n                Neuen Schlüssel erstellen\n              </span>\n              <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n            </button>\n          </div>\n          <p className=\"text-[13px] text-gray-500 px-4 mt-3\">\n            Teile diese Wörter niemals mit anderen.\n          </p>\n        </div>\n\n        {/* Maintenance Section */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-[15px] font-semibold uppercase tracking-wide px-4 mb-3\">\n            Wartung\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n            <button\n              onClick={() => setShowClearCacheWarning(true)}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-orange-50 dark:hover:bg-orange-900/10 transition-colors\"\n            >\n              <div className=\"flex items-center gap-4\">\n                <AlertTriangle className=\"w-7 h-7 text-orange-500\" />\n                <span className=\"text-[17px] font-medium text-orange-500\">\n                  Lokalen Cache leeren\n                </span>\n              </div>\n              <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n            </button>\n          </div>\n          <p className=\"text-[13px] text-gray-500 px-4 mt-3\">\n            Löscht lokale Vorschaubilder. Deine Cloud-Fotos bleiben sicher.\n          </p>\n        </div>\n\n        {/* Danger Zone */}\n        <div className=\"mb-8\">\n          <h2 className=\"text-[15px] font-semibold uppercase tracking-wide px-4 mb-3 text-red-500\">\n            Danger Zone\n          </h2>\n          <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-red-200 dark:border-red-900/30\">\n            <button\n              onClick={async () => {\n                if (confirm(\"WARNUNG: Möchtest du deinen Account wirklich löschen?\\n\\nDies wird alle lokalen Daten und deine Verknüpfung löschen. Cloud-Daten sind ohne den Schlüssel unbrauchbar. Diese Aktion ist nicht widerrufbar.\")) {\n                    try {\n                        const { db } = await import(\"@/lib/storage/local-db\");\n                        await db.delete();\n                        localStorage.clear();\n                        await signOut();\n                        window.location.reload();\n                    } catch(e) {\n                         alert(\"Fehler beim Löschen.\");\n                    }\n                }\n              }}\n              className=\"w-full flex items-center justify-between p-4 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors group\"\n            >\n              <div className=\"flex items-center gap-4\">\n                 <div className=\"p-1 rounded-full bg-red-100 dark:bg-red-900/20\">\n                    <AlertTriangle className=\"w-6 h-6 text-red-500\" />\n                 </div>\n                <div className=\"text-left\">\n                  <span className=\"text-[17px] font-medium text-red-500 block\">\n                    Account löschen\n                  </span>\n                  <span className=\"text-[13px] text-red-400\">\n                    Daten unwiderruflich löschen\n                  </span>\n                </div>\n              </div>\n            </button>\n            <div className=\"h-[1px] bg-red-100 dark:bg-red-900/20 mx-4\" />\n            <button\n               onClick={() => alert(\"Daten-Export wird vorbereitet... (Mock)\")}\n               className=\"w-full flex items-center justify-between p-4 hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors\"\n            >\n               <span className=\"text-[15px] font-medium text-gray-900 dark:text-gray-100 pl-2\">\n                 Meine Daten anfordern\n               </span>\n               <ChevronRight className=\"w-4 h-4 text-gray-400\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* View Backup Phrase Warning Modal */}\n      {showPhraseWarning && (\n        <Modal\n          title=\"Sicherheitshinweis\"\n          message=\"Deine Backup-Phrase gibt vollen Zugriff auf deine verschlüsselten Fotos. Nur an einem privaten Ort anzeigen.\"\n          confirmLabel=\"Phrase anzeigen\"\n          confirmDestructive={false}\n          onConfirm={viewBackupPhrase}\n          onCancel={() => setShowPhraseWarning(false)}\n        />\n      )}\n\n      {/* Show Backup Phrase Modal */}\n      {showBackupPhrase && (\n        <div className=\"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-6 backdrop-blur-sm\">\n          <div className=\"bg-white dark:bg-gray-900 w-full max-w-[400px] p-6 shadow-2xl rounded-3xl border border-white/20\">\n            <h3 className=\"text-2xl font-bold text-center mb-2\">\n              Back-up Phrase\n            </h3>\n            <p className=\"text-[14px] text-gray-500 text-center mb-6\">\n              Notiere diese Wörter sicher.\n            </p>\n\n            {realBackupPhraseWords.length > 0 ? (\n              <div className=\"grid grid-cols-2 gap-3 mb-6\">\n                {realBackupPhraseWords.map((word, index) => (\n                  <div\n                    key={index}\n                    className=\"p-2 text-center bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-100 dark:border-blue-800\"\n                  >\n                    <span className=\"text-[10px] text-gray-400 block uppercase tracking-wider\">\n                      {index + 1}\n                    </span>\n                    <span className=\"text-[14px] font-medium font-mono\">\n                      {word}\n                    </span>\n                  </div>\n                ))}\n              </div>\n            ) : (\n              <div className=\"mb-6\">\n                <div className=\"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 p-4 rounded-xl\">\n                  <p className=\"text-[13px] text-orange-600 text-center font-medium\">\n                    Kein Schlüssel gefunden.\n                  </p>\n                </div>\n              </div>\n            )}\n\n            <Button\n              onClick={() => setShowBackupPhrase(false)}\n              className=\"w-full bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-12 text-[16px]\"\n            >\n              Fertig\n            </Button>\n          </div>\n        </div>\n      )}\n\n      {/* Generate New Key Warning Modal */}\n      {showNewKeyWarning && (\n        <Modal\n          title=\"Datenverlust-Warnung\"\n          message=\"Das Erstellen eines neuen Schlüssels löscht alle vorhandenen Backup-Daten permanent. Diese Aktion kann nicht rückgängig gemacht werden.\"\n          confirmLabel=\"Neuen Schlüssel erstellen\"\n          confirmDestructive={true}\n          onConfirm={handleGenerateNewKey}\n          onCancel={() => setShowNewKeyWarning(false)}\n        />\n      )}\n\n      {/* Source Selector Modal */}\n      {showSourceSelector && (\n        <SourceSelectorModal\n          currentSource={state.photoSource}\n          onSelect={changeSource}\n          onClose={() => setShowSourceSelector(false)}\n        />\n      )}\n\n      {/* Plan Selector Modal */}\n      {showPlanSelector && (\n        <PlanSelectorModal\n          currentPlan={selectedPlan}\n          onSelect={changePlan}\n          onClose={() => setShowPlanSelector(false)}\n        />\n      )}\n\n      {/* Clear Cache Warning Modal */}\n      {showClearCacheWarning && (\n        <Modal\n          title=\"Cache leeren?\"\n          message=\"Dies wird lokale Vorschaubilder und Gerätedaten löschen. Deine verschlüsselten Fotos in der Cloud bleiben sicher. Die App wird neu geladen.\"\n          confirmLabel=\"Cache leeren\"\n          confirmDestructive={true}\n          onConfirm={handleClearCache}\n          onCancel={() => setShowClearCacheWarning(false)}\n        />\n      )}\n\n      {/* Device Pairing Modal */}\n      <DevicePairing\n        isOpen={showPairingFromSettings}\n        onClose={() => setShowPairingFromSettings(false)}\n      />\n    </div>\n  );\n}\n\nimport { DevicePairing } from \"@/components/features/settings/DevicePairing\";\n\nfunction SettingsToggleRow({\n  label,\n  description,\n  enabled,\n  onToggle,\n}: {\n  label: string;\n  description: string;\n  enabled: boolean;\n  onToggle: () => void;\n}) {\n  return (\n    <button\n      onClick={onToggle}\n      className=\"w-full flex items-center justify-between p-4 ios-tap-target\"\n    >\n      <div className=\"text-left\">\n        <p className=\"text-[17px] text-[#1D1D1F]\">{label}</p>\n        <p className=\"text-[13px] text-[#6E6E73] mt-0.5\">{description}</p>\n      </div>\n      <div\n        className={`w-[51px] h-[31px] rounded-full p-[2px] shrink-0 ${\n          enabled ? \"bg-[#30D158]\" : \"bg-[#E5E5EA]\"\n        }`}\n      >\n        <div\n          className={`w-[27px] h-[27px] rounded-full bg-white shadow-sm ${\n            enabled ? \"ml-auto\" : \"\"\n          }`}\n        />\n      </div>\n    </button>\n  );\n}\n\nfunction DevicesView({\n  devices,\n  onBack,\n  onAddDevice,\n}: {\n  devices: {\n    id: string;\n    name: string;\n    lastActive: string;\n    syncing?: boolean;\n  }[];\n  onBack: () => void;\n  onAddDevice: () => void;\n}) {\n  return (\n    <div className=\"h-full flex flex-col pb-4 overflow-y-auto bg-[#FAFBFC]\">\n      {/* Header with Sketch UI */}\n      <header className=\"px-5 pt-6 pb-4\">\n        <button\n          onClick={onBack}\n          className=\"text-blue-600 mb-2 flex items-center gap-2 hover:underline\"\n        >\n          ← Zurück\n        </button>\n        <h1 className=\"text-3xl font-bold tracking-tight\">Geräte</h1>\n      </header>\n\n      <div className=\"flex-1 px-5\">\n        <div className=\"bg-white dark:bg-black/40 backdrop-blur-md rounded-2xl overflow-hidden shadow-sm border border-gray-100 dark:border-white/10\">\n          {devices.map((device, index) => (\n            <div key={device.id}>\n              {index > 0 && <div className=\"h-[1px] bg-gray-200 dark:bg-white/10 mx-4\" />}\n              <div className=\"flex items-center gap-4 p-4\">\n                <Smartphone className=\"w-8 h-8 text-gray-400\" />\n                <div className=\"flex-1\">\n                  <p className=\"text-[17px] font-medium text-gray-900 dark:text-gray-100\">\n                    {device.name}\n                  </p>\n                  <p className=\"text-[13px] text-gray-500\">\n                    {device.lastActive}\n                  </p>\n                </div>\n                {device.syncing ? (\n                  <Loader2 className=\"w-5 h-5 text-blue-500 animate-spin\" />\n                ) : device.lastActive === \"Aktiv\" ? (\n                  <div className=\"flex items-center gap-1\">\n                    <div className=\"w-2 h-2 rounded-full bg-green-500\" />\n                    <span className=\"text-[13px] font-medium text-green-500\">\n                      Aktiv\n                    </span>\n                  </div>\n                ) : null}\n              </div>\n            </div>\n          ))}\n        </div>\n\n        <Button onClick={onAddDevice} className=\"w-full mt-8 bg-blue-600 hover:bg-blue-700 text-white rounded-xl h-12\" size=\"lg\">\n          Neu verbinden\n        </Button>\n\n        <p className=\"text-[13px] text-gray-500 text-center mt-4 px-4\">\n          Schlüssel scannen oder Recovery-Phrase eingeben\n        </p>\n      </div>\n    </div>\n  );\n}\n\nfunction SourceSelectorModal({\n  currentSource,\n  onSelect,\n  onClose,\n}: {\n  currentSource: \"photos-app\" | \"files-app\";\n  onSelect: (source: \"photos-app\" | \"files-app\") => void;\n  onClose: () => void;\n}) {\n  const sources = [\n    {\n      id: \"photos-app\" as const,\n      label: \"Fotos-App\",\n      description: \"Alle Fotos aus der iOS Foto-Bibliothek\",\n    },\n    {\n      id: \"files-app\" as const,\n      label: \"Dateien-App\",\n      description: \"Fotos aus einem bestimmten Ordner\",\n    },\n  ];\n\n  return (\n    <div className=\"fixed inset-0 bg-black/40 flex items-end justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-900 w-full max-w-[428px] rounded-t-2xl p-6 pb-10 border-t border-gray-200 dark:border-gray-800\">\n        <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white text-center mb-2\">\n          Backup-Quelle\n        </h3>\n        <p className=\"text-[15px] text-gray-500 text-center mb-6\">\n          Wo sind deine Fotos gespeichert?\n        </p>\n\n        <div className=\"space-y-3 mb-6\">\n          {sources.map((source) => (\n            <button\n              key={source.id}\n              onClick={() => onSelect(source.id)}\n              className={`w-full p-4 rounded-xl bg-gray-50 dark:bg-white/5 text-left ios-tap-target transition-all ${\n                currentSource === source.id ? \"ring-2 ring-blue-500 bg-blue-50 dark:bg-blue-900/20\" : \"hover:bg-gray-100 dark:hover:bg-white/10\"\n              }`}\n            >\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-[17px] font-medium text-gray-900 dark:text-white\">\n                    {source.label}\n                  </p>\n                  <p className=\"text-[13px] text-gray-500 mt-0.5\">\n                    {source.description}\n                  </p>\n                </div>\n                <div\n                  className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${\n                    currentSource === source.id\n                      ? \"border-blue-500 bg-blue-500\"\n                      : \"border-gray-300 dark:border-gray-600\"\n                  }`}\n                >\n                  {currentSource === source.id && (\n                    <div className=\"w-2.5 h-2.5 rounded-full bg-white\" />\n                  )}\n                </div>\n              </div>\n            </button>\n          ))}\n        </div>\n\n        <button\n          onClick={onClose}\n          className=\"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target\"\n        >\n          Abbrechen\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction PlanSelectorModal({\n  currentPlan,\n  onSelect,\n  onClose,\n}: {\n  currentPlan: \"free\" | \"backup-plus\";\n  onSelect: (plan: \"free\" | \"backup-plus\") => void;\n  onClose: () => void;\n}) {\n  const plans = [\n    {\n      id: \"free\" as const,\n      label: \"FREE\",\n      subtitle: \"Auf deinen Geräten\",\n      price: \"0€/Monat\",\n      features: [\n        \"Unbegrenzte Fotos\",\n        \"Zero-Knowledge Verschlüsselung\",\n        \"Multi-Device Sync\",\n      ],\n    },\n    {\n      id: \"backup-plus\" as const,\n      label: \"BACKUP+ (Coming Soon)\",\n      subtitle: \"Dauerhaft im Netz\",\n      price: \"2,99€/Monat\",\n      features: [\n        \"Alles von Free\",\n        \"200 GB Cloud-Backup\",\n        \"Schnellere Synchronisierung\",\n      ],\n      disabled: true,\n    },\n  ];\n\n  return (\n    <div className=\"fixed inset-0 bg-black/40 flex items-end justify-center z-50\">\n      <div className=\"bg-white dark:bg-gray-900 w-full max-w-[428px] rounded-t-2xl p-6 pb-10 max-h-[80vh] overflow-y-auto border-t border-gray-200 dark:border-gray-800\">\n        <h3 className=\"text-2xl font-bold text-gray-900 dark:text-white text-center mb-2\">\n          Speicherplan\n        </h3>\n        <p className=\"text-[15px] text-gray-500 text-center mb-6\">\n          Du kannst jederzeit wechseln\n        </p>\n\n        <div className=\"space-y-3 mb-6\">\n          {plans.map((plan) => (\n            <button\n              key={plan.id}\n              onClick={() => !plan.disabled && onSelect(plan.id)}\n              disabled={plan.disabled}\n              className={`w-full p-4 rounded-xl text-left ios-tap-target transition-all ${\n                plan.disabled\n                  ? \"bg-gray-50 dark:bg-white/5 cursor-not-allowed opacity-60\"\n                  : currentPlan === plan.id\n                    ? \"bg-blue-50 dark:bg-blue-900/20 ring-2 ring-blue-500\"\n                    : \"bg-gray-50 dark:bg-white/5 hover:bg-gray-100 dark:hover:bg-white/10\"\n              }`}\n            >\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <p className=\"text-[13px] font-bold text-blue-600 dark:text-blue-400 tracking-wide\">\n                    {plan.label}\n                  </p>\n                  <p className=\"text-[17px] font-semibold text-gray-900 dark:text-white mt-0.5\">\n                    {plan.subtitle}\n                  </p>\n                  <ul className=\"mt-2 space-y-1\">\n                    {plan.features.map((feature) => (\n                      <li\n                        key={feature}\n                        className=\"text-[13px] text-gray-500 flex items-center gap-2\"\n                      >\n                        <span className=\"text-green-500\">✓</span> {feature}\n                      </li>\n                    ))}\n                  </ul>\n                  <p className=\"text-[15px] font-semibold text-gray-900 dark:text-white mt-3\">\n                    {plan.price}\n                  </p>\n                </div>\n                <div\n                  className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${\n                    currentPlan === plan.id\n                      ? \"border-blue-500 bg-blue-500\"\n                      : \"border-gray-300 dark:border-gray-600\"\n                  }`}\n                >\n                  {currentPlan === plan.id && (\n                    <div className=\"w-2.5 h-2.5 rounded-full bg-white\" />\n                  )}\n                </div>\n              </div>\n            </button>\n          ))}\n        </div>\n\n        <button\n          onClick={onClose}\n          className=\"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target\"\n        >\n          Abbrechen\n        </button>\n      </div>\n    </div>\n  );\n}\n\nfunction Modal({\n  title,\n  message,\n  confirmLabel,\n  confirmDestructive,\n  onConfirm,\n  onCancel,\n}: {\n  title: string;\n  message: string;\n  confirmLabel: string;\n  confirmDestructive: boolean;\n  onConfirm: () => void;\n  onCancel: () => void;\n}) {\n  return (\n    <div className=\"fixed inset-0 bg-black/40 flex items-center justify-center z-50 px-8\">\n      <div className=\"bg-white dark:bg-gray-800 w-full max-w-[270px] rounded-2xl overflow-hidden shadow-2xl\">\n        <div className=\"p-4 text-center\">\n          <h3 className=\"text-[17px] font-semibold text-gray-900 dark:text-white mb-1\">\n            {title}\n          </h3>\n          <p className=\"text-[13px] text-gray-500 leading-relaxed\">\n            {message}\n          </p>\n        </div>\n        <div className=\"border-t border-[#E5E5EA]\">\n          <button\n            onClick={onCancel}\n            className=\"w-full py-3 text-[17px] text-[#007AFF] border-b border-[#E5E5EA] ios-tap-target\"\n          >\n            Abbrechen\n          </button>\n          <button\n            onClick={onConfirm}\n            className={`w-full py-3 text-[17px] font-semibold ios-tap-target ${\n              confirmDestructive ? \"text-[#FF3B30]\" : \"text-[#007AFF]\"\n            }`}\n          >\n            {confirmLabel}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6818, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/storage/photo-manager.ts"],"sourcesContent":["/**\n * Photo Manager - Unified Photo Operations Across All Storage Layers\n *\n * Coordinates operations between:\n * - Local IndexedDB (encrypted blob cache)\n * - Supabase (metadata sync)\n * - IPFS/Pinata (encrypted content storage)\n *\n * This module provides high-level functions that ensure consistency\n * across all storage layers.\n */\n\nimport { deletePhoto, type PhotoMetadata } from './local-db';\nimport { deletePhotoMetadata } from '@/lib/supabase';\nimport { unpinFromIPFS, isValidCID } from '@/lib/ipfs';\n\nexport interface DeleteResult {\n    local: boolean;\n    supabase: boolean;\n    ipfs: boolean;\n    errors: string[];\n}\n\n/**\n * Delete a photo from ALL storage layers\n *\n * Order of operations:\n * 1. Delete from local IndexedDB (immediate UI impact)\n * 2. Delete metadata from Supabase (cross-device sync)\n * 3. Unpin from IPFS/Pinata (optional cleanup - doesn't delete content)\n *\n * Note: IPFS content is immutable. Unpinning only removes it from our pin,\n * but it may still be accessible if pinned elsewhere.\n *\n * @param localId - The IndexedDB ID of the photo (optional)\n * @param cid - The IPFS Content Identifier\n * @returns Object with success status for each layer\n */\nexport async function deletePhotoGlobally(\n    cid: string,\n    localId?: number\n): Promise<DeleteResult> {\n    const result: DeleteResult = {\n        local: false,\n        supabase: false,\n        ipfs: false,\n        errors: []\n    };\n\n    console.log('[PhotoManager] Starting global delete for CID:', cid);\n\n    // Step 1: Delete from local IndexedDB\n    if (localId !== undefined && localId > 0) {\n        try {\n            await deletePhoto(localId);\n            result.local = true;\n            console.log('[PhotoManager] Deleted from IndexedDB:', localId);\n        } catch (error) {\n            const message = `IndexedDB delete failed: ${error}`;\n            result.errors.push(message);\n            console.error('[PhotoManager]', message);\n        }\n    } else {\n        console.log('[PhotoManager] No local ID provided, skipping IndexedDB delete');\n        result.local = true; // Consider success if no local ID\n    }\n\n    // Step 2: Delete metadata from Supabase\n    try {\n        await deletePhotoMetadata(cid);\n        result.supabase = true;\n        console.log('[PhotoManager] Deleted from Supabase:', cid);\n    } catch (error) {\n        const message = `Supabase delete failed: ${error}`;\n        result.errors.push(message);\n        console.error('[PhotoManager]', message);\n    }\n\n    // Step 3: Unpin from IPFS/Pinata (optional, non-critical)\n    // Skip for temporary/mock CIDs\n    if (isValidCID(cid)) {\n        try {\n            await unpinFromIPFS(cid);\n            result.ipfs = true;\n            console.log('[PhotoManager] Unpinned from IPFS:', cid);\n        } catch (error) {\n            // Don't add to errors - unpin failure is non-critical\n            console.warn('[PhotoManager] IPFS unpin failed (non-critical):', error);\n            result.ipfs = false;\n        }\n    } else {\n        console.log('[PhotoManager] Skipping IPFS unpin for mock/temp CID:', cid);\n        result.ipfs = true; // Consider success for non-IPFS CIDs\n    }\n\n    console.log('[PhotoManager] Global delete complete:', result);\n    return result;\n}\n\n/**\n * Delete multiple photos in batch\n *\n * More efficient than calling deletePhotoGlobally for each photo\n * because it can batch Supabase operations.\n *\n * @param photos - Array of { cid, localId } objects\n * @returns Array of results for each photo\n */\nexport async function deletePhotosGlobally(\n    photos: Array<{ cid: string; localId?: number }>\n): Promise<DeleteResult[]> {\n    console.log('[PhotoManager] Starting batch delete for', photos.length, 'photos');\n\n    // Process in parallel with concurrency limit\n    const concurrencyLimit = 5;\n    const results: DeleteResult[] = [];\n\n    for (let i = 0; i < photos.length; i += concurrencyLimit) {\n        const batch = photos.slice(i, i + concurrencyLimit);\n        const batchResults = await Promise.all(\n            batch.map(p => deletePhotoGlobally(p.cid, p.localId))\n        );\n        results.push(...batchResults);\n    }\n\n    const successCount = results.filter(r => r.local && r.supabase).length;\n    console.log('[PhotoManager] Batch delete complete:', successCount, '/', photos.length, 'fully successful');\n\n    return results;\n}\n\n/**\n * Purge ALL photos for the current user\n *\n * WARNING: This is destructive and cannot be undone!\n * Use with extreme caution.\n *\n * @param photos - All photos to delete\n * @returns Summary of deletion results\n */\nexport async function purgeAllPhotos(\n    photos: PhotoMetadata[]\n): Promise<{\n    total: number;\n    successful: number;\n    failed: number;\n    errors: string[];\n}> {\n    console.warn('[PhotoManager] PURGING ALL PHOTOS:', photos.length);\n\n    const toDelete = photos.map(p => ({\n        cid: p.cid,\n        localId: p.id\n    }));\n\n    const results = await deletePhotosGlobally(toDelete);\n\n    const successful = results.filter(r => r.local && r.supabase).length;\n    const failed = results.length - successful;\n    const allErrors = results.flatMap(r => r.errors);\n\n    return {\n        total: photos.length,\n        successful,\n        failed,\n        errors: allErrors\n    };\n}\n\n/**\n * Sync check: Find orphaned entries\n *\n * Identifies photos that exist in one storage layer but not others.\n * Useful for debugging sync issues.\n */\nexport interface OrphanReport {\n    localOnly: PhotoMetadata[];      // In IndexedDB but not Supabase\n    supabaseOnly: string[];          // CIDs in Supabase but not local\n    unpinnedCIDs: string[];          // Valid CIDs that aren't pinned\n}\n\n/**\n * Check for storage inconsistencies\n * (placeholder for future implementation)\n */\nexport async function findOrphanedPhotos(\n    _localPhotos: PhotoMetadata[],\n    _supabaseCIDs: string[]\n): Promise<OrphanReport> {\n    // TODO: Implement orphan detection\n    return {\n        localOnly: [],\n        supabaseOnly: [],\n        unpinnedCIDs: []\n    };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6942, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/lib/heic-converter.ts"],"sourcesContent":["/**\n * HEIC Converter - Non-blocking HEIC to JPEG conversion\n * Uses Web Worker for iPad/iPhone performance optimization\n *\n * Phase 2: Performance Optimization\n */\n\ninterface ConversionResult {\n    file: File;\n    converted: boolean;\n    originalSize?: number;\n    convertedSize?: number;\n}\n\n// Singleton worker instance\nlet worker: Worker | null = null;\nlet messageId = 0;\nconst pendingConversions = new Map<number, {\n    resolve: (result: ConversionResult) => void;\n    reject: (error: Error) => void;\n}>();\n\n/**\n * Initialize the HEIC worker (lazy initialization)\n */\nfunction getWorker(): Worker | null {\n    if (typeof window === 'undefined') return null;\n\n    if (!worker) {\n        try {\n            worker = new Worker('/workers/heic-worker.js');\n            worker.onmessage = handleWorkerMessage;\n            worker.onerror = handleWorkerError;\n            console.log('[HEIC] Worker initialized');\n        } catch (error) {\n            console.warn('[HEIC] Worker creation failed, will use main thread:', error);\n            return null;\n        }\n    }\n\n    return worker;\n}\n\n/**\n * Handle messages from the worker\n */\nfunction handleWorkerMessage(e: MessageEvent) {\n    const { id, success, file, blob, fileName, mimeType, converted, error, originalSize, convertedSize } = e.data;\n\n    const pending = pendingConversions.get(id);\n    if (!pending) return;\n\n    pendingConversions.delete(id);\n\n    if (!success) {\n        pending.reject(new Error(error || 'Conversion failed'));\n        return;\n    }\n\n    // If we got a blob back, create a File from it\n    if (blob && converted) {\n        const convertedFile = new File([blob], fileName, {\n            type: mimeType,\n            lastModified: Date.now()\n        });\n        pending.resolve({\n            file: convertedFile,\n            converted: true,\n            originalSize,\n            convertedSize\n        });\n    } else {\n        // Original file returned (not HEIC or conversion skipped)\n        pending.resolve({\n            file: file,\n            converted: false\n        });\n    }\n}\n\n/**\n * Handle worker errors\n */\nfunction handleWorkerError(error: ErrorEvent) {\n    console.error('[HEIC] Worker error:', error);\n    // Reject all pending conversions\n    pendingConversions.forEach(({ reject }) => {\n        reject(new Error('Worker error: ' + error.message));\n    });\n    pendingConversions.clear();\n\n    // Reset worker for retry\n    worker = null;\n}\n\n/**\n * Convert HEIC/HEIF to JPEG using Web Worker (non-blocking)\n * Falls back to main thread if worker is unavailable\n */\nexport async function convertHeicToJpeg(file: File, quality: number = 0.92): Promise<ConversionResult> {\n    // Check if conversion is needed first\n    const heicTypes = ['image/heic', 'image/heif', 'image/heic-sequence', 'image/heif-sequence'];\n    const isHeic = heicTypes.includes(file.type?.toLowerCase()) ||\n                   file.name?.toLowerCase().endsWith('.heic') ||\n                   file.name?.toLowerCase().endsWith('.heif');\n\n    if (!isHeic) {\n        return { file, converted: false };\n    }\n\n    // Try to use Web Worker for non-blocking conversion\n    const workerInstance = getWorker();\n\n    if (workerInstance) {\n        return new Promise((resolve, reject) => {\n            const id = ++messageId;\n            pendingConversions.set(id, { resolve, reject });\n\n            // Set timeout for conversion (2 minutes max)\n            setTimeout(() => {\n                if (pendingConversions.has(id)) {\n                    pendingConversions.delete(id);\n                    console.warn('[HEIC] Worker timeout, falling back to main thread');\n                    convertOnMainThread(file, quality).then(resolve).catch(reject);\n                }\n            }, 120000);\n\n            workerInstance.postMessage({ id, file, quality });\n        });\n    }\n\n    // Fallback to main thread\n    console.log('[HEIC] Using main thread conversion');\n    return convertOnMainThread(file, quality);\n}\n\n/**\n * Fallback: Convert on main thread (blocks UI but works everywhere)\n */\nasync function convertOnMainThread(file: File, quality: number): Promise<ConversionResult> {\n    try {\n        // Dynamic import heic2any\n        const heic2any = (await import('heic2any')).default;\n\n        const convertedBlob = await heic2any({\n            blob: file,\n            toType: 'image/jpeg',\n            quality\n        });\n\n        const resultBlob = Array.isArray(convertedBlob) ? convertedBlob[0] : convertedBlob;\n        const newFileName = file.name.replace(/\\.(heic|heif)$/i, '.jpg');\n\n        const convertedFile = new File([resultBlob], newFileName, {\n            type: 'image/jpeg',\n            lastModified: file.lastModified\n        });\n\n        return {\n            file: convertedFile,\n            converted: true,\n            originalSize: file.size,\n            convertedSize: convertedFile.size\n        };\n    } catch (error) {\n        console.error('[HEIC] Main thread conversion failed:', error);\n        // Return original on error\n        return { file, converted: false };\n    }\n}\n\n/**\n * Check if the file is a HEIC/HEIF image\n */\nexport function isHeicFile(file: File): boolean {\n    const heicTypes = ['image/heic', 'image/heif', 'image/heic-sequence', 'image/heif-sequence'];\n    return heicTypes.includes(file.type?.toLowerCase()) ||\n           file.name?.toLowerCase().endsWith('.heic') ||\n           file.name?.toLowerCase().endsWith('.heif');\n}\n\n/**\n * Terminate the worker (call on app cleanup)\n */\nexport function terminateHeicWorker(): void {\n    if (worker) {\n        worker.terminate();\n        worker = null;\n        pendingConversions.clear();\n        console.log('[HEIC] Worker terminated');\n    }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7123, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/hooks/use-gallery-data.ts"],"sourcesContent":["/**\n * useGalleryData Hook - Local Photo Gallery Management with IPFS Cloud Sync\n * Photos are encrypted client-side and stored on IPFS\n * Only metadata (CID, nonce, etc.) is stored in Supabase\n */\n\n'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';\nimport {\n    getAllPhotos,\n    savePhoto,\n    deletePhoto,\n    getPhotoCount,\n    type PhotoMetadata,\n} from '@/lib/storage/local-db';\nimport { encryptFile, decryptFile, getUserKeyHash } from '@/lib/crypto';\nimport { uploadCIDMetadata, getStorageUsage } from '@/lib/supabase';\nimport { remoteStorage } from '@/lib/storage/remote-storage';\nimport { getDeviceId } from '@/lib/deviceId';\nimport { deletePhotoGlobally, type DeleteResult } from '@/lib/storage/photo-manager';\n\n// HEIC conversion moved to Web Worker for non-blocking performance\n// See src/lib/heic-converter.ts\nimport { convertHeicToJpeg } from '@/lib/heic-converter';\n\nexport function useGalleryData(secretKey: Uint8Array | null) {\n    const queryClient = useQueryClient();\n    const [userKeyHash, setUserKeyHash] = useState<string | null>(null);\n\n    // Generate Key Hash when secretKey changes\n    useEffect(() => {\n        if (secretKey) {\n            getUserKeyHash(secretKey).then(setUserKeyHash);\n        } else {\n            setUserKeyHash(null);\n        }\n    }, [secretKey]);\n\n    // Query: Load all photos from local IndexedDB\n    // WICHTIG: Query ist IMMER enabled - IndexedDB braucht kein secretKey\n    // Decryption passiert separat wenn secretKey vorhanden ist\n    const {\n        data: photos = [],\n        isLoading,\n        error,\n    } = useQuery({\n        queryKey: ['photos'],\n        queryFn: getAllPhotos,\n        enabled: true, // Immer laden, unabhängig von secretKey\n    });\n\n    // Query: Photo count\n    const { data: photoCount = 0 } = useQuery({\n        queryKey: ['photoCount'],\n        queryFn: getPhotoCount,\n    });\n\n    const [uploadProgress, setUploadProgress] = useState<number>(0);\n    const [uploadingPhotos, setUploadingPhotos] = useState<Map<string, { file: File; objectUrl: string; progress: number }>>(new Map());\n\n    // Mutation: Upload photo (convert HEIC -> encrypt -> IPFS -> Supabase metadata)\n    // With OPTIMISTIC UPDATES: Photo appears immediately while uploading\n    const uploadMutation = useMutation({\n        mutationFn: async (file: File) => {\n            if (!secretKey) throw new Error('No encryption key');\n            if (!userKeyHash) throw new Error('userKeyHash not ready - bitte kurz warten');\n\n            // Check Storage Limit (2GB)\n            const LIMIT_2GB = 2 * 1024 * 1024 * 1024;\n            const currentUsage = await getStorageUsage(userKeyHash);\n\n            if (currentUsage + file.size > LIMIT_2GB) {\n                alert(\"Speicherlimit von 2GB erreicht! Upgrade deinen Plan.\"); // Simple alert for MVP\n                throw new Error(\"STORAGE_LIMIT_EXCEEDED\");\n            }\n\n            // Generate temporary ID for optimistic update tracking\n            const tempId = `temp_${Date.now()}_${Math.random().toString(36).slice(2)}`;\n\n            console.log('[Upload] Starting upload:', file.name, 'tempId:', tempId);\n            setUploadProgress(0);\n\n            // OPTIMISTIC: Add photo to uploading state immediately (shows in UI)\n            const objectUrl = URL.createObjectURL(file);\n            setUploadingPhotos(prev => new Map(prev).set(tempId, {\n                file,\n                objectUrl,\n                progress: 0\n            }));\n\n            try {\n                // Step 0: Convert HEIC to JPEG if needed (iOS compatibility)\n                // Uses Web Worker for non-blocking conversion on iPad/iPhone\n                const conversionResult = await convertHeicToJpeg(file);\n                const processedFile = conversionResult.file;\n\n                if (conversionResult.converted) {\n                    console.log('[Upload] HEIC converted:', {\n                        originalSize: conversionResult.originalSize,\n                        convertedSize: conversionResult.convertedSize\n                    });\n                }\n\n                // Step 1: Encrypt file client-side\n                const { encrypted, nonce } = await encryptFile(processedFile, secretKey);\n                console.log('[Upload] Encrypted:', { size: encrypted.size });\n\n                // Update progress for optimistic photo\n                setUploadingPhotos(prev => {\n                    const updated = new Map(prev);\n                    const entry = updated.get(tempId);\n                    if (entry) updated.set(tempId, { ...entry, progress: 20 });\n                    return updated;\n                });\n\n                // Step 2: Upload encrypted blob to IPFS -> returns real CID\n                let cid: string;\n                try {\n                    cid = await remoteStorage.upload(encrypted, processedFile.name, (progress) => {\n                        const totalProgress = 20 + (progress * 0.6); // 20-80%\n                        setUploadProgress(totalProgress);\n                        setUploadingPhotos(prev => {\n                            const updated = new Map(prev);\n                            const entry = updated.get(tempId);\n                            if (entry) updated.set(tempId, { ...entry, progress: totalProgress });\n                            return updated;\n                        });\n                    });\n                    console.log('[Upload] IPFS CID:', cid);\n                } catch (error) {\n                    console.error('[Upload] IPFS failed:', error);\n                    // Generate fallback local CID for offline-first\n                    cid = `cid_${Date.now()}_${Math.random().toString(36).slice(2)}`;\n                    console.log('[Upload] Using fallback CID:', cid);\n                }\n\n                // Update progress\n                setUploadingPhotos(prev => {\n                    const updated = new Map(prev);\n                    const entry = updated.get(tempId);\n                    if (entry) updated.set(tempId, { ...entry, progress: 85 });\n                    return updated;\n                });\n\n                // Step 3: Save to local IndexedDB (for immediate access)\n                const metadata: Omit<PhotoMetadata, 'id'> = {\n                    cid,\n                    nonce,\n                    fileName: processedFile.name,\n                    mimeType: processedFile.type,\n                    fileSize: processedFile.size,\n                    uploadedAt: new Date(),\n                    encryptedBlob: encrypted, // Keep locally for fast access\n                };\n\n                try {\n                    await savePhoto(metadata);\n                    console.log('[Upload] Saved to IndexedDB:', cid);\n                } catch (dbError) {\n                    console.error('[Upload] IndexedDB save FAILED:', dbError);\n                    throw dbError; // Fail the mutation - this is critical\n                }\n\n                // Step 4: Sync metadata to Supabase (CID only, no blob)\n                const deviceId = getDeviceId();\n                try {\n                    await uploadCIDMetadata(\n                        cid,\n                        processedFile.size,\n                        deviceId,\n                        nonce,\n                        processedFile.type,\n                        userKeyHash // Jetzt garantiert nicht undefined\n                    );\n                    console.log('[Upload] Supabase synced:', cid);\n                } catch (error) {\n                    console.error('[Upload] Supabase sync failed (local + IPFS OK):', error);\n                    // Don't throw - local + IPFS save succeeded\n                }\n\n                // OPTIMISTIC: Remove from uploading state (real photo now in IndexedDB)\n                setUploadingPhotos(prev => {\n                    const updated = new Map(prev);\n                    const entry = updated.get(tempId);\n                    if (entry) URL.revokeObjectURL(entry.objectUrl);\n                    updated.delete(tempId);\n                    return updated;\n                });\n\n                return metadata;\n            } catch (error) {\n                // OPTIMISTIC: Remove from uploading state on error\n                setUploadingPhotos(prev => {\n                    const updated = new Map(prev);\n                    const entry = updated.get(tempId);\n                    if (entry) URL.revokeObjectURL(entry.objectUrl);\n                    updated.delete(tempId);\n                    return updated;\n                });\n                throw error;\n            }\n        },\n        onSuccess: () => {\n            // Sofort Queries invalidieren für UI-Update\n            queryClient.invalidateQueries({ queryKey: ['photos'] });\n            queryClient.invalidateQueries({ queryKey: ['photoCount'] });\n            console.log('[Upload] Complete - queries invalidated');\n        },\n        onError: (error) => {\n            console.error('[Upload] Mutation failed:', error);\n        },\n    });\n\n    // Mutation: Delete photo (globally across all storage layers)\n    const deleteMutation = useMutation({\n        mutationFn: async (photo: { id?: number; cid: string }): Promise<DeleteResult> => {\n            console.log('[Delete] Starting global delete:', photo.cid);\n\n            // Use global delete to remove from IndexedDB, Supabase, and IPFS\n            const result = await deletePhotoGlobally(photo.cid, photo.id);\n\n            if (result.errors.length > 0) {\n                console.warn('[Delete] Some operations failed:', result.errors);\n            }\n\n            return result;\n        },\n        onSuccess: (result) => {\n            queryClient.invalidateQueries({ queryKey: ['photos'] });\n            queryClient.invalidateQueries({ queryKey: ['photoCount'] });\n            console.log('[Delete] Complete:', {\n                local: result.local,\n                supabase: result.supabase,\n                ipfs: result.ipfs\n            });\n        },\n        onError: (error) => {\n            console.error('[Delete] Mutation failed:', error);\n        },\n    });\n\n    // Decrypt photo for display\n    const decryptPhoto = useCallback(\n        async (photo: PhotoMetadata): Promise<string | null> => {\n            if (!secretKey || !photo.encryptedBlob) return null;\n\n            const decrypted = await decryptFile(\n                photo.encryptedBlob,\n                photo.nonce,\n                secretKey,\n                photo.mimeType\n            );\n\n            if (!decrypted) return null;\n\n            return URL.createObjectURL(decrypted);\n        },\n        [secretKey]\n    );\n\n    // Combine real photos with uploading (optimistic) photos for the UI\n    const uploadingPhotosList = Array.from(uploadingPhotos.entries()).map(([tempId, data]) => ({\n        id: -1, // Temporary ID\n        cid: tempId,\n        nonce: '',\n        fileName: data.file.name,\n        mimeType: data.file.type,\n        fileSize: data.file.size,\n        uploadedAt: new Date(),\n        encryptedBlob: undefined,\n        // Special fields for optimistic display\n        isUploading: true,\n        uploadProgress: data.progress,\n        previewUrl: data.objectUrl,\n    }));\n\n    return {\n        photos,\n        photoCount,\n        isLoading,\n        error,\n        uploadPhoto: uploadMutation.mutate,\n        // Delete takes { id?: number, cid: string } - deletes from all storage layers\n        deletePhoto: deleteMutation.mutate,\n        isDeleting: deleteMutation.isPending,\n        decryptPhoto,\n        isUploading: uploadMutation.isPending,\n        uploadProgress,\n        userKeyHash,\n        // Optimistic updates: photos currently uploading (show at top of gallery)\n        uploadingPhotos: uploadingPhotosList,\n    };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7456, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/hooks/useRealtimeSync.ts"],"sourcesContent":["/**\n * useRealtimeSync Hook - Real-time METADATA sync across devices via Supabase\n *\n * This is a \"thin\" sync layer - it ONLY syncs metadata (CIDs, nonce, etc.)\n * The actual photo content stays on IPFS and is fetched on-demand by the UI\n *\n * PHASE 3 FIXES:\n * - Fixed race conditions with proper ref usage\n * - Added debouncing for rapid events\n * - Separated subscription setup from data loading\n * - Proper cleanup on unmount\n */\n\n'use client';\n\nimport { useEffect, useCallback, useState, useRef } from 'react';\nimport { supabase, loadCIDsFromSupabase } from '@/lib/supabase';\nimport { getDeviceId } from '@/lib/deviceId';\nimport { getUserKeyHash } from '@/lib/crypto';\nimport type { RealtimeChannel } from '@supabase/supabase-js';\n\nexport interface SyncedPhoto {\n  cid: string;\n  device_id: string;\n  uploaded_at: string;\n  file_size_bytes: number | null;\n  nonce: string | null;\n  mime_type: string | null;\n  isFromOtherDevice: boolean;\n}\n\ninterface UseRealtimeSyncOptions {\n  onNewPhoto?: (photo: SyncedPhoto) => void;\n  onPhotoDeleted?: (cid: string) => void;\n  enabled?: boolean;\n  secretKey?: Uint8Array | null;\n}\n\nexport function useRealtimeSync(options: UseRealtimeSyncOptions = {}) {\n  const { onNewPhoto, onPhotoDeleted, enabled = true, secretKey } = options;\n  const [remoteCIDs, setRemoteCIDs] = useState<SyncedPhoto[]>([]);\n  const [isConnected, setIsConnected] = useState(false);\n  const [lastSyncError, setLastSyncError] = useState<Error | null>(null);\n  const [userKeyHash, setUserKeyHash] = useState<string | null>(null);\n\n  // Refs to avoid stale closures in callbacks\n  const userKeyHashRef = useRef<string | null>(null);\n  const deviceIdRef = useRef<string>('server');\n  const onNewPhotoRef = useRef(onNewPhoto);\n  const onPhotoDeletedRef = useRef(onPhotoDeleted);\n  const channelRef = useRef<RealtimeChannel | null>(null);\n  const isSubscribedRef = useRef(false);\n\n  // Update refs when values change\n  useEffect(() => {\n    onNewPhotoRef.current = onNewPhoto;\n    onPhotoDeletedRef.current = onPhotoDeleted;\n  }, [onNewPhoto, onPhotoDeleted]);\n\n  // Initialize device ID (only on client)\n  useEffect(() => {\n    if (typeof window !== 'undefined') {\n      deviceIdRef.current = getDeviceId();\n    }\n  }, []);\n\n  // Generate Key Hash when secretKey changes\n  useEffect(() => {\n    let isMounted = true;\n\n    if (secretKey) {\n      getUserKeyHash(secretKey).then((hash) => {\n        if (isMounted) {\n          setUserKeyHash(hash);\n          userKeyHashRef.current = hash;\n        }\n      });\n    } else {\n      setUserKeyHash(null);\n      userKeyHashRef.current = null;\n    }\n\n    return () => {\n      isMounted = false;\n    };\n  }, [secretKey]);\n\n  // Load initial CIDs from Supabase (metadata only)\n  // Using ref for userKeyHash to avoid recreating callback\n  const loadRemoteCIDs = useCallback(async () => {\n    const currentKeyHash = userKeyHashRef.current;\n    const currentDeviceId = deviceIdRef.current;\n\n    if (!currentKeyHash) return [];\n\n    try {\n      const data = await loadCIDsFromSupabase(currentDeviceId, currentKeyHash);\n      const photos: SyncedPhoto[] = data.map((row: { cid: string; device_id: string; uploaded_at: string; file_size_bytes: number | null; nonce: string | null; mime_type: string | null }) => ({\n        cid: row.cid,\n        device_id: row.device_id,\n        uploaded_at: row.uploaded_at,\n        file_size_bytes: row.file_size_bytes,\n        nonce: row.nonce || null,\n        mime_type: row.mime_type || null,\n        isFromOtherDevice: row.device_id !== currentDeviceId,\n      }));\n      setRemoteCIDs(photos);\n      setLastSyncError(null);\n      return photos;\n    } catch (error) {\n      console.error('Failed to load remote CIDs:', error);\n      setLastSyncError(error as Error);\n      return [];\n    }\n  }, []); // Empty deps - uses refs\n\n  // Load data when userKeyHash becomes available\n  useEffect(() => {\n    if (userKeyHash && enabled) {\n      loadRemoteCIDs();\n    }\n  }, [userKeyHash, enabled, loadRemoteCIDs]);\n\n  // Subscribe to realtime changes - SEPARATE from data loading\n  useEffect(() => {\n    if (!enabled || typeof window === 'undefined') return;\n\n    // Don't subscribe if already subscribed\n    if (isSubscribedRef.current) return;\n\n    // Wait for userKeyHash to be ready before subscribing\n    if (!userKeyHash) return;\n\n    console.log('[Realtime] Setting up subscription...');\n    isSubscribedRef.current = true;\n\n    // Debounce helper for rapid events\n    let eventQueue: SyncedPhoto[] = [];\n    let debounceTimer: NodeJS.Timeout | null = null;\n\n    const processEventQueue = () => {\n      if (eventQueue.length === 0) return;\n\n      setRemoteCIDs((prev) => {\n        const newPhotos = eventQueue.filter(\n          (photo) => !prev.some((p) => p.cid === photo.cid)\n        );\n        if (newPhotos.length === 0) return prev;\n        return [...newPhotos, ...prev];\n      });\n\n      // Notify callbacks for photos from other devices\n      eventQueue\n        .filter((p) => p.isFromOtherDevice)\n        .forEach((photo) => {\n          console.log('[Realtime] New photo from another device:', photo.cid);\n          onNewPhotoRef.current?.(photo);\n        });\n\n      eventQueue = [];\n    };\n\n    const channel = supabase\n      .channel(`photos_metadata_${userKeyHash.slice(0, 8)}`)\n      .on(\n        'postgres_changes',\n        {\n          event: 'INSERT',\n          schema: 'public',\n          table: 'photos_metadata',\n        },\n        (payload) => {\n          const newPhoto = payload.new as {\n            cid: string;\n            device_id: string;\n            uploaded_at: string;\n            file_size_bytes: number | null;\n            nonce: string | null;\n            mime_type: string | null;\n            user_key_hash: string | null;\n          };\n\n          // Only process if it belongs to this user\n          const currentKeyHash = userKeyHashRef.current;\n          if (currentKeyHash && newPhoto.user_key_hash !== currentKeyHash) {\n            return;\n          }\n\n          const syncedPhoto: SyncedPhoto = {\n            cid: newPhoto.cid,\n            device_id: newPhoto.device_id,\n            uploaded_at: newPhoto.uploaded_at,\n            file_size_bytes: newPhoto.file_size_bytes,\n            nonce: newPhoto.nonce,\n            mime_type: newPhoto.mime_type,\n            isFromOtherDevice: newPhoto.device_id !== deviceIdRef.current,\n          };\n\n          // Add to queue for debounced processing\n          eventQueue.push(syncedPhoto);\n\n          // Debounce: process after 100ms of no new events\n          if (debounceTimer) clearTimeout(debounceTimer);\n          debounceTimer = setTimeout(processEventQueue, 100);\n        }\n      )\n      .on(\n        'postgres_changes',\n        {\n          event: 'DELETE',\n          schema: 'public',\n          table: 'photos_metadata',\n        },\n        (payload) => {\n          const deleted = payload.old as { cid: string };\n          onPhotoDeletedRef.current?.(deleted.cid);\n          setRemoteCIDs((prev) => prev.filter((p) => p.cid !== deleted.cid));\n        }\n      )\n      .subscribe((status) => {\n        console.log('[Realtime] Status:', status);\n        setIsConnected(status === 'SUBSCRIBED');\n\n        // Auto-reconnect on channel error with exponential backoff\n        if (status === 'CHANNEL_ERROR') {\n          console.log('[Realtime] Channel error, retrying in 5s...');\n          setTimeout(() => {\n            if (channelRef.current && isSubscribedRef.current) {\n              channelRef.current.subscribe();\n            }\n          }, 5000);\n        }\n      });\n\n    channelRef.current = channel;\n\n    return () => {\n      console.log('[Realtime] Cleaning up subscription...');\n      isSubscribedRef.current = false;\n\n      if (debounceTimer) clearTimeout(debounceTimer);\n\n      if (channelRef.current) {\n        supabase.removeChannel(channelRef.current);\n        channelRef.current = null;\n      }\n    };\n  }, [enabled, userKeyHash]); // Only depend on enabled and userKeyHash\n\n  // Force refresh\n  const refresh = useCallback(async () => {\n    return loadRemoteCIDs();\n  }, [loadRemoteCIDs]);\n\n  // Get CIDs from other devices only\n  const remoteCIDsFromOtherDevices = remoteCIDs.filter((p) => p.isFromOtherDevice);\n\n  return {\n    remoteCIDs,\n    remoteCIDsFromOtherDevices,\n    isConnected,\n    lastSyncError,\n    refresh,\n    deviceId: deviceIdRef.current,\n    userKeyHash,\n  };\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7726, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/DecryptedThumbnail.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useRef } from \"react\";\nimport { Loader2, Cloud } from \"lucide-react\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport { decryptFile } from \"@/lib/crypto\";\nimport { remoteStorage } from \"@/lib/storage/remote-storage\";\nimport { isRealIPFSCID } from \"@/lib/storage/remote-storage\";\nimport type { PhotoMetadata } from \"@/lib/storage/local-db\";\n\ninterface DecryptedThumbnailProps {\n    photo: PhotoMetadata;\n    secretKey: Uint8Array | null;\n    /** If true, show cloud icon overlay for cloud-only photos */\n    showCloudBadge?: boolean;\n}\n\nexport function DecryptedThumbnail({\n    photo,\n    secretKey,\n    showCloudBadge = true\n}: DecryptedThumbnailProps) {\n    const [imageUrl, setImageUrl] = useState<string | null>(null);\n    const [error, setError] = useState(false);\n    const [isDecrypting, setIsDecrypting] = useState(false);\n    const [isFetchingFromCloud, setIsFetchingFromCloud] = useState(false);\n    const [isCloudPhoto, setIsCloudPhoto] = useState(false);\n\n    // Track the current image URL for cleanup\n    const currentUrlRef = useRef<string | null>(null);\n\n    useEffect(() => {\n        // Skip if no key or already have URL\n        if (!secretKey || imageUrl) return;\n\n        const loadAndDecrypt = async () => {\n            setIsDecrypting(true);\n\n            try {\n                let blobToDecrypt: Blob | undefined = photo.encryptedBlob;\n\n                // If no local blob, try to fetch from IPFS (cloud)\n                if (!blobToDecrypt && photo.cid && isRealIPFSCID(photo.cid)) {\n                    setIsFetchingFromCloud(true);\n                    setIsCloudPhoto(true);\n                    console.log('Fetching from IPFS for thumbnail:', photo.cid);\n\n                    try {\n                        blobToDecrypt = await remoteStorage.download(photo.cid);\n                        console.log('Fetched from IPFS:', { cid: photo.cid, size: blobToDecrypt.size });\n                    } catch (fetchError) {\n                        console.error(`Failed to fetch from IPFS (CID: ${photo.cid}):`, fetchError);\n                        setError(true);\n                        return;\n                    } finally {\n                        setIsFetchingFromCloud(false);\n                    }\n                }\n\n                // If still no blob, show error\n                if (!blobToDecrypt) {\n                    console.log('No blob available for:', photo.cid);\n                    // Don't set error - this might be a cloud-only photo not yet fetched\n                    setIsCloudPhoto(true);\n                    return;\n                }\n\n                // Decrypt the blob\n                const decrypted = await decryptFile(\n                    blobToDecrypt,\n                    photo.nonce,\n                    secretKey,\n                    photo.mimeType\n                );\n\n                if (decrypted) {\n                    const url = URL.createObjectURL(decrypted);\n                    currentUrlRef.current = url;\n                    setImageUrl(url);\n                } else {\n                    setError(true);\n                }\n            } catch (err) {\n                console.error(\"Failed to decrypt photo:\", photo.cid, err);\n                setError(true);\n            } finally {\n                setIsDecrypting(false);\n            }\n        };\n\n        loadAndDecrypt();\n\n        // Cleanup: Revoke object URL when component unmounts or photo changes\n        return () => {\n            if (currentUrlRef.current) {\n                // Delay revocation slightly to avoid WebKitBlobResource-Fehler on some browsers\n                // while the image might still be painting or being accessed\n                const urlToRevoke = currentUrlRef.current;\n                setTimeout(() => {\n                    try {\n                        URL.revokeObjectURL(urlToRevoke);\n                    } catch (e) {\n                        // Ignore errors during revocation\n                    }\n                }, 1000);\n                currentUrlRef.current = null;\n            }\n        };\n    }, [photo, secretKey, imageUrl]);\n\n    // Error state\n    if (error) {\n        return (\n            <div className=\"w-full h-full flex flex-col items-center justify-center bg-red-50 text-red-500 p-2 text-center\">\n                <CustomIcon name=\"lock\" size={24} className=\"mb-1 opacity-50\" />\n                <span className=\"text-[10px]\">Fehler</span>\n            </div>\n        );\n    }\n\n    // Loading state (fetching from cloud)\n    if (isFetchingFromCloud) {\n        return (\n            <div className=\"w-full h-full flex flex-col items-center justify-center bg-blue-50\">\n                <Cloud className=\"w-5 h-5 text-blue-400 mb-1 animate-pulse\" />\n                <Loader2 className=\"w-4 h-4 animate-spin text-blue-400\" />\n                <span className=\"text-[9px] text-blue-500 mt-1\">Laden...</span>\n            </div>\n        );\n    }\n\n    // Loading state (decrypting)\n    if (isDecrypting || !imageUrl) {\n        // Cloud-only photo placeholder\n        if (isCloudPhoto && !imageUrl && !isDecrypting) {\n            return (\n                <div className=\"w-full h-full flex flex-col items-center justify-center bg-gray-100 relative\">\n                    <Cloud className=\"w-6 h-6 text-gray-400\" />\n                    <span className=\"text-[9px] text-gray-500 mt-1\">In der Cloud</span>\n                </div>\n            );\n        }\n\n        return (\n            <div className=\"w-full h-full flex items-center justify-center bg-gray-100\">\n                <Loader2 className=\"w-6 h-6 animate-spin text-gray-400\" />\n            </div>\n        );\n    }\n\n    // Image loaded - show with optional cloud badge\n    return (\n        <div className=\"relative w-full h-full\">\n            <img\n                src={imageUrl}\n                alt=\"\"\n                className=\"w-full h-full object-cover animate-in fade-in duration-500\"\n                loading=\"lazy\"\n            />\n            {/* Cloud badge overlay for photos fetched from cloud */}\n            {showCloudBadge && isCloudPhoto && (\n                <div className=\"absolute bottom-1 right-1 bg-black/50 rounded-full p-1\">\n                    <Cloud className=\"w-3 h-3 text-white\" />\n                </div>\n            )}\n        </div>\n    );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7987, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/PhotoGallery.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useRef, useCallback, useMemo } from \"react\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport { useEncryption } from \"@/hooks/use-encryption\";\nimport { useGalleryData } from \"@/hooks/use-gallery-data\";\nimport { useRealtimeSync, type SyncedPhoto } from \"@/hooks/useRealtimeSync\";\nimport { DecryptedThumbnail } from \"./DecryptedThumbnail\";\nimport {\n  Plus,\n  Search,\n  Filter,\n  Camera,\n  Image as ImageIcon,\n  LayoutGrid,\n  Calendar,\n  MoreVertical,\n  X,\n  Share2,\n  Trash2,\n  Heart,\n  ExternalLink,\n  RefreshCw,\n  Loader2,\n  SlidersHorizontal,\n  Check,\n  CloudOff,\n  Download,\n  Cloud,\n} from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { AlertTriangle } from \"lucide-react\";\nimport { remoteStorage, isRealIPFSCID } from \"@/lib/storage/remote-storage\";\nimport { decryptFile } from \"@/lib/crypto\";\nimport type { PhotoMetadata } from \"@/lib/storage/local-db\";\n\ninterface PhotoGalleryProps {\n  photosCount?: number;\n  authUser: { id: string; email: string } | null;\n}\n\n// Generate placeholder photo URLs with dates\nconst generatePhotos = (count: number) => {\n  const categories = [\n    \"nature\",\n    \"architecture\",\n    \"travel\",\n    \"food\",\n    \"animals\",\n    \"city\",\n    \"landscape\",\n    \"portrait\",\n    \"ocean\",\n    \"forest\",\n  ];\n\n  // Create photos with dates going backwards from today\n  const today = new Date();\n  return Array.from({ length: count }, (_, i) => {\n    const date = new Date(today);\n    date.setDate(date.getDate() - Math.floor(i / 3)); // 3 photos per day\n\n    return {\n      id: `photo-${i}`,\n      cid: `Qm${Math.random().toString(36).substring(2, 15)}${Math.random().toString(36).substring(2, 15)}`,\n      placeholderUrl: `https://picsum.photos/seed/${i + 100}/400/400`,\n      category: categories[i % categories.length],\n      date: date.toISOString().split(\"T\")[0],\n      metadata: undefined as PhotoMetadata | undefined,\n    };\n  });\n};\n\n// Group photos by date\nconst groupPhotosByDate = (photos: ReturnType<typeof generatePhotos>) => {\n  const groups: { [key: string]: typeof photos } = {};\n  photos.forEach((photo) => {\n    if (!groups[photo.date]) {\n      groups[photo.date] = [];\n    }\n    groups[photo.date].push(photo);\n  });\n  return Object.entries(groups).map(([date, photos]) => ({\n    date,\n    photos,\n    label: formatDateLabel(date),\n  }));\n};\n\nconst formatDateLabel = (dateStr: string) => {\n  const date = new Date(dateStr);\n  const today = new Date();\n  const yesterday = new Date(today);\n  yesterday.setDate(yesterday.getDate() - 1);\n\n  if (dateStr === today.toISOString().split(\"T\")[0]) {\n    return \"Heute\";\n  } else if (dateStr === yesterday.toISOString().split(\"T\")[0]) {\n    return \"Gestern\";\n  } else {\n    return date.toLocaleDateString(\"de-DE\", {\n      weekday: \"long\",\n      day: \"numeric\",\n      month: \"long\",\n    });\n  }\n};\n\nexport function PhotoGallery({ photosCount = 0, authUser }: PhotoGalleryProps) {\n  const queryClient = useQueryClient();\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [showSearch, setShowSearch] = useState(false);\n  const [showFilter, setShowFilter] = useState(false);\n  const [selectedFilter, setSelectedFilter] = useState<string | null>(null);\n  const [selectMode, setSelectMode] = useState(false);\n  const [selectedPhotos, setSelectedPhotos] = useState<Set<string>>(new Set());\n  const [fullscreenPhoto, setFullscreenPhoto] = useState<string | null>(null);\n  const [syncNotification, setSyncNotification] = useState<string | null>(null);\n\n  // Fullscreen photo state\n  const [fullscreenImageUrl, setFullscreenImageUrl] = useState<string | null>(\n    null,\n  );\n  const [isLoadingFullscreen, setIsLoadingFullscreen] = useState(false);\n  const [isDownloading, setIsDownloading] = useState(false);\n\n  const longPressTimer = useRef<NodeJS.Timeout | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Encryption & Real Photo Storage\n  const { secretKey } = useEncryption();\n  const {\n    photos: realPhotos,\n    uploadPhoto,\n    deletePhoto,\n    isUploading,\n    uploadProgress,\n  } = useGalleryData(secretKey);\n\n  // Realtime Sync - receive photos from other devices\n  // When a new photo arrives, invalidate the gallery query to refresh\n  const handleNewPhoto = useCallback(\n    (photo: SyncedPhoto) => {\n      console.log(\n        \"[Realtime] New photo from device:\",\n        photo.device_id,\n        photo.cid,\n      );\n      setSyncNotification(`Neues Foto von anderem Gerät empfangen`);\n      setTimeout(() => setSyncNotification(null), 3000);\n\n      // Invalidate gallery queries to refresh the photo list\n      queryClient.invalidateQueries({ queryKey: [\"photos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"photoCount\"] });\n    },\n    [queryClient],\n  );\n\n  // Handle photo deletion from another device\n  const handlePhotoDeleted = useCallback(\n    (cid: string) => {\n      console.log(\"[Realtime] Photo deleted from another device:\", cid);\n      setSyncNotification(`Foto von anderem Gerät gelöscht`);\n      setTimeout(() => setSyncNotification(null), 3000);\n\n      // Invalidate gallery queries to refresh the photo list\n      queryClient.invalidateQueries({ queryKey: [\"photos\"] });\n      queryClient.invalidateQueries({ queryKey: [\"photoCount\"] });\n    },\n    [queryClient],\n  );\n\n  const { remoteCIDs, remoteCIDsFromOtherDevices, isConnected } =\n    useRealtimeSync({\n      onNewPhoto: handleNewPhoto,\n      onPhotoDeleted: handlePhotoDeleted,\n      enabled: true,\n      secretKey,\n    });\n\n  // Combine local photos with remote-only photos\n  const allPhotos = (() => {\n    // Start with local photos\n    const localPhotos = realPhotos.map((p) => ({\n      id: p.id?.toString() || p.cid,\n      cid: p.cid,\n      placeholderUrl: \"\",\n      category: \"photo\",\n      date: p.uploadedAt.toISOString().split(\"T\")[0],\n      metadata: p,\n      isLocal: true,\n      isCloud: isRealIPFSCID(p.cid),\n    }));\n\n    // Add remote-only photos (from other devices, not in local DB)\n    const localCids = new Set(realPhotos.map((p) => p.cid));\n    const remoteOnlyPhotos = remoteCIDs\n      .filter((r) => !localCids.has(r.cid))\n      .map((r) => ({\n        id: r.cid,\n        cid: r.cid,\n        placeholderUrl: \"\",\n        category: \"cloud\",\n        date: r.uploaded_at\n          ? new Date(r.uploaded_at).toISOString().split(\"T\")[0]\n          : new Date().toISOString().split(\"T\")[0],\n        metadata: {\n          cid: r.cid,\n          nonce: r.nonce || \"\",\n          fileName: `cloud_${r.cid}`,\n          mimeType: r.mime_type || \"image/jpeg\",\n          fileSize: r.file_size_bytes || 0,\n          uploadedAt: r.uploaded_at ? new Date(r.uploaded_at) : new Date(),\n        } as PhotoMetadata,\n        isLocal: false,\n        isCloud: true,\n      }));\n\n    return [...localPhotos, ...remoteOnlyPhotos];\n  })();\n\n  // Use real photos if available, otherwise use placeholders\n  const photos = useMemo(\n    () =>\n      allPhotos.length > 0\n        ? allPhotos\n        : generatePhotos(Math.min(photosCount, 50)),\n    [allPhotos, photosCount],\n  );\n\n  const filteredPhotos = useMemo(\n    () =>\n      photos.filter((photo) => {\n        if (selectedFilter && photo.category !== selectedFilter) return false;\n        if (searchQuery && !photo.category.includes(searchQuery.toLowerCase()))\n          return false;\n        return true;\n      }),\n    [photos, selectedFilter, searchQuery],\n  );\n\n  const filteredGroups = useMemo(\n    () => groupPhotosByDate(filteredPhotos),\n    [filteredPhotos],\n  );\n\n  // Load fullscreen photo (on-demand from IPFS if needed)\n  const loadFullscreenPhoto = async (photo: (typeof photos)[0]) => {\n    if (!secretKey || !photo.metadata) return;\n\n    setIsLoadingFullscreen(true);\n    setFullscreenImageUrl(null);\n\n    try {\n      let blobToDecrypt: Blob | undefined = photo.metadata.encryptedBlob;\n\n      // Fetch from IPFS if not local\n      if (!blobToDecrypt && photo.cid && isRealIPFSCID(photo.cid)) {\n        console.log(\"Loading full-res from IPFS:\", photo.cid);\n        blobToDecrypt = await remoteStorage.download(photo.cid);\n      }\n\n      if (!blobToDecrypt) {\n        console.error(\"No blob available for fullscreen\");\n        return;\n      }\n\n      // Decrypt\n      const decrypted = await decryptFile(\n        blobToDecrypt,\n        photo.metadata.nonce,\n        secretKey,\n        photo.metadata.mimeType,\n      );\n\n      if (decrypted) {\n        const url = URL.createObjectURL(decrypted);\n        setFullscreenImageUrl(url);\n      }\n    } catch (error) {\n      console.error(\"Failed to load fullscreen photo:\", error);\n    } finally {\n      setIsLoadingFullscreen(false);\n    }\n  };\n\n  // Download photo to device\n  const downloadPhoto = async (photo: (typeof photos)[0]) => {\n    if (!secretKey || !photo.metadata) return;\n\n    setIsDownloading(true);\n\n    try {\n      let blobToDecrypt: Blob | undefined = photo.metadata.encryptedBlob;\n\n      // Fetch from IPFS if not local\n      if (!blobToDecrypt && photo.cid && isRealIPFSCID(photo.cid)) {\n        blobToDecrypt = await remoteStorage.download(photo.cid);\n      }\n\n      if (!blobToDecrypt) return;\n\n      // Decrypt\n      const decrypted = await decryptFile(\n        blobToDecrypt,\n        photo.metadata.nonce,\n        secretKey,\n        photo.metadata.mimeType,\n      );\n\n      if (decrypted) {\n        // Create download link\n        const url = URL.createObjectURL(decrypted);\n        const a = document.createElement(\"a\");\n        a.href = url;\n        a.download =\n          photo.metadata.fileName || `photo_${photo.cid.slice(0, 8)}.jpg`;\n        document.body.appendChild(a);\n        a.click();\n        document.body.removeChild(a);\n        URL.revokeObjectURL(url);\n\n        setSyncNotification(\"Foto heruntergeladen!\");\n        setTimeout(() => setSyncNotification(null), 2000);\n      }\n    } catch (error) {\n      console.error(\"Failed to download photo:\", error);\n    } finally {\n      setIsDownloading(false);\n    }\n  };\n\n  const handlePhotoTap = (photoId: string, photo: (typeof photos)[0]) => {\n    if (selectMode) {\n      setSelectedPhotos((prev) => {\n        const newSet = new Set(prev);\n        if (newSet.has(photoId)) {\n          newSet.delete(photoId);\n        } else {\n          newSet.add(photoId);\n        }\n        return newSet;\n      });\n    } else {\n      setFullscreenPhoto(photoId);\n      if (photo.metadata) {\n        loadFullscreenPhoto(photo);\n      }\n    }\n  };\n\n  const closeFullscreen = () => {\n    setFullscreenPhoto(null);\n    if (fullscreenImageUrl) {\n      URL.revokeObjectURL(fullscreenImageUrl);\n      setFullscreenImageUrl(null);\n    }\n  };\n\n  const handleTouchStart = (photoId: string) => {\n    longPressTimer.current = setTimeout(() => {\n      setSelectMode(true);\n      setSelectedPhotos(new Set([photoId]));\n    }, 500);\n  };\n\n  const handleTouchEnd = () => {\n    if (longPressTimer.current) {\n      clearTimeout(longPressTimer.current);\n      longPressTimer.current = null;\n    }\n  };\n\n  const categories = [\n    { id: \"nature\", label: \"Natur (Coming Soon)\" },\n    { id: \"architecture\", label: \"Architektur (Coming Soon)\" },\n    { id: \"travel\", label: \"Reisen (Coming Soon)\" },\n    { id: \"food\", label: \"Essen (Coming Soon)\" },\n    { id: \"animals\", label: \"Tiere (Coming Soon)\" },\n    { id: \"city\", label: \"Stadt (Coming Soon)\" },\n    { id: \"landscape\", label: \"Landschaft (Coming Soon)\" },\n  ];\n\n  // Handle file upload\n  const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const files = Array.from(e.target.files || []);\n    files.forEach((file) => uploadPhoto(file));\n  };\n\n  const handleUploadClick = () => {\n    fileInputRef.current?.click();\n  };\n\n  const allPhotosCount = photos.length;\n\n  return (\n    <div className=\"flex flex-col h-full bg-[#FAFBFC]\">\n      {/* Header with Sketch UI */}\n      <header className=\"px-5 pt-10 pb-4 bg-[#FAFBFC] sticky top-0 z-30 border-b-2 border-[#2563EB]/10\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <h1 className=\"text-2xl font-bold tracking-tight\">Galerie</h1>\n          <div className=\"flex items-center gap-3\">\n            <button\n              onClick={() => setShowSearch(!showSearch)}\n              className={`p-2 rounded-full transition-colors ${showSearch ? \"bg-[#2563EB]/10 text-[#2563EB]\" : \"text-[#6E6E73]\"}`}\n            >\n              <Search className=\"w-6 h-6\" />\n            </button>\n            <Button\n              onClick={handleUploadClick}\n              size=\"sm\"\n              className=\"scale-90 bg-blue-600 hover:bg-blue-700 text-white rounded-full\"\n            >\n              Hinzufügen\n            </Button>\n          </div>\n        </div>\n\n        {/* Subtitle / Status */}\n        <div className=\"flex items-center justify-between px-1 mb-4\">\n          <p className=\"text-[15px] font-medium text-[#3B82F6]\">\n            {allPhotosCount} Fotos gesichert\n          </p>\n          <div className=\"flex items-center gap-2\">\n            {isConnected ? (\n              <Cloud className=\"w-5 h-5 text-[#30D158]\" />\n            ) : (\n              <AlertTriangle className=\"w-5 h-5 text-[#8E8E93]\" />\n            )}\n          </div>\n        </div>\n\n        {/* Search Bar */}\n        {showSearch && (\n          <div className=\"mb-4 relative\">\n            <Search className=\"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-500\" />\n            <Input\n              value={searchQuery}\n              onChange={(e) => setSearchQuery(e.target.value)}\n              placeholder=\"Suchen...\"\n              className=\"w-full pl-9 bg-gray-100 border-none rounded-xl h-10\"\n            />\n          </div>\n        )}\n\n        {/* Filter Bar with Sketch UI */}\n        <div className=\"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1\">\n          <button\n            onClick={() => setSelectedFilter(null)}\n            className={`sketch-subheading text-[15px] px-4 py-1.5 rounded-full transition-colors ${\n              selectedFilter === null\n                ? \"bg-[#2563EB] text-white\"\n                : \"bg-[#2563EB]/5 text-[#2563EB]\"\n            }`}\n          >\n            Alle\n          </button>\n          {categories.map((cat) => (\n            <button\n              key={cat.id}\n              onClick={() => setSelectedFilter(cat.id)}\n              className={`text-sm font-medium px-4 py-1.5 rounded-full transition-colors whitespace-nowrap ${\n                selectedFilter === cat.id\n                  ? \"bg-[#2563EB] text-white\"\n                  : \"bg-[#2563EB]/5 text-[#2563EB]\"\n              }`}\n            >\n              {cat.label}\n            </button>\n          ))}\n        </div>\n      </header>\n\n      {/* Gallery Grid */}\n      <main className=\"flex-1 overflow-y-auto px-1 pb-[100px]\">\n        {filteredGroups.length === 0 ? (\n          <div className=\"pt-20 text-center px-10\">\n            <ImageIcon className=\"w-16 h-16 mx-auto mb-4 opacity-20\" />\n            <p className=\"text-lg font-medium text-[#6E6E73]\">\n              Keine Fotos gefunden\n            </p>\n            <p className=\"text-sm text-[#8E8E93] mt-2\">\n              Versuche es mit einem anderen Suchbegriff oder Filter\n            </p>\n          </div>\n        ) : (\n          filteredGroups.map((group) => (\n            <div key={group.date} className=\"mb-8\">\n              <h2 className=\"text-lg font-semibold px-4 mb-3 sticky top-[160px] bg-[#FAFBFC]/90 backdrop-blur-md z-10 py-2\">\n                {group.label}\n              </h2>\n              <div className=\"grid grid-cols-3 gap-1\">\n                {group.photos.map((photo) => (\n                  <div\n                    key={photo.id}\n                    className={`relative aspect-square overflow-hidden cursor-pointer active:opacity-70 transition-opacity ${\n                      selectedPhotos.has(photo.id)\n                        ? \"ring-4 ring-[#2563EB] ring-inset\"\n                        : \"\"\n                    }`}\n                    onClick={() => handlePhotoTap(photo.id, photo)}\n                    onTouchStart={() => handleTouchStart(photo.id)}\n                    onTouchEnd={handleTouchEnd}\n                    onContextMenu={(e) => {\n                      e.preventDefault();\n                      setSelectMode(true);\n                      setSelectedPhotos(new Set([photo.id]));\n                    }}\n                  >\n                    <DecryptedThumbnail\n                      photo={photo.metadata!}\n                      secretKey={secretKey}\n                      showCloudBadge={true}\n                    />\n\n                    {/* Select Indicator */}\n                    {selectMode && (\n                      <div className=\"absolute top-2 right-2 z-10 w-6 h-6\">\n                        <div\n                          className={`w-6 h-6 rounded-full p-0 flex items-center justify-center transition-all ${selectedPhotos.has(photo.id) ? \"bg-[#2563EB] border border-[#2563EB]\" : \"bg-white/80 border border-[#2563EB] backdrop-blur-sm\"}`}\n                        >\n                          {selectedPhotos.has(photo.id) && (\n                            <Check className=\"w-3.5 h-3.5 text-white\" />\n                          )}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                ))}\n              </div>\n            </div>\n          ))\n        )}\n      </main>\n\n      {/* Sync Notifications */}\n      {syncNotification && (\n        <div className=\"fixed bottom-[100px] left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-[400px]\">\n          <div className=\"bg-sky-500/90 dark:bg-sky-600/90 border border-sky-400/50 py-3 px-5 shadow-xl rounded-2xl backdrop-blur-md\">\n            <p className=\"text-white text-sm font-medium text-center flex items-center justify-center gap-3\">\n              <Loader2 className=\"w-4 h-4 animate-spin text-white/90\" />\n              {syncNotification}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Fullscreen Viewer */}\n      {fullscreenPhoto && (\n        <div className=\"fixed inset-0 bg-black z-[100] flex flex-col\">\n          {/* Header */}\n          <div className=\"p-4 flex items-center justify-between\">\n            <button\n              onClick={closeFullscreen}\n              className=\"p-2 text-white/80 hover:text-white\"\n            >\n              <X className=\"w-6 h-6\" />\n            </button>\n            <div className=\"flex items-center gap-4\">\n              <button className=\"p-2 text-white/80 hover:text-white\">\n                <Share2 className=\"w-6 h-6\" />\n              </button>\n              <button className=\"p-2 text-white/80 hover:text-white\">\n                <Heart className=\"w-6 h-6\" />\n              </button>\n            </div>\n          </div>\n\n          {/* Image Container */}\n          <div className=\"flex-1 relative flex items-center justify-center overflow-hidden\">\n            {isLoadingFullscreen ? (\n              <div className=\"flex flex-col items-center gap-4\">\n                <Loader2 className=\"w-12 h-12 text-[#2563EB] animate-spin\" />\n                <p className=\"sketch-body text-white/60\">Entschlüsseln...</p>\n              </div>\n            ) : fullscreenImageUrl ? (\n              <img\n                src={fullscreenImageUrl}\n                alt=\"Vollbild\"\n                className=\"max-w-full max-h-full object-contain\"\n              />\n            ) : (\n              <div className=\"text-center p-10\">\n                <AlertTriangle className=\"w-12 h-12 text-[#FF3B30] mx-auto mb-4\" />\n                <p className=\"text-white font-medium\">Laden fehlgeschlagen</p>\n              </div>\n            )}\n          </div>\n\n          {/* Footer Actions */}\n          <div className=\"p-6 flex items-center justify-around bg-black/40 backdrop-blur-md\">\n            <button\n              className=\"flex flex-col items-center gap-1 text-white/70\"\n              onClick={() => {\n                const photo = photos.find((p) => p.id === fullscreenPhoto);\n                if (photo) downloadPhoto(photo);\n              }}\n              disabled={isDownloading}\n            >\n              {isDownloading ? (\n                <Loader2 className=\"w-6 h-6 animate-spin\" />\n              ) : (\n                <Download className=\"w-6 h-6\" />\n              )}\n              <span className=\"sketch-body text-[10px]\">Speichern</span>\n            </button>\n            <button className=\"flex flex-col items-center gap-1 text-white/70\">\n              <ExternalLink className=\"w-6 h-6\" />\n              <span className=\"sketch-body text-[10px]\">Exportieren</span>\n            </button>\n            <button \n              className=\"flex flex-col items-center gap-1 text-[#FF3B30] hover:text-[#FF3B30]/80\"\n              onClick={async () => {\n                const photo = photos.find((p) => p.id === fullscreenPhoto);\n                if (!photo) return;\n                \n                if (confirm(\"Möchtest du dieses Foto wirklich dauerhaft löschen?\")) {\n                  try {\n                    // Falls ID ein String ist und mit 'photo-' anfängt (Placeholder), kann man es nicht löschen\n                    const isPlaceholder = photo.id.startsWith('photo-');\n                    if (isPlaceholder) {\n                      alert(\"Placeholder-Fotos können nicht gelöscht werden.\");\n                      return;\n                    }\n\n                    // Für echte Fotos: deletePhoto aufrufen\n                    // photo.metadata hat die echten Daten\n                    if (photo.metadata) {\n                        await deletePhoto({ \n                            cid: photo.metadata.cid, \n                            id: photo.metadata.id \n                        });\n                        closeFullscreen();\n                    }\n                  } catch (e) {\n                    console.error(\"Delete failed\", e);\n                    alert(\"Fehler beim Löschen des Fotos.\");\n                  }\n                }\n              }}\n            >\n              <Trash2 className=\"w-6 h-6\" />\n              <span className=\"sketch-body text-[10px]\">Löschen</span>\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Hidden upload input */}\n      <input\n        ref={fileInputRef}\n        type=\"file\"\n        multiple\n        accept=\"image/*\"\n        onChange={handleFileUpload}\n        className=\"hidden\"\n      />\n\n      {/* Upload Progress Overlay */}\n      {isUploading && (\n        <div className=\"fixed inset-0 bg-black/40 backdrop-blur-sm z-[60] flex items-center justify-center p-6\">\n          <div className=\"bg-white/95 dark:bg-black/90 w-full max-w-[280px] p-6 flex flex-col items-center rounded-3xl shadow-2xl border border-white/20\">\n            <div className=\"w-16 h-16 rounded-full bg-[#2563EB]/10 flex items-center justify-center mb-4\">\n              <Loader2 className=\"w-8 h-8 text-[#2563EB] animate-spin\" />\n            </div>\n            <h3 className=\"text-lg font-bold text-center mb-2\">\n              Sicherung läuft...\n            </h3>\n            <p className=\"text-sm text-[#6E6E73] text-center mb-4\">\n              {uploadProgress > 0\n                ? `${Math.round(uploadProgress)}% hochgeladen`\n                : \"Vorbereiten...\"}\n            </p>\n            <div className=\"w-full bg-[#E5E7EB] h-2 rounded-full overflow-hidden\">\n              <div\n                className=\"bg-[#2563EB] h-full transition-all duration-300\"\n                style={{ width: `${uploadProgress}%` }}\n              />\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9013, "column": 0}, "map": {"version":3,"sources":["file:///Users/einarjaeger/Documents/GitHub/privacyheaven%20/src/components/photovault/PhotoVaultApp.tsx"],"sourcesContent":["\"use client\";\n\nimport { useState, useEffect, useCallback, useRef } from \"react\";\nimport { Settings } from \"lucide-react\";\nimport { CustomIcon } from \"@/components/ui/custom-icon\";\nimport ShieldLoader from \"@/components/ui/shield-loader\";\n\n// Screens\nimport { AuthScreen } from \"./AuthScreen\";\nimport { UnlockVaultScreen } from \"./UnlockVaultScreen\";\nimport { VaultSetupScreen } from \"./VaultSetupScreen\";\nimport { SettingsPanel } from \"./SettingsPanel\";\nimport { PhotoGallery } from \"./PhotoGallery\";\n\n// Auth\nimport { useSession, signOut } from \"@/lib/auth-client\";\n\n\n// Crypto\nimport { loadKeyFromStorage, getUserKeyHash, clearKeyFromStorage } from \"@/lib/crypto\";\n\n// Device & Supabase\nimport { getDeviceId, getDeviceName, getDeviceType } from \"@/lib/deviceId\";\nimport { registerDevice } from \"@/lib/supabase\";\n\nexport interface AppState {\n    isOnboarded: boolean;\n    backupActive: boolean;\n    selectedPlan: \"free\" | \"backup-plus\";\n    autoBackupEnabled: boolean;\n    backgroundBackupEnabled: boolean;\n    photosCount: number;\n    lastBackup: string;\n    permanence: number;\n    encryptionKey: string;\n    backupPhrase: string[];\n    devices: {\n        id: string;\n        name: string;\n        lastActive: string;\n        syncing?: boolean;\n    }[];\n    photoSource: \"photos-app\" | \"files-app\";\n}\n\nconst defaultState: AppState = {\n    isOnboarded: false,\n    backupActive: false,\n    selectedPlan: \"free\",\n    autoBackupEnabled: true,\n    backgroundBackupEnabled: false,\n    photosCount: 0,\n    lastBackup: \"Noch nie\",\n    permanence: 0,\n    encryptionKey: \"\",\n    backupPhrase: [],\n    devices: [],\n    photoSource: \"photos-app\",\n};\n\nexport type Screen = \"gallery\" | \"settings\";\n\ntype AppPhase =\n    | \"loading\"\n    | \"auth\"           // No session - show login/signup\n    | \"unlock\"         // Session exists but no local key - show unlock screen\n    | \"setup\"          // Session exists, no vault_key_hash - create new vault\n    | \"main\";          // Fully authenticated with local key\n\ninterface AuthUser {\n    id: string;\n    email: string;\n    vaultKeyHash: string | null;\n}\n\nexport function PhotoVaultApp() {\n    const [state, setState] = useState<AppState>(defaultState);\n    const [currentScreen, setCurrentScreen] = useState<Screen>(\"gallery\");\n    const [appPhase, setAppPhase] = useState<AppPhase>(\"loading\");\n    const [authUser, setAuthUser] = useState<AuthUser | null>(null);\n\n    // Better Auth session hook\n    const { data: session, isPending: isSessionLoading } = useSession();\n\n    // Ref-Guard: Verhindert mehrfache Device-Registrierung pro Session\n    const hasRegisteredDevice = useRef(false);\n\n    // Register device for authenticated user (nur einmal pro Session)\n    const registerDeviceForUser = useCallback(async (keyHash: string, userId: string) => {\n        // Guard: Nur einmal registrieren\n        if (hasRegisteredDevice.current) {\n            console.log(\"[Device] Already registered this session, skipping\");\n            return;\n        }\n\n        try {\n            const deviceId = getDeviceId();\n            const deviceName = getDeviceName();\n            const deviceType = getDeviceType();\n\n            await registerDevice(deviceId, deviceName, deviceType, keyHash, userId);\n            hasRegisteredDevice.current = true; // Markiere als registriert\n            console.log(\"[Device] Registered successfully:\", deviceId);\n        } catch (err) {\n            console.error(\"[Device] Registration failed:\", err);\n        }\n    }, []);\n\n    // Initialize app - check auth state and local key\n    useEffect(() => {\n        const initializeApp = async () => {\n            // Wait for session check to complete\n            if (isSessionLoading) return;\n\n            // No session - need to authenticate\n            if (!session?.user) {\n                setAppPhase(\"auth\");\n                return;\n            }\n\n            // Have session - fetch vault_key_hash from API (not session)\n            const user = session.user as { id: string; email: string };\n\n            // Fetch the actual vault_key_hash from the database\n            let vaultKeyHash: string | null = null;\n            try {\n                const response = await fetch(\"/api/auth/get-vault-key-hash\");\n                if (response.ok) {\n                    const data = await response.json();\n                    vaultKeyHash = data.vaultKeyHash;\n                }\n            } catch (err) {\n                console.error(\"Failed to fetch vault_key_hash:\", err);\n            }\n\n            setAuthUser({\n                id: user.id,\n                email: user.email,\n                vaultKeyHash,\n            });\n\n            const localKey = loadKeyFromStorage();\n\n            if (localKey) {\n                // Verify local key matches account's vault_key_hash (if set)\n                const localKeyHash = await getUserKeyHash(localKey);\n\n                if (vaultKeyHash && localKeyHash !== vaultKeyHash) {\n                    // Key mismatch - user needs to enter correct recovery phrase\n                    console.warn(\"Local key doesn't match account's vault_key_hash\");\n                    clearKeyFromStorage();\n                    setAppPhase(\"unlock\");\n                    return;\n                }\n\n                // Register device\n                await registerDeviceForUser(localKeyHash, user.id);\n\n                // Ready to go\n                setState((prev) => ({ ...prev, isOnboarded: true }));\n                setAppPhase(\"main\");\n            } else if (vaultKeyHash) {\n                // User has a vault but no local key - need to unlock\n                setAppPhase(\"unlock\");\n            } else {\n                // New user without vault - need to create one\n                setAppPhase(\"setup\");\n            }\n        };\n\n        initializeApp();\n    }, [session, isSessionLoading, registerDeviceForUser]);\n\n    // Handle successful auth (login/signup)\n    const handleAuthSuccess = useCallback(async (user: AuthUser) => {\n        // Fetch the actual vault_key_hash from the database\n        let vaultKeyHash: string | null = user.vaultKeyHash;\n        try {\n            const response = await fetch(\"/api/auth/get-vault-key-hash\");\n            if (response.ok) {\n                const data = await response.json();\n                vaultKeyHash = data.vaultKeyHash;\n            }\n        } catch (err) {\n            console.error(\"Failed to fetch vault_key_hash:\", err);\n        }\n\n        const updatedUser = { ...user, vaultKeyHash };\n        setAuthUser(updatedUser);\n\n        // Check for local key\n        const localKey = loadKeyFromStorage();\n\n        if (localKey) {\n            // User has local key - verify and proceed\n            const keyHash = await getUserKeyHash(localKey);\n            if (vaultKeyHash && keyHash !== vaultKeyHash) {\n                clearKeyFromStorage();\n                setAppPhase(\"unlock\");\n            } else {\n                await registerDeviceForUser(keyHash, user.id);\n                setState((prev) => ({ ...prev, isOnboarded: true }));\n                setAppPhase(\"main\");\n            }\n        } else if (vaultKeyHash) {\n            // User has vault but no local key\n            setAppPhase(\"unlock\");\n        } else {\n            // New user - create vault\n            setAppPhase(\"setup\");\n        }\n    }, [registerDeviceForUser]);\n\n    // Handle vault unlock (user entered recovery phrase)\n    const handleVaultUnlock = useCallback(async (secretKey: Uint8Array, keyHash: string) => {\n        if (!authUser) return;\n\n        // If user doesn't have vault_key_hash set, update it\n        if (!authUser.vaultKeyHash) {\n            await updateUserVaultKeyHash(authUser.id, keyHash);\n            setAuthUser({ ...authUser, vaultKeyHash: keyHash });\n        }\n\n        // Register device\n        await registerDeviceForUser(keyHash, authUser.id);\n\n        setState((prev) => ({ ...prev, isOnboarded: true }));\n        setAppPhase(\"main\");\n    }, [authUser, registerDeviceForUser]);\n\n    // Handle new vault creation\n    const handleVaultCreated = useCallback(async (keyHash: string) => {\n        if (!authUser) return;\n\n        // Update user's vault_key_hash (anchor key to account)\n        await updateUserVaultKeyHash(authUser.id, keyHash);\n        setAuthUser({ ...authUser, vaultKeyHash: keyHash });\n\n        // Register device\n        await registerDeviceForUser(keyHash, authUser.id);\n\n        setState((prev) => ({ ...prev, isOnboarded: true }));\n        setAppPhase(\"main\");\n    }, [authUser, registerDeviceForUser]);\n\n    // Handle logout\n    const handleLogout = useCallback(async () => {\n        await signOut();\n        clearKeyFromStorage();\n        setAuthUser(null);\n        setState(defaultState);\n        setAppPhase(\"auth\");\n    }, []);\n\n    const navigateTo = (screen: Screen) => {\n        setCurrentScreen(screen);\n    };\n\n    // Loading state\n    if (appPhase === \"loading\" || isSessionLoading) {\n        return <ShieldLoader />;\n    }\n\n    // Auth screen (login/signup)\n    if (appPhase === \"auth\") {\n        return (\n            <div className=\"min-h-screen ios-bg-gray\">\n                <div className=\"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]\">\n                    <AuthScreen onSuccess={handleAuthSuccess} />\n                </div>\n            </div>\n        );\n    }\n\n    // Unlock vault screen (enter recovery phrase)\n    if (appPhase === \"unlock\" && authUser) {\n        return (\n            <div className=\"min-h-screen ios-bg-gray\">\n                <div className=\"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]\">\n                    <UnlockVaultScreen\n                        userEmail={authUser.email}\n                        expectedKeyHash={authUser.vaultKeyHash}\n                        onUnlock={handleVaultUnlock}\n                        onCreateNewVault={() => setAppPhase(\"setup\")}\n                        onLogout={handleLogout}\n                    />\n                </div>\n            </div>\n        );\n    }\n\n    // Vault setup screen (create new vault)\n    if (appPhase === \"setup\" && authUser) {\n        return (\n            <div className=\"min-h-screen ios-bg-gray\">\n                <div className=\"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]\">\n                    <VaultSetupScreen\n                        userId={authUser.id}\n                        onComplete={handleVaultCreated}\n                        onBack={() => setAppPhase(\"unlock\")}\n                    />\n                </div>\n            </div>\n        );\n    }\n\n    // Main app\n    return (\n        <div className=\"min-h-screen ios-bg-gray\">\n            <div className=\"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7] flex flex-col relative\">\n                {/* Main Content Area */}\n                <div className=\"flex-1 overflow-hidden pb-[80px]\">\n                    {currentScreen === \"gallery\" && (\n                        <PhotoGallery \n                            photosCount={state.photosCount} \n                            authUser={authUser}\n                        />\n                    )}\n                    {currentScreen === \"settings\" && (\n                        <SettingsPanel\n                            state={state}\n                            setState={setState}\n                            onRestartOnboarding={handleLogout}\n                            authUser={authUser}\n                        />\n                    )}\n                </div>\n\n                {/* Bottom Navigation */}\n                <BottomNavigation\n                    currentScreen={currentScreen}\n                    onNavigate={navigateTo}\n                />\n            </div>\n        </div>\n    );\n}\n\n// Helper function to update user's vault_key_hash via API\nasync function updateUserVaultKeyHash(userId: string, keyHash: string): Promise<void> {\n    try {\n        const response = await fetch(\"/api/auth/update-vault-key\", {\n            method: \"POST\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify({ userId, keyHash }),\n        });\n\n        if (!response.ok) {\n            throw new Error(\"Failed to update vault key hash\");\n        }\n    } catch (err) {\n        console.error(\"Failed to update vault_key_hash:\", err);\n        throw err;\n    }\n}\n\nfunction BottomNavigation({\n    currentScreen,\n    onNavigate,\n}: {\n    currentScreen: Screen;\n    onNavigate: (screen: Screen) => void;\n}) {\n    return (\n        <nav className=\"fixed bottom-0 left-0 right-0 h-[85px] bg-white/80 dark:bg-black/80 backdrop-blur-xl border-t border-gray-200 dark:border-white/10 flex items-start justify-around pt-4 pb-8 max-w-[1200px] mx-auto z-40 shadow-lg supports-[backdrop-filter]:bg-opacity-60\">\n            {/* Gallery Tab */}\n            <button\n                onClick={() => onNavigate(\"gallery\")}\n                className={`flex flex-col items-center gap-1 transition-all duration-300 ${\n                    currentScreen === \"gallery\" ? \"scale-100\" : \"scale-90 opacity-60 hover:opacity-100\"\n                }`}\n            >\n                <div className={`p-1.5 rounded-full transition-colors ${\n                    currentScreen === \"gallery\" ? \"bg-blue-500/10 text-blue-600 dark:text-blue-400\" : \"text-gray-500 dark:text-gray-400\"\n                }`}>\n                    <CustomIcon\n                        name=\"image\"\n                        size={24}\n                    />\n                </div>\n                <span\n                    className={`text-[11px] font-medium tracking-wide ${\n                        currentScreen === \"gallery\" ? \"text-blue-600 dark:text-blue-400\" : \"text-gray-500 dark:text-gray-400\"\n                    }`}\n                >\n                    Galerie\n                </span>\n            </button>\n\n            {/* Settings Tab */}\n            <button\n                onClick={() => onNavigate(\"settings\")}\n                className={`flex flex-col items-center gap-1 transition-all duration-300 ${\n                    currentScreen === \"settings\" ? \"scale-100\" : \"scale-90 opacity-60 hover:opacity-100\"\n                }`}\n            >\n                <div className={`p-1.5 rounded-full transition-colors ${\n                    currentScreen === \"settings\" ? \"bg-blue-500/10 text-blue-600 dark:text-blue-400\" : \"text-gray-500 dark:text-gray-400\"\n                }`}>\n                    <Settings className=\"w-6 h-6\" />\n                </div>\n                <span\n                    className={`text-[11px] font-medium tracking-wide ${\n                        currentScreen === \"settings\" ? \"text-blue-600 dark:text-blue-400\" : \"text-gray-500 dark:text-gray-400\"\n                    }`}\n                >\n                    Optionen\n                </span>\n            </button>\n        </nav>\n    );\n}\n"],"names":[],"mappings":"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"}}]
}